<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>计算机图形学和虚拟现实 | 0zxm</title><meta name="author" content="0zxm"><meta name="copyright" content="0zxm"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="计算机图形学和虚拟现实课程笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机图形学和虚拟现实">
<meta property="og:url" content="https://0zxm.github.io/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/index.html">
<meta property="og:site_name" content="0zxm">
<meta property="og:description" content="计算机图形学和虚拟现实课程笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://0zxm.github.io/img/cover2.jpg">
<meta property="article:published_time" content="2025-03-04T15:30:27.000Z">
<meta property="article:modified_time" content="2025-06-17T08:05:10.213Z">
<meta property="article:author" content="0zxm">
<meta property="article:tag" content="图形学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://0zxm.github.io/img/cover2.jpg"><link rel="shortcut icon" href="/favicon.png"><link rel="canonical" href="https://0zxm.github.io/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 0zxm","link":"链接: ","source":"来源: 0zxm","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机图形学和虚拟现实',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-17 16:05:10'
}</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/src/"><i class="fa-fw fas fa-cloud"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">0zxm</span></a><a class="nav-page-title" href="/"><span class="site-name">计算机图形学和虚拟现实</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/src/"><i class="fa-fw fas fa-cloud"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">计算机图形学和虚拟现实</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-04T15:30:27.000Z" title="发表于 2025-03-04 23:30:27">2025-03-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-17T08:05:10.213Z" title="更新于 2025-06-17 16:05:10">2025-06-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/">理论知识</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">19.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>78分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="第一章-绪论"><a href="#第一章-绪论" class="headerlink" title="第一章 绪论"></a>第一章 绪论</h2><p><a href="http://0zxm.github.io/PDFs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%92%8C%E8%99%9A%E6%8B%9F%E7%8E%B0%E5%AE%9E.zip">资源文件</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1NXqYYTEqX">b站up主算法讲解</a></p>
<p><code>计算机图形学是利用计算机研究图形的表示、生成、处理和显示的学科。</code></p>
<p><code>光栅图形学：其核心过程是光栅化，即将矢量图形转换为像素网格的过程。</code>光栅就是通过一栏一栏的像素绘成图像</p>
<h3 id="1-1-计算机图形学的研究内容"><a href="#1-1-计算机图形学的研究内容" class="headerlink" title="1.1 计算机图形学的研究内容"></a>1.1 计算机图形学的研究内容</h3><p>计算机中图形的表示方法,以及利用计算机进行图形的计算、处理和显示的相关原理与算法,构成了计算机图形学的主要研究内容。图形通常由点、线、面、体等几何元素和灰度色彩、线型、线宽等非几何属性组成。从处理技术上来看,图形主要分为两类:<code>一类基于线条信息表示</code>,如工程图、等高线地图和曲面的线框图等;<code>另一类是明暗图(shading)</code>,也就是通常所说的真实感图形。</p>
<p><code>计算机图形学的一个主要目的就是要利用计算机产生令人赏心悦目的真实感图形。</code>为此,一般先建立目标图形所描述场景的<code>几何表示</code>,再采用某种<code>光照模型</code>,计算在假想的光源.纹理、材质属性下几何模型的光照效果。</p>
<p><code>计算机图形学的研究内容非常广泛</code>,如图形硬件、图形标准、图形交互技术、光栅图形生成算法、曲线曲面造型、实体造型、真实感图形计算与显示算法,以及科学计算可视化、计算机动画、自然景物仿真和虚拟现实等。作为一本面向计算机专业的本科生和非计算机专业的研究生的图形学教材,本书着重讨论与光栅图形生成、曲线曲面造型和真实感图形生成相关的原理与算法。</p>
<h3 id="1-2-计算机图形学发展历程"><a href="#1-2-计算机图形学发展历程" class="headerlink" title="1.2 计算机图形学发展历程"></a>1.2 计算机图形学发展历程</h3><p><code>1950年</code>,第一台图形显示器作为美国麻省理工学院(MIT)旋风1号(WhirlwindⅠ)计算机的附件诞生了。该显示器用一个类似于示波器的阴极射线管(CRT)来显示一些简单的</p>
<p><code>1962年</code>，MIT林肯实验室的 <code>IvanE.Sutherland</code> 发表了题为“Sketchpad:一个人机交互通信的图形系统”的博士论文,他在论文中首次使用了计算机图形学(ComputerGraphics)这个术语,证明了交互计算机图形学是一个有价值的研究领域,从而确定了计算机图形学作为一个崭新的科学分支的独立地位。</p>
<p><code>同在20世纪60年代早期</code>,法国雷诺汽车公司的工程师 Pierre Bézier发展了一套被后人称为 Bézier 曲线、曲面的理论,成功地用于几何外形设计,并开发了用于汽车外形设计的 UNISURF 系统。Coons的方法和 Bézier的方法是 CAGD(计算机辅助几何设计)领域的开创性工作。值得一提的是,计算机图形学的最高奖是以 Coons 的名字命名的</p>
<p><code>20世纪70年代是计算机图形学发展过程中一个重要的历史时期</code>。由于光栅显示器的诞生,早在60年代就已萌芽的光栅图形学算法便迅速发展起来。区域填充、裁剪、消隐等基本图形概念及其相应的算法纷纷诞生,图形学进人了第一个兴盛时期。</p>
<p><code>同在20世纪70年代</code>,计算机图形学的另外两个重要进展是真实感图形学和实体造型技术的产生。1970年,Bouknight 提出了第一个光反射模型。1971年,Gourand 提出“漫反射模型十插值”的思想,被称为 Gourand 明暗处理。1975年,Phong 提出了著名的简单光照模型–Phong模型”。这些都是真实感图形学的开创性工作。<br><code>1980 年</code>,Whitted 提出了一个<code>光透视模型--Whitted 模型</code>,并第一次给出光线跟踪算法的范例,实现了 Whitted模型。1984年,美国 Cornell(康内尔)大学和日本广岛大学的学者分别将热辐射工程中的辐射度方法引人到计算机图形学中,成功地模拟了理想漫反射</p>
<h3 id="1-3-计算机图形学的应用及研究前沿"><a href="#1-3-计算机图形学的应用及研究前沿" class="headerlink" title="1.3 计算机图形学的应用及研究前沿"></a>1.3 计算机图形学的应用及研究前沿</h3><ul>
<li>计算机辅助设计与制造</li>
<li>可视化</li>
<li>真实感图形实时绘制与自然景物仿真</li>
<li>计算机动画</li>
<li>用户接口</li>
<li>计算机艺术</li>
</ul>
<h3 id="1-4-图形设备"><a href="#1-4-图形设备" class="headerlink" title="1.4 图形设备"></a>1.4 图形设备</h3><p>高质量的计算机图形离不开高性能的计算机图形硬件设备。一个图形系统通常由图形处理器、图形输入设备和输出设备构成。</p>
<p><strong>图形显示设备</strong></p>
<ol>
<li><code>彩色 CRT 显示器</code></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250305132048274.png" alt="image-20250305132048274"></p>
<blockquote>
<p>​	图 1.7给出了CRT的工作原理。<code>高速的电子東由电子枪发出,经过聚焦系统、加速系统和磁偏转系统就会到达荧光屏的特定位置</code>。荧光物质在高速电子的轰击下会发生电子跃迁,即电子吸收能量从低能态变为高能态,由于高能态很不稳定,在很短的时间内荧光物质的电子会从高能态重新回到低能态,<code>这时将发出荧光,屏幕上的那一点就亮了</code>。从这种发光原理可以看出,这样的光不会持续很久,因为很快所有的电子都将回到低能态,不会再有光发出。所以要保持显示一幅稳定的画面,必须不断地发射电子束。</p>
<p>​	那么电子東是如何发出的,又是如何控制它的强弱的呢?由图1.7可以看出,电子枪由一个加热器、一个金属阴极和一个电平控制器组成。当加热器加到一定高温时,金属阴极上的电子就会摆脱能垒的束缚,进射出去。而电平控制器是用来控制电子束强弱的,当加上正电压时,电子柬就会大量通过,将会在屏幕上形成较亮的点;当控制电平加上负电压时,依据所加电压的大小,电子束被部分或全部阻截,通过的电子很少,屏幕上的点也就比较暗。</p>
<p>​	想要保持稳定图像，那么就需要不断地发射电子束。<code>刷新一次是指电子束从上到下将荧光屏扫描一次</code>。只有刷新频率达到一定值后,图像才能稳定显示。大约达到60Hz时,人眼才能感觉不到屏幕闪烁,但要使人眼觉得舒服,一般必须有85Hz以上的刷新频率。</p>
<p>​	<code>隔行扫描</code>：能够满足扫描速度较慢的显示机器，区别于传统的逐行扫描，<code>隔行扫描能够模拟将扫描频率加倍，但是效果比不上真正的逐行60Hz</code></p>
</blockquote>
<ol start="2">
<li><code>LCD 液晶显示器</code></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250305133540603.png" alt="image-20250305133540603"></p>
<blockquote>
<ul>
<li>基本原理<br>液晶是一种介于液体和固体之间的特殊物质,它具有液体的流态性质和固体的光学性质。当液晶受到电压的影响时,就会改变它的物理性质而发生形变,此时通过它的光的折射角度就会发生变化,而产生色彩。</li>
</ul>
<p>液晶屏幕后面有一个背光,这个光源先穿过第一层偏光板,再来到液晶体上,而当光线透过液晶体时,就会产生光线的色泽改变。从液晶体射出来的光线,还必须经过一块彩色滤光片以及第二块偏光板。由于两块偏光板的偏振方向成90°,再加上电压的变化和一些其他的装置,液晶显示器就能显示想要的颜色了。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250305133547685.png" alt="image-20250305133547685"></p>
<p><strong>图形处理设备</strong></p>
<p>一个光栅显示系统离不开图形处理器,图形处理器是图形系统结构的重要元件,是连接计算机和显示终端的纽带，可以说有显示系统就有图形处理器(俗称显卡)。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250305133810339.png" alt="image-20250305133810339"></p>
<p><strong>图形输入设备</strong></p>
<table>
<thead>
<tr>
<th align="left">设备名称</th>
<th align="left">用途描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">键盘</td>
<td align="left">用于录入文本、发布命令和选择菜单项等。</td>
</tr>
<tr>
<td align="left">鼠标</td>
<td align="left">通过移动和点击来控制光标位置和进行操作。</td>
</tr>
<tr>
<td align="left">光笔</td>
<td align="left">通过光电技术检测屏幕上的位置，用于图形绘制和标记。</td>
</tr>
<tr>
<td align="left">数字化仪</td>
<td align="left">用于绘画着色或交互式选择坐标位置，可输入二维或三维空间的坐标值。</td>
</tr>
<tr>
<td align="left">触摸板</td>
<td align="left">通过手指触摸来控制光标移动和进行操作。</td>
</tr>
<tr>
<td align="left">图形扫描仪</td>
<td align="left">将纸质文档或图像扫描成数字格式，以便计算机进行处理和存储。</td>
</tr>
<tr>
<td align="left">手写输入板</td>
<td align="left">用于手写输入，将手写笔迹转换为数字信号。</td>
</tr>
<tr>
<td align="left">语音输入设备</td>
<td align="left">通过语音识别技术将语音转换为文本或命令。</td>
</tr>
<tr>
<td align="left">数据手套</td>
<td align="left">用于动作捕捉，让计算机识别手部运动，常用于虚拟现实系统。</td>
</tr>
<tr>
<td align="left">操纵杆</td>
<td align="left">用于游戏或模拟操作，通过物理按钮和操纵杆与计算机交互。</td>
</tr>
<tr>
<td align="left">按钮盒和旋钮</td>
<td align="left">按钮和开关常用来输入预定的功能，旋钮用于输入标量值。</td>
</tr>
<tr>
<td align="left">三维扫描仪</td>
<td align="left">用于捕捉物体的三维形状和深度信息，常用于3D建模和仿真。</td>
</tr>
<tr>
<td align="left">深度相机</td>
<td align="left">用于捕捉物体的深度信息，提供三维感知能力。</td>
</tr>
<tr>
<td align="left">光穹</td>
<td align="left">一种高精度的三维扫描设备，用于在光学条件下捕捉物体的完整三维信息。</td>
</tr>
</tbody></table>
<h3 id="1-5-最新研究方向"><a href="#1-5-最新研究方向" class="headerlink" title="1.5 最新研究方向"></a>1.5 最新研究方向</h3><p><strong>绘制</strong>：</p>
<ul>
<li>表面几何细节实时绘制</li>
<li>半透明材质实时编辑</li>
<li>动态场景实时绘制</li>
</ul>
<p><strong>视频</strong>：</p>
<ul>
<li>视频补全</li>
</ul>
<p><strong>几何</strong>：</p>
<ul>
<li>拓扑结构自动修复</li>
<li>积分不变量技术</li>
</ul>
<h2 id="第二章-二维变换"><a href="#第二章-二维变换" class="headerlink" title="第二章 二维变换"></a>第二章 二维变换</h2><h3 id="2-1-向量"><a href="#2-1-向量" class="headerlink" title="2.1 向量"></a>2.1 向量</h3><p>什么是向量? 我们所使用的所有点和向量都是基于某一坐标系定义的。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250318231926090.png" alt="image-20250318231926090" style="zoom:80%;">

<p>从几何的角度看，<code>向量是具有长度和方向的实体</code>，但是没有位置。而点是<code>只有位置，没有长度和方向</code></p>
<p>向量表示一个点到另一个点的位移。假设在XoY直角坐标系中，一个向量可以由它的不同方向的分量表示。</p>
<p><strong>向量的基本操作</strong></p>
<ol>
<li>向量<code>相加减</code>： 向量(2, 6) + 向量(3, 1) &#x3D; (5, 7)</li>
<li>标量的<code>数乘</code>： 3 * 向量(1,4) &#x3D; (3, 12)</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250318233040400.png" alt="image-20250318233040400" style="zoom:67%;">

<ol start="3">
<li><code>向量线性组合</code>：掌握了向量的加法和数乘，就可以定义任意多个向量的线性组合</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250318234229043.png" alt="image-20250318234229043" style="zoom: 80%;">

<ul>
<li>有两种特殊的线性组合在计算机图形学中很重要<ul>
<li>仿射组合：<code>线性组合的系数之和=1</code>，a1 + a2 + a3 + … + an &#x3D; 1</li>
<li><code>凸组合</code>：在仿射组合的基础上，还要求<code>每个系数&gt;0</code></li>
</ul>
</li>
</ul>
<ol start="4">
<li>点乘和叉乘</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/apr15/article/details/106160407">带你一次搞懂点积（内积）、叉积（外积）-CSDN博客</a></p>
<p><code>代数公式和几何公式实际上是等价的</code>，它们从不同的角度描述了同一个数学概念。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319131432486.png" alt="image-20250319131432486" style="zoom:80%;">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319131443670.png" alt="image-20250319131443670" style="zoom:80%;">

<blockquote>
<p>余弦定理：用一个向量来描述一篇新闻，<code>当夹角的余弦接近于1时，两条新闻相似，从而可以归成一类</code>；夹角的余弦越小，两条新闻越不相关</p>
</blockquote>
<p>叉乘: <code>两个向量的叉积是另一个三维向量</code>。叉积只对三维向量有意义。它有许多有用的属性，但最常用的一个是<code>它与原来的两个向量都正交</code>。 经常利用这个<code>属性来求平面的法向量</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319201946242.png" alt="image-20250319201946242"></p>
<h3 id="2-2-坐标系"><a href="#2-2-坐标系" class="headerlink" title="2.2 坐标系"></a>2.2 坐标系</h3><p>什么是坐标系? 坐标系是建立图形与数之间对应联系的参考系</p>
<p><strong>坐标系的分类</strong></p>
<ol>
<li>从维度上来看，分为一维、二维、三维等</li>
<li>从坐标轴之间的空间关系，可分为直角坐标系、极坐标系、圆柱坐标系、球坐标系等</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319202236192.png" alt="image-20250319202236192" style="zoom: 80%;"> 

<p>在对一个事物进行<code>建模（使用数学几何信息来描述物体）</code>和<code>观察（viewing）</code>的过程中，并不总是使用同一个坐标系来考虑。图形显示的过程就是<code>几何（对象）模型在不同坐标系之间的映射变换</code></p>
<p><strong>计算机图形学中坐标系的分类</strong></p>
<ol>
<li><code>世界坐标系</code>：世界坐标系是计算机图形学中用于定义整个虚拟世界空间的全局坐标系。<code>它是所有物体和场景的共同参考框架</code>，所有物体的位置、方向和大小等属性都是相对于世界坐标系来定义和计算的。</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319202744213.png" alt="image-20250319202744213" style="zoom:80%;">

<ol start="2">
<li><code>建模坐标系</code>：又称为局部坐标系。<code>每个物体（对象）有它自己的局部中心和坐标系</code></li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319202831435.png" alt="image-20250319202831435" style="zoom:80%;">

<ol start="3">
<li><code>观察坐标系</code>：观察坐标系是以<code>观察者（如相机、视点等）为中心的坐标系。</code>它定义了观察者的位置、观察方向以及观察区域的范围和形状，用于将世界坐标系中的物体转换到观察者视角下进行投影和显示。</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319203144580.png" alt="image-20250319203144580" style="zoom:80%;">

<ol start="4">
<li><code>设备坐标系</code>： <code>适合特定输出设备输出对象的坐标系。</code>比如屏幕坐标系，在多数情况下，对于每一个具体的显示设备，都有一个单独的坐标系统 <ul>
<li>定义图形在特定输出设备上的显示位置和大小，每个坐标对应设备上的一个像素。</li>
<li>与具体设备的分辨率相关，坐标范围由设备的分辨率决定。</li>
<li>在定义了显示窗口的情况下，可在设备坐标系中进一步定义称为视区的有限区域，视区中的成像即为实际所观察到的。</li>
<li><code>注意：设备坐标是整数</code></li>
</ul>
</li>
<li><code>规范化坐标系</code>：规范化坐标系是一种与设备无关的坐标系统，用于图形处理过程中，确保输出的图形在任何设备上都能保持一致。通常用于将观察坐标系中的坐标转换为设备坐标系之前的中间步骤。<code>其坐标范围一般从-1到1或者0到1</code></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319203455008.png" alt="image-20250319203455008"></p>
<h3 id="2-3-二维图形变换"><a href="#2-3-二维图形变换" class="headerlink" title="2.3 二维图形变换"></a>2.3 二维图形变换</h3><p>一个简单的图形，通过各种变换<code>（如：比例、旋转、镜象 、错切、平移等）</code>可以形成一个丰富多彩的图形或图案</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319204120863.png" alt="image-20250319204120863"></p>
<p>在计算机动画中，经常有几个物体之间的相对运动，可以通过<code>平移和旋转这些物体的局部坐标系得到这种动画效果</code></p>
<p><strong>图形变换的基本原理</strong></p>
<ol>
<li>图形变化了，但原图形的<code>连边规则没有改变</code></li>
<li>图形的变化，是因为<code>顶点位置的改变决定的</code></li>
</ol>
<p>变换图形就是要变换图形的几何关系，即<code>改变顶点的坐标；同时，保持图形的原拓扑关系不变</code></p>
<p>仿射变换：是一种<code>二维坐标到二维坐标之间的线性变换</code></p>
<ol>
<li>平直性：直线经过变换之后依然是直线  </li>
<li>平行性：平行线依然是平行线，且直线上  点的位置顺序不变）</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319204425737.png" alt="image-20250319204425737"></p>
<h3 id="2-4-齐次坐标"><a href="#2-4-齐次坐标" class="headerlink" title="2.4 齐次坐标"></a>2.4 齐次坐标</h3><p>向量(x, y)经过变换后的点坐标为(x’, y’)，这个变换过程可以写成如下矩阵形式</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319205001940.png" alt="image-20250319205001940" style="zoom:80%;">

<p>这种用三维向量表示二维向量，或者一般而言，用一个n+1维的向量表示一个n维向量的方法称为<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1vi421Y7nP">齐次坐标</a>表示法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319205527127.png" alt="image-20250319205527127"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319210210408.png" alt="image-20250319210210408"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319210321329.png" alt="image-20250319210321329" style="zoom:80%;">

<h3 id="2-5-平移变换"><a href="#2-5-平移变换" class="headerlink" title="2.5 平移变换"></a>2.5 平移变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319210905834.png" alt="image-20250319210905834"></p>
<h3 id="2-6-比例变换"><a href="#2-6-比例变换" class="headerlink" title="2.6 比例变换"></a>2.6 比例变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319211416760.png" alt="image-20250319211416760"></p>
<h3 id="2-7-对称变换"><a href="#2-7-对称变换" class="headerlink" title="2.7 对称变换"></a>2.7 对称变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319211525162.png" alt="image-20250319211525162"></p>
<h3 id="2-8-旋转变换"><a href="#2-8-旋转变换" class="headerlink" title="2.8 旋转变换"></a>2.8 旋转变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319211905678.png" alt="image-20250319211905678"></p>
<h3 id="2-9-错切变换"><a href="#2-9-错切变换" class="headerlink" title="2.9 错切变换"></a>2.9 错切变换</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319212802746.png" alt="image-20250319212802746"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319212847080.png" alt="image-20250319212847080"></p>
<h3 id="2-10-复合变换"><a href="#2-10-复合变换" class="headerlink" title="2.10 复合变换"></a>2.10 复合变换</h3><p>复合变换是指图形作一次以上的几何变换，变换结果是每次的变换矩阵相乘。从另一方面看，任何一个复杂的几何变换都可以看作<code>基本几何变换的组合形式。</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319213041159.png" alt="image-20250319213041159"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319213132897.png" alt="image-20250319213132897"></p>
<h3 id="2-11-窗口、视区及变换"><a href="#2-11-窗口、视区及变换" class="headerlink" title="2.11 窗口、视区及变换"></a>2.11 窗口、视区及变换</h3><p>世界坐标系中要显示的区域（通常在观察坐标系内定义）称为<code>窗口</code>。<code>窗口映射到显示器(设备)上的区域称为视区</code></p>
<p>窗口就是假定你的前方有一个能够透过光的玻璃，按物理学来说你能看到的区域。而视区就是将你能看到的事物映射到二维屏幕上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319213533494.png" alt="image-20250319213533494"></p>
<p>如何将窗口内的图形在视区中显示出来呢? <code>必须经过将窗口到视区的变换处理，这种变换就是观察变换（Viewing Transformation）</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319213759071.png" alt="image-20250319213759071"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319213816258.png" alt="image-20250319213816258"></p>
<h3 id="2-12-最重要的"><a href="#2-12-最重要的" class="headerlink" title="2.12 最重要的"></a>2.12 最重要的</h3><p><code>最重要的就是这个变换矩阵的每个元素会对二维图形造成什么影响</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250319214219716.png" alt="image-20250319214219716"></p>
<h2 id="第三章-光栅图形学"><a href="#第三章-光栅图形学" class="headerlink" title="第三章 光栅图形学"></a>第三章 光栅图形学</h2><p><code>光栅图形显示器可以看做一个像素的矩阵</code>。在光栅显示器上显示的任何一种图形，实际上都是一些具有<code>一种或多种颜色的像素集合</code>。</p>
<p>首先介绍几个重要的概念：</p>
<p><code>图形的光栅化：</code>确定最佳逼近图形的像素点集合，并使用指定属性写像素的过程</p>
<p><code>裁剪：</code>任何图形进行光栅化时,必须显示在屏幕的一个窗口里,超出窗口的图形部分不予显示。确定一个图形的哪些部分在窗口内,必须显示;哪些部分落在窗口之外,不该显示的过程</p>
<p><code>走样和反走样：</code>对图形进行光栅化时,由于显示器的空间分辨率有限,<code>对于非水平垂直、±45°的直线</code>,因像素逼近误差,使所画图形产生畸变(台阶、锯齿)的现象称之为走样(aliasing)。用于减少或消除走样的技术称为反走样(antialiasing)。</p>
<p><code>消隐：</code>在真实感图形绘制过程中，由于投影变换失去了深度信息，会导致图形的二义性。消隐就是为了消除这类二义性，在绘制时消除被遮挡的不可见的线或面，以得到物体的真实图形。</p>
<h3 id="3-1-直线段的扫描转换算法"><a href="#3-1-直线段的扫描转换算法" class="headerlink" title="3.1 直线段的扫描转换算法"></a>3.1 直线段的扫描转换算法</h3><p>在数学上,理想的直线是没有宽度的,它是由无数个点构成的集合。对直线进行光栅化时,只能在显示器所给定的有限个像素组成的矩阵中,确定最佳逼近于该直线的一组像素,并且按扫描线顺序。</p>
<h4 id="DDA数值微分算法"><a href="#DDA数值微分算法" class="headerlink" title="DDA数值微分算法"></a>DDA数值微分算法</h4><blockquote>
<p>DDA算法基于直线的微分方程，DDA 算法基于直线的微分方程 $d y &#x3D; k  dx$ 和 $d x &#x3D;  \frac{1}{k}  d y$，其中 $ k $ 是直线的斜率。通过选择最大位移方向作为步长方向，每次在该方向上移动一个单位长度，并根据斜率计算出另一个方向的增量，从而确定下一个像素点的位置。</p>
<ol>
<li><strong>确定直线方程和增量</strong></li>
</ol>
<ul>
<li>根据给定的起点 $ P_0(x_0, y_0) $ 和终点 $ P_1(x_1, y_1) $，计算直线的斜率 $ k &#x3D; \frac{y_1 - y_0}{x_1 - x_0} $。</li>
<li>选择在 $ x $ 或 $ y $ 方向作为步长方向，通常选择较大位移方向。若 $ |x_1 - x_0| &gt; |y_1 - y_0| $，则以 $ x $ 方向为步长方向，否则以 $ y $ 方向为步长方向。<code>选择较大位移方向是为了提高精度</code></li>
</ul>
<ol start="2">
<li><strong>计算增量</strong></li>
</ol>
<ul>
<li>若步长方向为 $ x $，则每次在 $ x $ 方向移动一个单位长度，即 $ \Delta x &#x3D; 1 $，对应的 $ y $ 方向增量为 $ \Delta y &#x3D; k $。</li>
<li>若步长方向为 $ y $，则每次在 $ y $ 方向移动一个单位长度，即 $ \Delta y &#x3D; 1 $，对应的 $ x $ 方向增量为 $ \Delta x &#x3D; \frac{1}{k} $。</li>
</ul>
<ol start="3">
<li><strong>逐点绘制</strong></li>
</ol>
<ul>
<li>从起点开始，每次在步长方向移动一个单位长度，并根据计算的增量确定另一个方向的坐标，得到下一个像素点的坐标。</li>
<li>重复该过程，直到到达终点。</li>
</ul>
</blockquote>
<p>已知过端点 $P_0(x_0, y_0)$, $P_1(x_1, y_1)$ 的直线段 $L(P_0, P_1)$，直线斜率 $k &#x3D; \frac{y_1 - y_0}{x_1 - x_0}$。画线过程为：从 $x$ 的左端点 </p>
<p>$x_0$ 开始，向 $x$ 右端点步进，步长 &#x3D; 1（像素），按 $y &#x3D; kx + b$ 计算相应的 $y$ 坐标，并取像素点 $(x, \text{round}(y))$ 作为当前点的坐标。但</p>
<p>这样做，计算每一个点需要做一个乘法、一个加法。设步长为 $\Delta x$，有 $x_{i+1} &#x3D; x_i + \Delta x$，于是：</p>
<p>$$y_{i+1} &#x3D; kx_{i+1} + b &#x3D; kx_i + k \Delta x + b &#x3D; y_i + k \Delta x$$</p>
<p>当 $\Delta x &#x3D; 1$ 时，则有 $y_{i+1} &#x3D; y_i + k$；即 $x$ 每递增 1，$y$ 递增 $k$（即直线斜率）。<code>这样，计算就由一个乘法和一个加法减少为一个加法。</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250426175334924.png" alt="image-20250426175334924"></p>
<blockquote>
<p>在c++中，<code>int强转</code>是截断小数点的，所以要加上0.5来确保四舍五入</p>
<p>应当注意: 图中上述算法仅适用于<code>|k|&lt;1</code>的情形。在这种情况下,x每增加1,y最多增加1。当<code>|k| &gt; 1</code>时,必须把x,y的地位互换,y每增加1,x相应增加1&#x2F;k。在这个算法中，y与k必须用浮点数表示,而且每一步都要对y进行四舍五入后取整,这使得该算法不利于硬件实现。</p>
</blockquote>
<ul>
<li><strong>优点</strong><ul>
<li>易于编程实现。</li>
<li>计算量较小，适合计算机图形学中的直线绘制。</li>
</ul>
</li>
<li><strong>缺点</strong><ul>
<li>绘制速度相对较慢，因为需要进行浮点运算。</li>
<li>精度有限，受设备精度的影响较大。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"widget.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ui_widget.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">cout</span> <span class="token expression"><span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token function">Widget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>Widget<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    ui<span class="token operator">-></span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QImage</span><span class="token punctuation">(</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QImage<span class="token double-colon punctuation">::</span>Format_RGB32<span class="token punctuation">)</span><span class="token punctuation">;</span>
    image<span class="token operator">-></span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化图像背景为白色</span>

    QPoint <span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPoint <span class="token function">end</span><span class="token punctuation">(</span>image<span class="token operator">-></span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">-></span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 使用DDA算法在Qimage上设置直线【像素点集合】</span>
    <span class="token function">DDACalc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>start<span class="token punctuation">,</span> <span class="token operator">&amp;</span>end<span class="token punctuation">,</span> <span class="token operator">*</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">&#125;</span>

<span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> image<span class="token punctuation">;</span> <span class="token comment">// 释放图像内存</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 创建一个用于绘制到窗口的画家</span>
    QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绘制文字</span>
    painter<span class="token punctuation">.</span><span class="token function">setRenderHint</span><span class="token punctuation">(</span>QPainter<span class="token double-colon punctuation">::</span>Antialiasing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    painter<span class="token punctuation">.</span><span class="token function">setRenderHint</span><span class="token punctuation">(</span>QPainter<span class="token double-colon punctuation">::</span>NonCosmeticBrushPatterns<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启用高抗锯齿</span>
    painter<span class="token punctuation">.</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    painter<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token function">QFont</span><span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    painter<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token function">QRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>AlignCenter<span class="token punctuation">,</span> <span class="token string">"DDA算法画直线"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    painter<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token function">QRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token operator">-></span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> image<span class="token operator">-></span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Qt自带的绘制直线函数</span>
    <span class="token comment">// QPoint start(0, 0);</span>
    <span class="token comment">// QPoint end(image->rect().width() - 1, image->rect().height() - 1);</span>
    <span class="token comment">// painter.drawLine(start, end);</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 此处只考虑了从左往右绘制的情况</span>
<span class="token keyword">void</span> <span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token function">DDACalc</span><span class="token punctuation">(</span><span class="token keyword">const</span> QPoint <span class="token operator">*</span>start<span class="token punctuation">,</span> <span class="token keyword">const</span> QPoint <span class="token operator">*</span>end<span class="token punctuation">,</span> QImage <span class="token operator">&amp;</span>img<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> dx <span class="token operator">=</span> end<span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dy <span class="token operator">=</span> end<span class="token operator">-></span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token operator">-></span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> k <span class="token operator">=</span> dy <span class="token operator">/</span> <span class="token keyword">float</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 求出斜率k</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"k = "</span> <span class="token operator">&lt;&lt;</span>k<span class="token punctuation">;</span>

    <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token function">qMax</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> steps<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>steps <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 起点和终点重合</span>
        img<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>start<span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> start<span class="token operator">-></span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">float</span> x <span class="token operator">=</span> start<span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> y <span class="token operator">=</span> start<span class="token operator">-></span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>steps <span class="token operator">==</span> dx<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> x<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span>steps<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            image<span class="token operator">-></span><span class="token function">setPixel</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            y <span class="token operator">=</span> y <span class="token operator">+</span> k<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> y<span class="token punctuation">;</span> i<span class="token operator">&lt;=</span> steps<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            image<span class="token operator">-></span><span class="token function">setPixel</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1.0</span> <span class="token operator">/</span>k<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="中点画线法"><a href="#中点画线法" class="headerlink" title="中点画线法"></a>中点画线法</h4><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26263309">直线方程的各种形式 - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/468849410">https://zhuanlan.zhihu.com/p/468849410</a></p>
<p><strong>算法核心思想</strong>：通过判断直线中点与理想直线的位置关系，决定下一像素点的选择。</p>
<ol>
<li><strong>参数预处理</strong></li>
</ol>
<ul>
<li>输入起点 <code>(x0, y0)</code> 和终点 <code>(x1, y1)</code></li>
<li>计算坐标增量：<br>  <code>dx = x1 - x0</code><br>  <code>dy = y1 - y0</code></li>
<li>确定直线的主方向：<ul>
<li><strong>斜率绝对值 &lt; 1</strong>：以 <code>x</code> 为步进方向（水平主方向）</li>
<li><strong>斜率绝对值 ≥ 1</strong>：以 <code>y</code> 为步进方向（垂直主方向）</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>决策变量公式推导</strong></li>
</ol>
<p>以 <strong>斜率 0 ≤ k ≤ 1</strong> 为例（其他斜率通过对称性处理）：</p>
<ul>
<li>直线隐式方程：<code>F(x, y) = dy·x - dx·y + dx·y0 - dy·x0 = 0</code></li>
<li>中点 <code>M(x+1, y+0.5)</code> 到直线的距离由 <code>F(M)</code> 的符号决定：<ul>
<li><code>F(M) &lt; 0</code> → 中点在直线下方 → 选择上方像素 <code>(x+1, y+1)</code></li>
<li><code>F(M) ≥ 0</code> → 中点在上方或恰在直线上 → 选择下方像素 <code>(x+1, y)</code></li>
</ul>
</li>
<li><strong>决策变量初始值</strong>：<br>  <code>d = 2·dy - dx</code> （简化后的整数形式）</li>
</ul>
<ol start="3">
<li><strong>递推公式</strong></li>
</ol>
<ul>
<li>若 <code>d &lt; 0</code>：<br>  选择下方像素 <code>(x+1, y)</code>，更新决策变量：<br>  <code>d = d + 2·dy</code></li>
<li>若 <code>d ≥ 0</code>：<br>  选择上方像素 <code>(x+1, y+1)</code>，更新决策变量：<br>  <code>d = d + 2·(dy - dx)</code></li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250426222435792.png" alt="image-20250426222435792" style="zoom:80%;">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250427114424689.png" alt="image-20250427114424689" style="zoom:80%;">

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token function">midpointLine</span><span class="token punctuation">(</span><span class="token keyword">const</span> QPoint<span class="token operator">&amp;</span> start<span class="token punctuation">,</span> <span class="token keyword">const</span> QPoint<span class="token operator">&amp;</span> end<span class="token punctuation">,</span> QImage<span class="token operator">&amp;</span> img<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x0 <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> y0 <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> x1 <span class="token operator">=</span> end<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> y1 <span class="token operator">=</span> end<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> dx <span class="token operator">=</span> x1 <span class="token operator">-</span> x0<span class="token punctuation">;</span>
    <span class="token keyword">int</span> dy <span class="token operator">=</span> y1 <span class="token operator">-</span> y0<span class="token punctuation">;</span>

    <span class="token keyword">int</span> d<span class="token punctuation">,</span> x <span class="token operator">=</span> x0<span class="token punctuation">,</span> y <span class="token operator">=</span> y0<span class="token punctuation">;</span>

    <span class="token comment">// 斜率小于1的情况</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>dy<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">abs</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        d <span class="token operator">=</span> dx <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> dy <span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> x1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            img<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置像素点颜色</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                d <span class="token operator">-=</span> <span class="token number">2</span> <span class="token operator">*</span> dy<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                d <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> dy <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> dx<span class="token punctuation">;</span>
                y<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            x<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 斜率大于1的情况</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        d <span class="token operator">=</span> dy <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> dx<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;=</span> y1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            img<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置像素点颜色</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                d <span class="token operator">-=</span> <span class="token number">2</span> <span class="token operator">*</span> dx<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                d <span class="token operator">+=</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> dx <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> dy<span class="token punctuation">;</span>
                x<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            y<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Bresenham算法"><a href="#Bresenham算法" class="headerlink" title="Bresenham算法"></a>Bresenham算法</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250427202549565.png" alt="image-20250427202549565"></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token class-name">Widget</span><span class="token double-colon punctuation">::</span><span class="token function">Bresenham</span><span class="token punctuation">(</span><span class="token keyword">const</span> QPoint<span class="token operator">&amp;</span> start<span class="token punctuation">,</span> <span class="token keyword">const</span> QPoint<span class="token operator">&amp;</span> end<span class="token punctuation">,</span> QImage<span class="token operator">&amp;</span> img<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x0 <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> y0 <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> x1 <span class="token operator">=</span> end<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> y1 <span class="token operator">=</span> end<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> dx <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dy <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sx <span class="token operator">=</span> <span class="token punctuation">(</span>x0 <span class="token operator">&lt;</span> x1<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// x方向步进（左/右）</span>
    <span class="token keyword">int</span> sy <span class="token operator">=</span> <span class="token punctuation">(</span>y0 <span class="token operator">&lt;</span> y1<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// y方向步进（上/下）</span>
    <span class="token keyword">bool</span> swapAxis <span class="token operator">=</span> dy <span class="token operator">></span> dx<span class="token punctuation">;</span>     <span class="token comment">// 判断是否需要交换主轴</span>

    <span class="token keyword">int</span> error <span class="token operator">=</span> swapAxis <span class="token operator">?</span> <span class="token number">2</span><span class="token operator">*</span>dx <span class="token operator">-</span> dy <span class="token operator">:</span> <span class="token number">2</span><span class="token operator">*</span>dy <span class="token operator">-</span> dx<span class="token punctuation">;</span> <span class="token comment">// 初始化误差项</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> x0<span class="token punctuation">,</span> y <span class="token operator">=</span> y0<span class="token punctuation">;</span>

    <span class="token comment">// 根据主轴选择循环次数</span>
    <span class="token keyword">int</span> steps <span class="token operator">=</span> swapAxis <span class="token operator">?</span> dy <span class="token operator">:</span> dx<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> steps<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        img<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>swapAxis<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 以y轴为主方向</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                x <span class="token operator">+=</span> sx<span class="token punctuation">;</span>       <span class="token comment">// 副方向步进（x轴）</span>
                error <span class="token operator">-=</span> <span class="token number">2</span><span class="token operator">*</span>dy<span class="token punctuation">;</span> <span class="token comment">// 修正误差项</span>
            <span class="token punctuation">&#125;</span>
            error <span class="token operator">+=</span> <span class="token number">2</span><span class="token operator">*</span>dx<span class="token punctuation">;</span>     <span class="token comment">// 主方向步进（y轴）</span>
            y <span class="token operator">+=</span> sy<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 以x轴为主方向</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                y <span class="token operator">+=</span> sy<span class="token punctuation">;</span>       <span class="token comment">// 副方向步进（y轴）</span>
                error <span class="token operator">-=</span> <span class="token number">2</span><span class="token operator">*</span>dx<span class="token punctuation">;</span>  <span class="token comment">// 修正误差项</span>
            <span class="token punctuation">&#125;</span>
            error <span class="token operator">+=</span> <span class="token number">2</span><span class="token operator">*</span>dy<span class="token punctuation">;</span>      <span class="token comment">// 主方向步进（x轴）</span>
            x <span class="token operator">+=</span> sx<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-多边形扫描算法"><a href="#3-2-多边形扫描算法" class="headerlink" title="3.2 多边形扫描算法"></a>3.2 多边形扫描算法</h3><p>多边形分为凸多边形(任意两顶点间的连线均在多边形内)如图2-7(a)所示,凹多边形(任意两顶点间的连线可能有不在多边形内的部分)如图2-7(b)所示,含内环的多边形如图 2-7(c)所示</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250429202947311.png" alt="image-20250429202947311" style="zoom:80%;">

<h3 id="3-3-裁剪算法"><a href="#3-3-裁剪算法" class="headerlink" title="3.3 裁剪算法"></a>3.3 裁剪算法</h3><p>使用计算机处理图形信息时,计算机内部存储的图形往往比较大,而屏幕显示的只是图的一部分,因此需要裁剪，提高显示效率。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428110214951.png" alt="image-20250428110214951"></p>
<h4 id="3-2-1-直线段裁剪"><a href="#3-2-1-直线段裁剪" class="headerlink" title="3.2.1 直线段裁剪"></a>3.2.1 直线段裁剪</h4><p><strong>Cohen-Sutherland 裁剪算法</strong></p>
<p>该算法的思想是: 对于每条线段PP的处理分为3种情况。</p>
<ol>
<li><p>若$P_1，P_2$完全在窗口内,则显示该线段,简称<code>取</code>之</p>
</li>
<li><p>若$P_1，P_2$:明显在窗口外,则丢弃该线段,简称<code>弃</code>之。</p>
</li>
<li><p>若线段既不满足“取”的条件,也不满足“弃”的条件,则在交点处把线段分为两段,其中一段完全在窗口外,可弃之;然后对另一段重复上述处理。</p>
</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428110732346.png" alt="image-20250428110732346" style="zoom:80%;">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428110803327.png" alt="image-20250428110803327" style="zoom: 80%;">

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 定义区域编码的位掩码</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> INSIDE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0000</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> LEFT   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0001</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> RIGHT  <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 0010</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> BOTTOM <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 0100</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> TOP    <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 1000</span>

<span class="token comment">// 视口边界坐标</span>
<span class="token keyword">double</span> x_min <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> x_max <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> y_min <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> y_max <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>

<span class="token comment">// 计算点的区域编码</span>
<span class="token keyword">int</span> <span class="token function">computeCode</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> code <span class="token operator">=</span> INSIDE<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> x_min<span class="token punctuation">)</span>        code <span class="token operator">|=</span> LEFT<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> x_max<span class="token punctuation">)</span>   code <span class="token operator">|=</span> RIGHT<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span> y_min<span class="token punctuation">)</span>        code <span class="token operator">|=</span> BOTTOM<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">></span> y_max<span class="token punctuation">)</span>   code <span class="token operator">|=</span> TOP<span class="token punctuation">;</span>
    <span class="token keyword">return</span> code<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Cohen-Sutherland 裁剪算法</span>
<span class="token keyword">bool</span> <span class="token function">cohenSutherlandClip</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>x0<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>y0<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>x1<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>y1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> code0 <span class="token operator">=</span> <span class="token function">computeCode</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> code1 <span class="token operator">=</span> <span class="token function">computeCode</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> accept <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>code0 <span class="token operator">|</span> code1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 完全在视口内</span>
            accept <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>code0 <span class="token operator">&amp;</span> code1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 完全在视口外</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 至少有一个点在外部，选择外部点进行裁剪</span>
            <span class="token keyword">int</span> codeOut <span class="token operator">=</span> code0 <span class="token operator">?</span> code0 <span class="token operator">:</span> code1<span class="token punctuation">;</span>
            <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>

            <span class="token comment">// 计算与边界的交点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>codeOut <span class="token operator">&amp;</span> TOP<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token comment">// 与上边界相交</span>
                x <span class="token operator">=</span> x0 <span class="token operator">+</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y_max <span class="token operator">-</span> y0<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                y <span class="token operator">=</span> y_max<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>codeOut <span class="token operator">&amp;</span> BOTTOM<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 与下边界相交</span>
                x <span class="token operator">=</span> x0 <span class="token operator">+</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y_min <span class="token operator">-</span> y0<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                y <span class="token operator">=</span> y_min<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>codeOut <span class="token operator">&amp;</span> RIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 与右边界相交</span>
                y <span class="token operator">=</span> y0 <span class="token operator">+</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x_max <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> x_max<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>codeOut <span class="token operator">&amp;</span> LEFT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// 与左边界相交</span>
                y <span class="token operator">=</span> y0 <span class="token operator">+</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x_min <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> x_min<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// 更新外部点为交点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>codeOut <span class="token operator">==</span> code0<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                x0 <span class="token operator">=</span> x<span class="token punctuation">;</span>
                y0 <span class="token operator">=</span> y<span class="token punctuation">;</span>
                code0 <span class="token operator">=</span> <span class="token function">computeCode</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>
                y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>
                code1 <span class="token operator">=</span> <span class="token function">computeCode</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> accept<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 示例线段：起点(50,150)，终点(450,250)</span>
    <span class="token keyword">double</span> x0 <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> y0 <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> x1 <span class="token operator">=</span> <span class="token number">450</span><span class="token punctuation">,</span> y1 <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cohenSutherlandClip</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"裁剪后的线段端点:\n"</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> x0 <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> y0 <span class="token operator">&lt;&lt;</span> <span class="token string">") -> ("</span>
            <span class="token operator">&lt;&lt;</span> x1 <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> y1 <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"线段完全在视口外\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>中点裁剪算法</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428111138722.png" alt="image-20250428111138722" style="zoom:85%;">

<p><strong>梁友栋裁剪算法</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428111527476.png" alt="image-20250428111527476" style="zoom:80%;">

<h4 id="3-2-2-多边形裁剪-Suther-land-Hodgeman算法"><a href="#3-2-2-多边形裁剪-Suther-land-Hodgeman算法" class="headerlink" title="3.2.2 多边形裁剪 Suther land-Hodgeman算法"></a>3.2.2 多边形裁剪 Suther land-Hodgeman算法</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jurbo/article/details/74999874">计算机图形学 学习笔记（五）：多边形裁剪（Suther land-Hodgeman），文字裁剪_2sutherland的九区域代码的定义:-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43840665/article/details/130084233">【图形学】多边形裁剪算法综述-CSDN博客</a></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250428112737257.png" alt="image-20250428112737257" style="zoom:80%;">

<p>基本策略是，先读取最开始的<code>顶点V0和V3</code>，对<code>窗口左边</code>做处理，得到<code>交点L1和V3</code>作为处理窗口下一条边的输入，然后对<code>窗口上边</code>做处理，输出<code>L1和新的交点L2</code>，然后这样不断读取下去，直到所有的点都处理过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/80908728b612961e8953223a5df921ee.png" alt="img"></p>
<h2 id="第四章-真实感图形学"><a href="#第四章-真实感图形学" class="headerlink" title="第四章 真实感图形学"></a>第四章 真实感图形学</h2><p>真实感图形学是计算机图形学中一个重要的组成部分,<code>它的基本要求就是在计算机中生成二维场景的真实感图形图像,包括各类自然现象。</code></p>
<h3 id="4-1-颜色视觉"><a href="#4-1-颜色视觉" class="headerlink" title="4.1 颜色视觉"></a>4.1 颜色视觉</h3><p>从不同的角度来看，对于颜色有不同的要素或特性：</p>
<ul>
<li>心理学和视觉角度：色调，饱和度和亮度</li>
<li>光学：主波长，纯度(对应于饱和度)，明度(对应于亮度)</li>
</ul>
<blockquote>
<p><code>饱和度</code>是指颜色的纯度,例如鲜红色的饱和度高,而粉红色的饱和度低。<code>亮度</code>就是光的强度,是光给人刺激的强度。</p>
</blockquote>
<p><strong>三色学说</strong>：任何一种颜色可以用红、绿、蓝三原色按照不同比例混合来得到</p>
<h3 id="光学补充知识"><a href="#光学补充知识" class="headerlink" title="光学补充知识"></a>光学补充知识</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/684580990">什么是亮度、照度和光强？三者什么关系？ - 知乎</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1D2XpYsEiC/">bilibili</a></p>
<ol>
<li>正常情况下，<code>光沿直线传播</code>，当遇到不同的介质的分界面时，会产生反射和折射现象</li>
<li>反射定律：入射角等于反射角</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415201640076.png" alt="image-20250415201640076"></p>
<ol start="3">
<li><p>折射定律：对应介质的折射率之比等于<code>入射线和折射线与法线构成的夹角的sin值</code>之比</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415201932142.png" alt="image-20250415201932142"></p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415201914376.png" alt="image-20250415201914376"></p>
<ol start="4">
<li>能量关系：能量是守恒的</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415202031612.png" alt="image-20250415202031612"></p>
<p><strong>光的度量：</strong></p>
<ul>
<li>立体角</li>
<li>点发光强度</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415202208048.png" alt="image-20250415202208048" style="zoom:80%;">

<h3 id="4-2-简单光照模型"><a href="#4-2-简单光照模型" class="headerlink" title="4.2 简单光照模型"></a>4.2 简单光照模型</h3><h4 id="Pong光照模型"><a href="#Pong光照模型" class="headerlink" title="Pong光照模型"></a>Pong光照模型</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/WAoyu/p/13093534.html">简单光照模型(Phong和Blinn-Phong)和明暗处理 - 芒果和小猫 - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zouchanglin.cn/post/11-09-blinn-phong-lighting-model-and-shading-method/">Blinn-Phong光照模型与着色方法 - Tim’s Note</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/352209183">知乎-详解Blinn-Phong和Phong光照模型</a></p>
<p><strong>基本组成</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415204008784.png" alt="image-20250415204008784" style="zoom:80%;">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415204029898.png" alt="image-20250415204008784" style="zoom:80%;">

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415204128262.png" alt="image-20250415204128262" style="zoom:80%;">

<p><strong>相关向量</strong></p>
<ul>
<li><strong>法线向量（Normal Vector）</strong>：垂直于表面的向量，用于表示表面的方向。</li>
<li><strong>视图向量（View Vector）</strong>：指向观察者方向的向量。</li>
<li><strong>光线向量（Light Vector）</strong>：指向光源方向的向量。</li>
<li><strong>反射向量（Reflection Vector）</strong>：表示光线在表面反射后的方向。</li>
</ul>
<p><strong>特点</strong></p>
<ul>
<li><strong>简单高效</strong>：Phong模型相对简单，计算成本较低，能够快速地为物体表面提供较为真实的光照效果。</li>
<li><strong>可调节性强</strong>：通过调整各个反射系数和高光指数等参数，可以模拟不同材质的光照效果。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415203742827.png" alt="image-20250415203742827"></p>
<blockquote>
<p>在Phong光照模型中，确定某个点的RGB值需要综合考虑环境光、漫反射光和镜面反射光这三种光照分量。以下是具体的计算过程：</p>
<h3 id="1-环境光（Ambient-Light）"><a href="#1-环境光（Ambient-Light）" class="headerlink" title="1. 环境光（Ambient Light）"></a>1. 环境光（Ambient Light）</h3><p>环境光是模拟场景中普遍存在的光，与物体表面的朝向无关。其计算公式为：<br>$ I_a &#x3D; k_a \cdot I_{a_{\text{source}}} $<br>其中：</p>
<ul>
<li>$ I_a $ 是环境光对物体表面的贡献。</li>
<li>$ k_a $ 是物体表面对环境光的反射系数，通常是一个 RGB 向量。</li>
<li>$ I_{a_{\text{source}}} $ 是环境光的强度，也是一个 RGB 向量。</li>
</ul>
<p>例如，假设环境光的强度为 $ I_{a_{\text{source}}} &#x3D; (0.2, 0.2, 0.2) $，物体表面对环境光的反射系数为 $ k_a &#x3D; 0.1 $，则环境光的贡献为：<br>$ I_a &#x3D; 0.1 \cdot (0.2, 0.2, 0.2) &#x3D; (0.02, 0.02, 0.02) $</p>
<h3 id="2-漫反射光（Diffuse-Light）"><a href="#2-漫反射光（Diffuse-Light）" class="headerlink" title="2. 漫反射光（Diffuse Light）"></a>2. 漫反射光（Diffuse Light）</h3><p>漫反射光是光线照射到物体表面后，向各个方向均匀反射的光。其计算公式为：<br>$ I_d &#x3D; k_d \cdot I_{d_{\text{source}}} \cdot \max(0, \vec{N} \cdot \vec{L}) $<br>其中：</p>
<ul>
<li>$ I_d $ 是漫反射光对物体表面的贡献。</li>
<li>$ k_d $ 是物体表面对漫反射光的反射系数，通常是一个 RGB 向量。</li>
<li>$ I_{d_{\text{source}}} $ 是光源的漫反射强度，也是一个 RGB 向量。</li>
<li>$ \vec{N} $ 是物体表面的法线向量，需要归一化。</li>
<li>$ \vec{L} $ 是从物体表面点指向光源的方向向量，也需要归一化。</li>
<li>$ \vec{N} \cdot \vec{L} $ 是法线向量和光线方向向量的点积，表示光线与表面的夹角。</li>
</ul>
<p>例如，假设光源的漫反射强度为 $ I_{d_{\text{source}}} &#x3D; (1.0, 1.0, 1.0) $，物体表面对漫反射光的反射系数为 $ k_d &#x3D; 0.5 $，法线向量为 $ \vec{N} &#x3D; (0, 1, 0) $，光线方向向量为 $ \vec{L} &#x3D; (0, 1, 0) $，则漫反射光的贡献为：<br>$ \vec{N} \cdot \vec{L} &#x3D; 1 $<br>$ I_d &#x3D; 0.5 \cdot (1.0, 1.0, 1.0) \cdot 1 &#x3D; (0.5, 0.5, 0.5) $</p>
<h3 id="3-镜面反射光（Specular-Light）"><a href="#3-镜面反射光（Specular-Light）" class="headerlink" title="3. 镜面反射光（Specular Light）"></a>3. 镜面反射光（Specular Light）</h3><p>镜面反射光是光线照射到光滑表面后，按照反射定律反射的部分。其计算公式为：<br>$ I_s &#x3D; k_s \cdot I_{s_{\text{source}}} \cdot \max(0, \vec{R} \cdot \vec{V})^n $<br>其中：</p>
<ul>
<li>$ I_s $ 是镜面反射光对物体表面的贡献。</li>
<li>$ k_s $ 是物体表面对镜面反射光的反射系数，通常是一个 RGB 向量。</li>
<li>$ I_{s_{\text{source}}} $ 是光源的镜面反射强度，也是一个 RGB 向量。</li>
<li>$ \vec{R} $ 是反射光线方向向量，可以通过公式 $ \vec{R} &#x3D; 2(\vec{N} \cdot \vec{L})\vec{N} - \vec{L} $ 计算得到。</li>
<li>$ \vec{V} $ 是从物体表面点指向观察者的方向向量，需要归一化。</li>
<li>$ n $ 是高光指数，用于控制高光的锐度，数值越大，高光越集中。</li>
</ul>
<p>例如，假设光源的镜面反射强度为 $ I_{s_{\text{source}}} &#x3D; (1.0, 1.0, 1.0) $，物体表面对镜面反射光的反射系数为 $ k_s &#x3D; 0.5 $，高光指数为 $ n &#x3D; 32 $，反射光线方向向量为 $ \vec{R} &#x3D; (0, 1, 0) $，观察者方向向量为 $ \vec{V} &#x3D; (0, 1, 0) $，则镜面反射光的贡献为：<br>$ \vec{R} \cdot \vec{V} &#x3D; 1 $<br>$ I_s &#x3D; 0.5 \cdot (1.0, 1.0, 1.0) \cdot 1^{32} &#x3D; (0.5, 0.5, 0.5) $</p>
<h3 id="4-最终颜色计算"><a href="#4-最终颜色计算" class="headerlink" title="4. 最终颜色计算"></a>4. 最终颜色计算</h3><p>将上述三种光照分量相加，得到物体表面某一点的最终颜色：<br>$ I &#x3D; I_a + I_d + I_s $</p>
<p>假设物体的颜色为 $ \text{objectColor} &#x3D; (1.0, 0.5, 0.3) $，则最终颜色为：<br>$ I &#x3D; (0.02, 0.02, 0.02) + (0.5, 0.5, 0.5) + (0.5, 0.5, 0.5) $<br>$ I &#x3D; (1.02, 1.02, 1.02) $</p>
<p>由于 RGB 值的范围是 [0, 1]，因此需要将最终颜色值限制在 [0, 1] 范围内：<br>$ I &#x3D; \text{clamp}(I, 0, 1) &#x3D; (1.0, 1.0, 1.0) $</p>
<p>最终，该点的 RGB 值为 $ (1.0, 1.0, 1.0) $，表示该点在 Phong 光照模型下的颜色为白色。</p>
<h3 id="示例代码（基于-OpenGL-的片段着色器）"><a href="#示例代码（基于-OpenGL-的片段着色器）" class="headerlink" title="示例代码（基于 OpenGL 的片段着色器）"></a>示例代码（基于 OpenGL 的片段着色器）</h3><p>以下是一个简单的 OpenGL 片段着色器代码，用于计算 Phong 光照模型下的颜色：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token operator">></span><span class="token comment">// 片段着色器</span>
<span class="token operator">></span>#version <span class="token number">330</span> core
<span class="token operator">></span><span class="token keyword">out</span> <span class="token keyword">vec4</span> FragColor<span class="token punctuation">;</span>

<span class="token operator">></span><span class="token keyword">in</span> <span class="token keyword">vec3</span> FragPos<span class="token punctuation">;</span>  <span class="token comment">// 片段位置</span>
<span class="token operator">></span><span class="token keyword">in</span> <span class="token keyword">vec3</span> Normal<span class="token punctuation">;</span>  <span class="token comment">// 片段法线</span>
<span class="token operator">></span><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> lightPos<span class="token punctuation">;</span>  <span class="token comment">// 光源位置</span>
<span class="token operator">></span><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> viewPos<span class="token punctuation">;</span>   <span class="token comment">// 观察者位置</span>
<span class="token operator">></span><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> lightColor<span class="token punctuation">;</span> <span class="token comment">// 光源颜色</span>
<span class="token operator">></span><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> objectColor<span class="token punctuation">;</span> <span class="token comment">// 物体颜色</span>

<span class="token operator">></span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">></span><span class="token punctuation">&#123;</span>
   <span class="token comment">// 环境光</span>
   <span class="token keyword">float</span> ka <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> ambient <span class="token operator">=</span> ka <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

   <span class="token comment">// 漫反射</span>
   <span class="token keyword">float</span> kd <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> N <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> L <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lightPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span> NdotL <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> L<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> diffuse <span class="token operator">=</span> kd <span class="token operator">*</span> NdotL <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

   <span class="token comment">// 镜面反射</span>
   <span class="token keyword">float</span> ks <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span> shininess <span class="token operator">=</span> <span class="token number">32.0</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> V <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> R <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>L<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> specular <span class="token operator">=</span> ks <span class="token operator">*</span> spec <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

   <span class="token comment">// 最终颜色</span>
   <span class="token keyword">vec3</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span> <span class="token operator">*</span> objectColor<span class="token punctuation">;</span>
   FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">></span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h3 id="4-3-增量式光照模型"><a href="#4-3-增量式光照模型" class="headerlink" title="4.3 增量式光照模型"></a>4.3 增量式光照模型</h3><p>Phong光照明模型中光源和视点都被假定为无穷远,最后的光强计算公式就变为物体表面法向量的函数。这样对于当前流行的显示系统中用多边形表示的物体来说,它们中的每一个多边形由于法向一致,因而多边形内部像素的颜色都是相同的。</p>
<p>因此在不同法向的多边形邻接处,不仅有光强突变,而且还会产生<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%A9%AC%E8%B5%AB%E5%B8%A6%E6%95%88%E5%BA%94/2441993">马赫带效应_百度百科</a>,即人类视觉系统夸大具有不同常量光强的两个相邻区域之间的光强不连续性。</p>
<p>为了保证多边形之间的光滑过渡,使连续的多边形呈现匀称的光强分布,可采用下面将要介绍的增量式光照明模型。模型的基本思想是:在每一个多边形的顶点处,计算合适的光照明强度或其他参数;然后在各个多边形内部进行均匀插值;最后得到多边形的光滑颜色分布。它包含两种主要形式:</p>
<p><code>双线性光强插值</code>和<code>双线性法向插值</code>,又被分别称为<code>Gouraud明暗处理</code>和<code>Phong明暗处理</code>。</p>
<h4 id="双线性光强插值"><a href="#双线性光强插值" class="headerlink" title="双线性光强插值"></a>双线性光强插值</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221625464.png" alt="image-20250415221625464"> 	</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221642947.png" alt="image-20250415221642947"></p>
<h4 id="双线性法向插值"><a href="#双线性法向插值" class="headerlink" title="双线性法向插值"></a>双线性法向插值</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221721002.png" alt="image-20250415221721002"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221734937.png" alt="image-20250415221734937"></p>
<h3 id="4-4-局部光照模型"><a href="#4-4-局部光照模型" class="headerlink" title="4.4 局部光照模型"></a>4.4 局部光照模型</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221811257.png" alt="image-20250415221811257"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221825035.png" alt="image-20250415221825035"></p>
<h3 id="4-5-透射模型"><a href="#4-5-透射模型" class="headerlink" title="4.5 透射模型"></a>4.5 透射模型</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221913684.png" alt="image-20250415221913684"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250415221935097.png" alt="image-20250415221935097"></p>
<h3 id="4-6-光线追踪算法"><a href="#4-6-光线追踪算法" class="headerlink" title="4.6 光线追踪算法"></a>4.6 光线追踪算法</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29169285/article/details/117327116">自己动手实现简易光线追踪算法-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46202073/article/details/110880921">【计算机图形学】深入浅出讲解光线追踪（Ray Tracing）_cg 光线追踪-CSDN博客</a></p>
<h2 id="第五章-几何造型技术"><a href="#第五章-几何造型技术" class="headerlink" title="第五章 几何造型技术"></a>第五章 几何造型技术</h2><h3 id="5-1-贝塞尔曲线曲面"><a href="#5-1-贝塞尔曲线曲面" class="headerlink" title="5.1 贝塞尔曲线曲面"></a>5.1 贝塞尔曲线曲面</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaozhangcsdn/article/details/98963937">Bezier曲线动图讲解</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250506173812442.png" alt="image-20250506173812442"></p>
<p>设 $P0,P1$ 是平面的任意两点，则 $P0,P1$ 两点连线的<code>参数方程</code>可表示为：</p>
<p>$B1(t)&#x3D;(1−t)P0+tP1$</p>
<p>其中，$t$为参数，$t∈[0,1]$，当$t$等于0时，该点就是$P0$，当t为1时，该点为$P1$</p>
<p>曲线上任意一点 $P(t)$ 的坐标可以通过以下公式得到：</p>
<p>$P(t)&#x3D;(1 - t)P_0+tP_1$</p>
<p>展开到二维坐标，$P(t)$ 的 x 坐标和 y 坐标分别为：</p>
<p>$\begin{cases} x(t)&#x3D;(1 - t)x_0+tx_1\ y(t)&#x3D;(1 - t)y_0+ty_1 \end{cases}$</p>
<p>这里的 $(1 - t)$ 和 t 就是一次贝塞尔基本函数，分别记为 $B_{0,1}(t)&#x3D;1 - t$ 和 $B_{1,1}(t)&#x3D;t$。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/203408475">关于贝塞尔曲线的公式推导和python代码实现 - 知乎</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E6%8E%A8%E5%AF%BC%E8%BF%87%E7%A8%8B-%E8%B1%86%E5%8C%85.png" alt="贝塞尔曲线推导过程-豆包"></p>
<p>贝塞尔曲线实现代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> factorial <span class="token comment"># 这是阶乘函数</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment"># 在此处修改坐标,控制点</span>
N <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
n <span class="token operator">=</span> N <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment"># 控制点数量-1就是几次贝塞尔曲线</span>
px <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
py <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> T <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> T<span class="token operator">*</span><span class="token number">0.001</span>
    x<span class="token punctuation">,</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 贝塞尔曲线推导公式</span>
        B <span class="token operator">=</span> factorial<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">*</span>t<span class="token operator">**</span>i<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>t<span class="token punctuation">)</span><span class="token operator">**</span><span class="token punctuation">(</span>n<span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>factorial<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">*</span>factorial<span class="token punctuation">(</span>n<span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">+=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>B
        y <span class="token operator">+=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>B
    px<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    py<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>px<span class="token punctuation">,</span>py<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> points<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> points<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'r.'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>贝塞尔曲面</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> factorial
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D

<span class="token comment"># 控制点（二维数组，每个元素是一个控制点的三维坐标）</span>
points <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token comment"># 获取控制点的行数和列数</span>
rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
cols <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 计算阶数</span>
n <span class="token operator">=</span> rows <span class="token operator">-</span> <span class="token number">1</span>
m <span class="token operator">=</span> cols <span class="token operator">-</span> <span class="token number">1</span>

<span class="token comment"># 存储曲面上的点</span>
px <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
py <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
pz <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 遍历曲面上的每个点</span>
<span class="token keyword">for</span> U <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    u <span class="token operator">=</span> U <span class="token operator">*</span> <span class="token number">0.01</span>
    <span class="token keyword">for</span> V <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v <span class="token operator">=</span> V <span class="token operator">*</span> <span class="token number">0.01</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
        <span class="token comment"># 计算贝塞尔曲面公式</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
                B1 <span class="token operator">=</span> factorial<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> u <span class="token operator">**</span> i <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> u<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>factorial<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">*</span> factorial<span class="token punctuation">(</span>n <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                B2 <span class="token operator">=</span> factorial<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">*</span> v <span class="token operator">**</span> j <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> v<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> j<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>factorial<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">*</span> factorial<span class="token punctuation">(</span>m <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
                x <span class="token operator">+=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> B1 <span class="token operator">*</span> B2
                y <span class="token operator">+=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> B1 <span class="token operator">*</span> B2
                z <span class="token operator">+=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> B1 <span class="token operator">*</span> B2
        px<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        py<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        pz<span class="token punctuation">.</span>append<span class="token punctuation">(</span>z<span class="token punctuation">)</span>

<span class="token comment"># 创建3D图形</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制贝塞尔曲面</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> pz<span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制控制点</span>
control_px <span class="token operator">=</span> <span class="token punctuation">[</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> points <span class="token keyword">for</span> point <span class="token keyword">in</span> row<span class="token punctuation">]</span>
control_py <span class="token operator">=</span> <span class="token punctuation">[</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> points <span class="token keyword">for</span> point <span class="token keyword">in</span> row<span class="token punctuation">]</span>
control_pz <span class="token operator">=</span> <span class="token punctuation">[</span>point<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> points <span class="token keyword">for</span> point <span class="token keyword">in</span> row<span class="token punctuation">]</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>control_px<span class="token punctuation">,</span> control_py<span class="token punctuation">,</span> control_pz<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>

<span class="token comment"># 显示图形</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-B样条曲线曲面"><a href="#5-2-B样条曲线曲面" class="headerlink" title="5.2 B样条曲线曲面"></a>5.2 B样条曲线曲面</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250506181301188.png" alt="image-20250506181301188" style="zoom:67%;">

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/DesertCactus/p/18537880">B样条（BSpline，即 Basis Spline） - MarsCactus - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dt411f7Qj">B站贝塞尔曲线和B样条讲解</a></p>
<h2 id="大作业"><a href="#大作业" class="headerlink" title="大作业"></a>大作业</h2><p><a target="_blank" rel="noopener" href="https://www.doubao.com/thread/w4ea59255743f4494">https://www.doubao.com/thread/w4ea59255743f4494</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/straywriter/articles/15599895.html">Phong光照模型 - straywriter - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43757333/article/details/124425818">Blinn-Phong光照模型解析及其实现-CSDN博客</a></p>
<h3 id="Phong模型"><a href="#Phong模型" class="headerlink" title="Phong模型"></a>Phong模型</h3><p>Phong模型认为物体的反射光照主要由三个部分构成</p>
<ol>
<li><code>环境光</code>：物体背对光源的部分，但是仍然会有光线经过其他物体的反射<code>间接地照射</code>到物体表面，然后被人眼接收</li>
<li><code>镜面反射</code>：或者叫高光，一般是由物体的<code>光滑表面</code>完全不发散的反射到人眼中</li>
<li><code>漫反射</code>：是投射在粗糙表面上的光向各个方向反射相对平均亮度的光照到人眼</li>
</ol>
<p>从上到下依次是<code>镜面反射</code>，<code>漫反射</code>和<code>环境光</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/%E4%B8%89%E7%A7%8D%E5%85%89.png" alt="img"></p>
<p>代码实现</p>
<p><code>Vector3向量类</code>实现 - 在代码中即用来代表光强(rgb)又用来代表空间的3维向量</p>
<p>向量点积和叉积的定义是不同的，请参考以下博客<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/359975221">向量点乘与叉乘的概念及几何意义 - 知乎</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Vector3</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>

    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//构造函数，防垃圾值</span>

    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">,</span> <span class="token keyword">double</span> newY<span class="token punctuation">,</span><span class="token keyword">double</span> newZ<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        x <span class="token operator">=</span> newX<span class="token punctuation">;</span>
        y <span class="token operator">=</span> newY<span class="token punctuation">;</span>
        z <span class="token operator">=</span> newZ<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//向量加法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3 <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">+</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量减法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量数乘</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">,</span> y <span class="token operator">*</span> a<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量数除</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">/</span> a<span class="token punctuation">,</span> y <span class="token operator">/</span> a<span class="token punctuation">,</span> z <span class="token operator">/</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量点积</span>
    <span class="token keyword">double</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>z <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// https://baike.baidu.com/item/点积/9648528 点积的值可以知道两个向量角度关系</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量模长</span>
    <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">getlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>  <span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量单位化</span>
    <span class="token keyword">static</span> Vector3 <span class="token function">unitization</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> <span class="token function">getlen</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/670938197">兰伯特光照模型（漫反射） - 知乎</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// normal表示法向量</span>
Vector3 <span class="token function">calculatePhongLighting</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> hitPoint<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> normal<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> camera<span class="token punctuation">,</span> <span class="token keyword">const</span> Sphere<span class="token operator">&amp;</span> sphere<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Vector3 mixcol<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>x<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>x <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>y<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>y <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>z<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>z <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>z<span class="token punctuation">;</span>

    Vector3 ambient <span class="token operator">=</span> mixcol <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">;</span> <span class="token comment">// 环境光（0.15是环境光系数）</span>

    <span class="token comment">// 漫反射</span>
    Vector3 lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 这是打击点指向光源的方向向量</span>
    <span class="token keyword">double</span> diff <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 漫反射系数，法向量和方向向量的点积 -> 数字越大表示两个向量越像，反射的光强越大 至于为什么--https://zhuanlan.zhihu.com/p/670938197</span>
    Vector3 diffuse <span class="token operator">=</span> mixcol <span class="token operator">*</span> diff<span class="token punctuation">;</span> 

    <span class="token comment">// 镜面反射  </span>
    Vector3 viewDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>camera <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vector3 reflectDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">)</span> <span class="token operator">-</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> spec <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">pow</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>viewDir <span class="token operator">*</span> reflectDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//32是镜面高光指数   spec是镜面发射因子</span>
    Vector3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>color <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">*</span> spec<span class="token punctuation">;</span> <span class="token comment">//0.5镜面反射系数 （颜色）</span>

    <span class="token comment">// 合并颜色并限制范围</span>
    Vector3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 映射到 0-255</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>我在这里有一个小疑问：为什么在计算漫反射的时候反射系数是用<code>打击点指向光源的方向向量</code>计算，而到了镜面反射之后就是用<code>打击点指向相机的向量</code>和反射向量计算了?</p>
<p><a target="_blank" rel="noopener" href="https://www.doubao.com/thread/w72544395a6157aed">https://www.doubao.com/thread/w72544395a6157aed</a></p>
<ol>
<li><strong>漫反射的物理现象</strong></li>
</ol>
<p>漫反射发生在粗糙表面（如纸张、墙壁），光线入射后会向各个方向均匀散射。此时，观察者从任意角度看到的漫反射亮度仅取决于光源的入射角度，与观察位置无关。例如：无论从哪个方向看一张白纸，其亮度不会有明显变化，因为光线被均匀散射到了所有方向。</p>
<ol start="2">
<li><strong>数学模型中的向量选择</strong></li>
</ol>
<p>根据 Lambert 定律，漫反射强度与表面法线向量 $\vec{N}$ 和光源方向向量 $\vec{L}$ 的夹角余弦值成正比（$\vec{L}$ 通常定义为从表面点指向光源的单位向量）。公式表示为：$\text{漫反射项} &#x3D; k_d \cdot (\vec{N} \cdot \vec{L})$ 这里只需要光源方向 $\vec{L}$，因为漫反射的 “均匀性” 决定了它不依赖观察方向。即使观察者移动，表面接收到的光源入射角度不变，漫反射强度也不会改变。</p>
<ol start="3">
<li><strong>镜面反射的物理现象</strong></li>
</ol>
<p>镜面反射发生在光滑表面（如镜子、金属），光线会按照反射定律（入射角等于反射角）定向反射。此时，只有当反射光恰好指向观察者时，才能看到明亮的高光（Specular Highlight）。例如：观察镜子时，只有特定角度才能看到光源的反射像，偏离角度后高光消失。</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250609201729162.png" alt="image-20250609201729162" style="zoom:80%;">

<h3 id="光线追踪"><a href="#光线追踪" class="headerlink" title="光线追踪"></a>光线追踪</h3><p>点击链接查看和Kimi的对话 <a target="_blank" rel="noopener" href="https://www.kimi.com/share/d13dskivtfeo7d4217j0">https://www.kimi.com/share/d13dskivtfeo7d4217j0</a></p>
<h4 id="Snell定律"><a href="#Snell定律" class="headerlink" title="Snell定律"></a>Snell定律</h4><p><a target="_blank" rel="noopener" href="https://wuli.wiki/online/SNR.html">斯涅尔定律（综述） - 小时百科</a></p>
<p>入射角和折射角与法线夹角的正弦sin值之比 等于 折射率之比 <a target="_blank" rel="noopener" href="https://www.doubao.com/thread/wa4b654f88a820cd0">https://www.doubao.com/thread/wa4b654f88a820cd0</a></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/snell定律.png" alt="image-20250614194120212" style="zoom:80%;">

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 计算折射向量（Snell定律）</span>
<span class="token comment">/*
*  I : 入射光线的单位向量（从折射点指向光源）
*  N : 法向量的单位向量
*  eta_ratio : eta_ratio：折射率比值（入射介质折射率 / 折射介质折射率，例如从空气到水为 1.0/1.33）
*/</span>
<span class="token keyword">static</span> Vector3 <span class="token function">refract</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> I<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> N<span class="token punctuation">,</span> <span class="token keyword">double</span> eta_ratio<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> cosi <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>I <span class="token operator">*</span> N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 点积表示向量余弦值， clamp函数限制余弦值范围</span>
    Vector3 n <span class="token operator">=</span> N<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cosi <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// 入射向量和法向量不是同一方向的</span>
        cosi <span class="token operator">=</span> <span class="token operator">-</span>cosi<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        n <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">;</span>          <span class="token comment">// 调整法线方向</span>
        eta_ratio <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> eta_ratio<span class="token punctuation">;</span>  <span class="token comment">// 调整折射率为倒数</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">double</span> k <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> eta_ratio <span class="token operator">*</span> eta_ratio <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> cosi <span class="token operator">*</span> cosi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 全反射情况处理</span>
    <span class="token keyword">return</span> k <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>I <span class="token operator">*</span> eta_ratio <span class="token operator">+</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>eta_ratio <span class="token operator">*</span> cosi <span class="token operator">-</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong><code>光线类的定义</code></strong></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/618627358">计算机图形学知识点——光线追踪（Ray Tracing） - 知乎</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//Ray类的建立 A+t*B</span>
<span class="token keyword">class</span> <span class="token class-name">Ray</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 A<span class="token operator">=</span>camera<span class="token punctuation">;</span>  <span class="token comment">// 光线的起点</span>
    Vector3 B<span class="token punctuation">;</span>          <span class="token comment">// 光线方向向量</span>
    <span class="token keyword">float</span> t<span class="token punctuation">;</span>            <span class="token comment">// 代表光线上的一点，任意一点可以通过 A + B * t 计算得到。</span>

    <span class="token function">Ray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//构造函数，防垃圾值</span>

    <span class="token function">Ray</span><span class="token punctuation">(</span>Vector3 newA<span class="token punctuation">,</span> Vector3 newB<span class="token punctuation">,</span> <span class="token keyword">float</span> newt<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>newA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span>newB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span>newt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        A <span class="token operator">=</span> newA<span class="token punctuation">;</span>
        B <span class="token operator">=</span> newB<span class="token punctuation">;</span>
        B <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t <span class="token operator">=</span> newt<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// Vector3 ProjectivePoint(float t)const//得到射影点</span>
    <span class="token comment">// &#123;</span>
    <span class="token comment">//     return A +  B * t;</span>
    <span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="判断光线和物体碰撞"><a href="#判断光线和物体碰撞" class="headerlink" title="判断光线和物体碰撞"></a>判断光线和物体碰撞</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/Kimi 2025-06-09.jpg" alt="Kimi 2025-06-09" style="zoom: 50%;">

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">if_Hit</span><span class="token punctuation">(</span>Vector3 center<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">,</span> Ray ray<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> a <span class="token operator">=</span> ray<span class="token punctuation">.</span>B <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">;</span>
    <span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span> <span class="token operator">-</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>

    <span class="token keyword">double</span> delta <span class="token operator">=</span> b <span class="token operator">*</span> b <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> a <span class="token operator">*</span> c<span class="token punctuation">;</span> <span class="token comment">// 判别式用于判断二次方程是否有实根。如果 delta≥0，则方程有实根，表明光线与球体相交</span>

    <span class="token comment">// 使用求根公式计算两个根 x1 和 x2，代表光线与球体相交的两个参数值</span>
    <span class="token keyword">float</span> x1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">+</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> x2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">-</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 选择较小的根 t（因为光线是从起点向外延伸的，较小的根表示更近的交点）。</span>
	<span class="token comment">// 如果较小的根 t≤0，则检查较大的根是否大于 0，如果是，则使用较大的根。表示至少有一个交点是在视线中的</span>
    <span class="token keyword">float</span> t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">&lt;</span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>delta <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>t<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="光线追踪的阴影处理"><a href="#光线追踪的阴影处理" class="headerlink" title="光线追踪的阴影处理"></a>光线追踪的阴影处理</h4><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// ===== 场景管理类 =====</span>
<span class="token keyword">class</span> <span class="token class-name">Scene</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Object<span class="token operator">*</span><span class="token operator">></span> objects<span class="token punctuation">;</span>      <span class="token comment">// 场景中的物体列表</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Light<span class="token operator">></span> lights<span class="token punctuation">;</span>         <span class="token comment">// 场景中的光源列表</span>
    Vector3 backgroundColor<span class="token punctuation">;</span>          <span class="token comment">// 背景颜色</span>
    <span class="token keyword">int</span> maxDepth<span class="token punctuation">;</span>                      <span class="token comment">// 光线追踪最大递归深度</span>

    <span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">backgroundColor</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token operator">~</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 释放所有物体内存</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> obj <span class="token operator">:</span> objects<span class="token punctuation">)</span>
            <span class="token keyword">delete</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>Object<span class="token operator">*</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> objects<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">addLight</span><span class="token punctuation">(</span><span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> lights<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token comment">// 检测光线与场景中物体的相交 intersect 函数返回最近交点的距离 t 和物体指针 hitObject，是光线追踪的基础函数</span>
    <span class="token keyword">bool</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Ray<span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> t<span class="token punctuation">,</span> Object<span class="token operator">*</span><span class="token operator">&amp;</span> hitObject<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        t <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化为无穷大</span>
        hitObject <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历所有物体，寻找最近的交点</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> obj <span class="token operator">:</span> objects<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">double</span> currentT <span class="token operator">=</span> t<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token operator">-></span><span class="token function">intersect</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> currentT<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> currentT <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                t <span class="token operator">=</span> currentT<span class="token punctuation">;</span>
                hitObject <span class="token operator">=</span> obj<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> hitObject <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 阴影检测：判断点是否在光源的阴影中</span>
    <span class="token comment">/*
     *
     *  判断阴影条件
     *  点光源：若射线与物体相交，比较交点距离 t 与光源距离 lightDist。若 t &lt; lightDist，说明物体在光源之前，point 于阴影中
     *  方向光：方向光被视为无限远，只要射线与任何物体相交，即认为 point 处于阴影中
     *
     */</span>
    <span class="token keyword">bool</span> <span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> point<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        Vector3 lightDir<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>type <span class="token operator">==</span> POINT_LIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 点光源方向</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 方向光方向</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 偏移起点避免浮点误差导致的自相交</span>
        Ray <span class="token function">shadowRay</span><span class="token punctuation">(</span>point <span class="token operator">+</span> lightDir <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> lightDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> t<span class="token punctuation">;</span>
        Object<span class="token operator">*</span> hitObject<span class="token punctuation">;</span>

        <span class="token comment">// 射线检测：调用 intersect 函数检测射线是否与场景中的物体相交。若不相交，直接返回 false（无阴影）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intersect</span><span class="token punctuation">(</span>shadowRay<span class="token punctuation">,</span> t<span class="token punctuation">,</span> hitObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 点光源需要判断交点是否在光源之前</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>type <span class="token operator">==</span> POINT_LIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">double</span> lightDist <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">getlen</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> t <span class="token operator">&lt;</span> lightDist<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 方向光只要相交即处于阴影</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="抗锯齿采样"><a href="#抗锯齿采样" class="headerlink" title="抗锯齿采样"></a>抗锯齿采样</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/379219516">图形学中的抗锯齿方法简谈 - 知乎</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QImage></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLabel></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPixmap></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QColor></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//向量类的创建（运算法则）</span>
<span class="token keyword">class</span> <span class="token class-name">Vector3</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>

    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//构造函数，防垃圾值</span>

    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">,</span> <span class="token keyword">double</span> newY<span class="token punctuation">,</span><span class="token keyword">double</span> newZ<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        x <span class="token operator">=</span> newX<span class="token punctuation">;</span>
        y <span class="token operator">=</span> newY<span class="token punctuation">;</span>
        z <span class="token operator">=</span> newZ<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//向量加法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3 <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">+</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量减法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量数乘</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">,</span> y <span class="token operator">*</span> a<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量数除</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">/</span> a<span class="token punctuation">,</span> y <span class="token operator">/</span> a<span class="token punctuation">,</span> z <span class="token operator">/</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量点积</span>
    <span class="token keyword">double</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span><span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>z <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// https://baike.baidu.com/item/点积/9648528 点积的值可以知道两个向量角度关系</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量模长</span>
    <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">getlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>  <span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//向量单位化</span>
    <span class="token keyword">static</span> Vector3 <span class="token function">unitization</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> <span class="token function">getlen</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//光屏平面的位置</span>
<span class="token keyword">static</span> <span class="token keyword">double</span> z<span class="token operator">=</span><span class="token number">500.0</span><span class="token punctuation">;</span>
<span class="token comment">//摄像机位置(A)</span>
<span class="token keyword">static</span> Vector3 <span class="token function">camera</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//Sphere类的创建</span>
<span class="token keyword">class</span> <span class="token class-name">Sphere</span>  <span class="token comment">// 球类</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 center<span class="token punctuation">;</span>
    <span class="token keyword">double</span> radius<span class="token punctuation">;</span>
    Vector3 color<span class="token punctuation">;</span> <span class="token comment">// 球体颜色</span>

    <span class="token function">Sphere</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">center</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">radius</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 构造函数，防垃圾值</span>

    <span class="token function">Sphere</span><span class="token punctuation">(</span>Vector3 newCenter<span class="token punctuation">,</span> <span class="token keyword">double</span> newRadius<span class="token punctuation">,</span> Vector3 newColor<span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">center</span><span class="token punctuation">(</span>newCenter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">radius</span><span class="token punctuation">(</span>newRadius<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">color</span><span class="token punctuation">(</span>newColor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 赋值构造函数</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//light（光源）类的建立</span>
<span class="token keyword">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">&#123;</span>
    Vector3 position<span class="token punctuation">;</span> <span class="token comment">// 光源位置</span>
    Vector3 color<span class="token punctuation">;</span>    <span class="token comment">// 光源颜色（通常为 RGB 值）</span>
    <span class="token keyword">double</span> intensity<span class="token punctuation">;</span> <span class="token comment">// 光源强度（可选，用于控制光照强度）</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//引入冯氏光照模型 phong(返回计算出的物体表面光照效果颜色)</span>
<span class="token comment">// normal 法向量</span>
Vector3 <span class="token function">calculatePhongLighting</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> hitPoint<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> normal<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> camera<span class="token punctuation">,</span> <span class="token keyword">const</span> Sphere<span class="token operator">&amp;</span> sphere<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Vector3 mixcol<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>x<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>x <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>y<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>y <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>z<span class="token operator">=</span>light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>z <span class="token operator">*</span> sphere<span class="token punctuation">.</span>color<span class="token punctuation">.</span>z<span class="token punctuation">;</span>

    Vector3 ambient <span class="token operator">=</span> mixcol <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">;</span> <span class="token comment">// 环境光（0.15是环境光系数）</span>

    <span class="token comment">// 漫反射</span>
    Vector3 lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 这是打击点 指向光源的方向向量</span>
    <span class="token keyword">double</span> diff <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//漫反射系数，点积的数值越大，两个向量越像，漫反射光强越大</span>
    Vector3 diffuse <span class="token operator">=</span> mixcol <span class="token operator">*</span> diff<span class="token punctuation">;</span>

    <span class="token comment">// 镜面反射</span>
    Vector3 viewDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>camera <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打击点指向相机</span>
    Vector3 reflectDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">)</span> <span class="token operator">-</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> spec <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">pow</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>viewDir <span class="token operator">*</span> reflectDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//32是镜面高光指数   spec是镜面发射因子</span>
    Vector3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>color <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">*</span> spec<span class="token punctuation">;</span> <span class="token comment">//0.5镜面反射系数 （颜色）</span>

    <span class="token comment">// 合并颜色并限制范围</span>
    Vector3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 映射到 0-255</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//Ray类的建立 A+t*B</span>
<span class="token keyword">class</span> <span class="token class-name">Ray</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 A<span class="token operator">=</span>camera<span class="token punctuation">;</span>  <span class="token comment">// 光线的起点</span>
    Vector3 B<span class="token punctuation">;</span>          <span class="token comment">// 光线方向向量</span>
    <span class="token keyword">float</span> t<span class="token punctuation">;</span>            <span class="token comment">// 代表光线上的一点，任意一点可以通过 A + B * t 计算得到。</span>

    <span class="token function">Ray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//构造函数，防垃圾值</span>

    <span class="token function">Ray</span><span class="token punctuation">(</span>Vector3 newA<span class="token punctuation">,</span> Vector3 newB<span class="token punctuation">,</span> <span class="token keyword">float</span> newt<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>newA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span>newB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span>newt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        A <span class="token operator">=</span> newA<span class="token punctuation">;</span>
        B <span class="token operator">=</span> newB<span class="token punctuation">;</span>
        B <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t <span class="token operator">=</span> newt<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    Vector3 <span class="token function">ProjectivePoint</span><span class="token punctuation">(</span><span class="token keyword">float</span> t<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token comment">//得到射影点</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> A <span class="token operator">+</span>  B <span class="token operator">*</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">// 平面地面的光照计算</span>
Vector3 <span class="token function">calculateGroundLighting</span><span class="token punctuation">(</span><span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">const</span> Light <span class="token operator">&amp;</span>light<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Vector3 <span class="token function">groundColor</span><span class="token punctuation">(</span><span class="token number">100.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 地面颜色</span>
    Vector3 <span class="token function">normal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 地面法线始终向上</span>

    Vector3 mixcol<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>x <span class="token operator">=</span> light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>x <span class="token operator">*</span> groundColor<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>y <span class="token operator">=</span> light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>y <span class="token operator">*</span> groundColor<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    mixcol<span class="token punctuation">.</span>z <span class="token operator">=</span> light<span class="token punctuation">.</span>color<span class="token punctuation">.</span>z <span class="token operator">*</span> groundColor<span class="token punctuation">.</span>z<span class="token punctuation">;</span>

    Vector3 ambient <span class="token operator">=</span> mixcol <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">;</span> <span class="token comment">// 环境光</span>

    <span class="token comment">// 漫反射</span>
    Vector3 lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> diff <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vector3 diffuse <span class="token operator">=</span> mixcol <span class="token operator">*</span> diff<span class="token punctuation">;</span>

    <span class="token comment">// 地面没有镜面反射</span>
    Vector3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//光线撞击相关函数</span>
<span class="token comment">//是否撞击的判断</span>
<span class="token comment">// center：球体的中心位置。 radius：球体的半径。 ray：表示光线，包含起点（A）、方向向量（B）和参数（t）。</span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">if_Hit</span><span class="token punctuation">(</span>Vector3 center<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">,</span> Ray ray<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> a <span class="token operator">=</span> ray<span class="token punctuation">.</span>B <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">;</span>
    <span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span> <span class="token operator">-</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>

    <span class="token keyword">double</span> delta <span class="token operator">=</span> b <span class="token operator">*</span> b <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> a <span class="token operator">*</span> c<span class="token punctuation">;</span> <span class="token comment">// 判别式用于判断二次方程是否有实根。如果 delta≥0，则方程有实根，表明光线与球体相交</span>

    <span class="token comment">// 使用求根公式计算两个根 x1 和 x2，代表光线与球体相交的两个参数值</span>
    <span class="token keyword">float</span> x1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">+</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> x2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">-</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 选择较小的根 t（因为光线是从起点向外延伸的，较小的根表示更近的交点）。</span>
    <span class="token comment">// 如果较小的根 t≤0，则检查较大的根是否大于 0，如果是，则使用较大的根。表示至少有一个交点是在视线中的</span>
    <span class="token keyword">float</span> t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">&lt;</span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>delta <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>t<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假如t&lt;0表示交点在视线射线的(人)背后方向，delta是二元一次方程求根公式</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//求解撞击法向量，并线性变换得到rgb编码(但是我就不判断撞不撞击了，使用时需要在前面加一个if（bool if_Hit）判断)</span>
<span class="token keyword">static</span> Vector3 <span class="token function">where_Hit</span><span class="token punctuation">(</span>Vector3 center<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">,</span> Ray ray<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    ray<span class="token punctuation">.</span>B<span class="token operator">=</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span> <span class="token function">unitization</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> a <span class="token operator">=</span> ray<span class="token punctuation">.</span>B <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">;</span>
    <span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B <span class="token operator">*</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span>center<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>A<span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">-</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>

    <span class="token keyword">float</span> delta <span class="token operator">=</span> b <span class="token operator">*</span> b <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> a <span class="token operator">*</span> c<span class="token punctuation">;</span>

    <span class="token keyword">float</span> x1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">+</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> x2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token operator">-</span><span class="token function">sqrt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">&lt;</span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        t<span class="token operator">=</span><span class="token punctuation">(</span>x1<span class="token operator">></span>x2<span class="token operator">?</span>x1<span class="token operator">:</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        Vector3 Lawline<span class="token operator">=</span>ray<span class="token punctuation">.</span>A<span class="token operator">+</span>ray<span class="token punctuation">.</span>B<span class="token operator">*</span>t<span class="token operator">-</span>center<span class="token punctuation">;</span>

        <span class="token comment">//引入phong应该不需要rgb转化了，这是之前为了便于验证的代码</span>

        <span class="token comment">// Lawline=Vector3::unitization(Lawline);//单位化</span>

        <span class="token comment">// Lawline = (Lawline + Vector3(1, 1, 1)) / 2;</span>
        <span class="token comment">// Lawline = Lawline * 255;//向0~255作线性映射(为了颜色好看，改了一下，可能以后变数据会出问题，注意一下)</span>

        <span class="token keyword">return</span> Lawline<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        Vector3 black<span class="token operator">=</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> black<span class="token punctuation">;</span>


        <span class="token comment">// Vector3 Lawline=ray.A+ray.B*t-center;</span>

        <span class="token comment">// Lawline=Vector3::unitization(Lawline);//单位化</span>

        <span class="token comment">// Vector3 Unit(1,1,1);</span>
        <span class="token comment">// Lawline=(Lawline+Unit)/2*255;//向0~255作线性映射(为了颜色好看，改了一下，可能以后变数据会出问题，注意一下)</span>

        <span class="token comment">// return Lawline;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span class="token comment">//多重取样 抗锯齿（采用phong后）【对于地面球】</span>
<span class="token comment">/*
使用双重循环进行 2x2 采样：newx 和 newy：计算当前采样点在视口中的坐标。
    创建光线 ray，起点为相机位置，方向向量指向采样点。
    判断光线与球体相交
    调用 if_Hit 判断光线是否与球体相交：
如果相交：
        计算相交点 hitPoint。
        计算法线向量 normal。
        调用 calculatePhongLighting 计算光照效果，并存储颜色。
如果不相交：
    使用背景颜色填充采样颜色。
处理采样结果
    如果所有采样点都未命中球体，返回特殊值 (-1, -1, -1)。
否则：
    计算所有采样颜色的平均值。
    将颜色值限制在 [0.0, 255.0] 范围内。
    返回平均颜色。
 */</span>
Vector3 <span class="token function">multisample</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">const</span> Sphere<span class="token operator">&amp;</span> sphere<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> sample <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 采样数量</span>
    Vector3 sample_color<span class="token punctuation">[</span>sample <span class="token operator">*</span> sample<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sample<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sample<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">float</span> newx <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample<span class="token punctuation">;</span>
            <span class="token keyword">float</span> newy <span class="token operator">=</span> y <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample<span class="token punctuation">;</span>

            Ray <span class="token function">ray</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>newx<span class="token punctuation">,</span> newy<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">if_Hit</span><span class="token punctuation">(</span>sphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                Vector3 hitPoint <span class="token operator">=</span> <span class="token function">where_Hit</span><span class="token punctuation">(</span>sphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Vector3 normal <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>hitPoint <span class="token operator">-</span> sphere<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
                sample_color<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">calculatePhongLighting</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span> normal<span class="token punctuation">,</span> light<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> sphere<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
                sample_color<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">135</span> <span class="token operator">+</span> <span class="token number">120</span> <span class="token operator">*</span> y <span class="token operator">/</span> <span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">206</span> <span class="token operator">+</span> <span class="token number">50</span> <span class="token operator">*</span> y <span class="token operator">/</span> <span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 背景颜色</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span>sample<span class="token operator">*</span>sample<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        Vector3 average_color <span class="token operator">=</span> sample_color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sample <span class="token operator">*</span> sample<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            average_color <span class="token operator">=</span> average_color <span class="token operator">+</span> sample_color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        average_color <span class="token operator">=</span> average_color <span class="token operator">/</span> <span class="token punctuation">(</span>sample <span class="token operator">*</span> sample<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 平均颜色后(ai生成的限制范围的方式)</span>
        average_color<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        average_color<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        average_color<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> average_color<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*
static Vector3 multisample(double x,double y,Sphere R)
&#123;
    const int sample=2;
    Vector3 sample_point[sample*sample];
    int n=0;
    for(int i=0;i&lt;sample;i++)
    &#123;
        for(int j=0;j&lt;sample;j++)
        &#123;
            // float newx=x-0.5+i;
            // float newy=y-0.5+j;

            float newx = x - 0.5 + (i + 0.5) / sample;
            float newy = y - 0.5 + (j + 0.5) / sample;


            // float newx=x-0.5+4/sample/sample*i;
            // float newy=y-0.5+4/sample/sample*j;

            Ray Hit_R(camera, Vector3(newx, newy, z),0);//0是随意赋的值，无实义

            bool flag=if_Hit(R.center,R.radius,Hit_R);

            if(flag)
            &#123;
                sample_point[n]=where_Hit(R.center,R.radius,Hit_R);
                n++;
            &#125;
            else

            &#123;
                double px=(x-camera.x+800/2);
                double py=(y-camera.y+600/2);
                sample_point[n]=Vector3(135+120*py/601,206+50*py/601,255);
                n++;
            &#125;//对2*2个样本点实现了采集
        &#125;
    &#125;//对2*2个样本点实现了采集
    Vector3 average=sample_point[0];
    for(int i=1;i&lt;sample*sample;i++)
    &#123;
        average=average+sample_point[i];
    &#125;
    average=average/sample/sample;

    //ai搜到的，防止越界的函数
    average.x = std::clamp((float)average.x, 0.0f, 255.0f);
    average.y = std::clamp((float)average.y, 0.0f, 255.0f);
    average.z = std::clamp((float)average.z, 0.0f, 255.0f);

    return average;
&#125;
*/</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//多重取样 抗锯齿（采用phong后）【对于地上球】</span>
<span class="token comment">/*
 * x 和 y：当前像素的坐标。
 *
 *
 */</span>
Vector3 <span class="token function">multisample2</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">,</span> <span class="token keyword">const</span> Sphere<span class="token operator">&amp;</span> sphere<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">,</span><span class="token keyword">const</span> Sphere<span class="token operator">&amp;</span> groundsphere<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> sample <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 采样数量</span>
    Vector3 sample_color<span class="token punctuation">[</span>sample <span class="token operator">*</span> sample<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sample<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sample<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">float</span> newx <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample<span class="token punctuation">;</span>
            <span class="token keyword">float</span> newy <span class="token operator">=</span> y <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> sample<span class="token punctuation">;</span>

            Ray <span class="token function">ray</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>newx<span class="token punctuation">,</span> newy<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 整个画面是  右x 上y 向屏幕里面z</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">if_Hit</span><span class="token punctuation">(</span>sphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                Vector3 hitPoint <span class="token operator">=</span> <span class="token function">where_Hit</span><span class="token punctuation">(</span>sphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Vector3 normal <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>hitPoint <span class="token operator">-</span> sphere<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
                sample_color<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">calculatePhongLighting</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span> normal<span class="token punctuation">,</span> light<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> sphere<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">if_Hit</span><span class="token punctuation">(</span>groundsphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> groundsphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    count1<span class="token operator">++</span><span class="token punctuation">;</span>
                    Vector3 hitPoint <span class="token operator">=</span> <span class="token function">where_Hit</span><span class="token punctuation">(</span>groundsphere<span class="token punctuation">.</span>center<span class="token punctuation">,</span> groundsphere<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> ray<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    Vector3 normal <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>hitPoint <span class="token operator">-</span> groundsphere<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sample_color<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">calculatePhongLighting</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span> normal<span class="token punctuation">,</span> light<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> groundsphere<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">&#123;</span>
                    count2<span class="token operator">++</span><span class="token punctuation">;</span>
                    sample_color<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">135</span> <span class="token operator">+</span> <span class="token number">120</span> <span class="token operator">*</span> y <span class="token operator">/</span> <span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">206</span> <span class="token operator">+</span> <span class="token number">50</span> <span class="token operator">*</span> y <span class="token operator">/</span> <span class="token number">301</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 背景颜色</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">if</span><span class="token punctuation">(</span>count1<span class="token operator">==</span>sample<span class="token operator">*</span>sample<span class="token operator">||</span>count2<span class="token operator">==</span>sample<span class="token operator">*</span>sample<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        Vector3 average_color <span class="token operator">=</span> sample_color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sample <span class="token operator">*</span> sample<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            average_color <span class="token operator">=</span> average_color <span class="token operator">+</span> sample_color<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        average_color <span class="token operator">=</span> average_color <span class="token operator">/</span> <span class="token punctuation">(</span>sample <span class="token operator">*</span> sample<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 平均颜色后(ai生成的限制范围的方式)</span>
        average_color<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        average_color<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        average_color<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>average_color<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> average_color<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">//窗口，输出一张图片</span>
<span class="token keyword">class</span> <span class="token class-name">ImageWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token keyword">override</span>
    <span class="token punctuation">&#123;</span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建一个 401x301 的 QImage，并初始化为白色</span>
        QImage <span class="token function">image</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token number">301</span><span class="token punctuation">,</span> QImage<span class="token double-colon punctuation">::</span>Format_RGB32<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//修改图片大小的时候记得回到multisample更改一下</span>
        image<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 可选：设置初始背景颜色</span>

        <span class="token comment">// 将每个像素点设置为渐变青</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> x <span class="token operator">&lt;</span>image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                QColor <span class="token function">color</span><span class="token punctuation">(</span><span class="token number">135</span><span class="token operator">+</span><span class="token number">120</span><span class="token operator">*</span>y<span class="token operator">/</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">206</span><span class="token operator">+</span><span class="token number">50</span><span class="token operator">*</span>y<span class="token operator">/</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 渐变青</span>
                image<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token punctuation">.</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>


        Light light<span class="token punctuation">;</span>
        light<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">255.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暖色调光源</span>
        light<span class="token punctuation">.</span>intensity<span class="token operator">=</span><span class="token number">500.0</span><span class="token punctuation">;</span>

        <span class="token comment">// 建立地面球R0（</span>
        Sphere <span class="token function">R0</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1800</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1800.0</span><span class="token punctuation">,</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token comment">// 世界坐标系转化</span>
                <span class="token keyword">double</span> true_x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>camera<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>
                <span class="token keyword">double</span> true_y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>camera<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>y<span class="token punctuation">;</span>

                Vector3 color0 <span class="token operator">=</span> <span class="token function">multisample</span><span class="token punctuation">(</span>true_x<span class="token punctuation">,</span> true_y<span class="token punctuation">,</span> R0<span class="token punctuation">,</span> light<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>color0<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> color0<span class="token punctuation">.</span>y <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> color0<span class="token punctuation">.</span>z <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    image<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">QColor</span><span class="token punctuation">(</span>color0<span class="token punctuation">.</span>x<span class="token punctuation">,</span> color0<span class="token punctuation">.</span>y<span class="token punctuation">,</span> color0<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// // 地面颜色计算</span>
        <span class="token comment">// for (int y =image.height()*3/5; y &lt;image.height() ; ++y)</span>
        <span class="token comment">// &#123;</span>
        <span class="token comment">//     Vector3 groundColor = calculateGroundLighting(y, light);</span>
        <span class="token comment">//     for (int x = 0; x &lt; image.width(); ++x)</span>
        <span class="token comment">//     &#123;</span>
        <span class="token comment">//         image.setPixel(x, y, QColor(groundColor.x, groundColor.y, groundColor.z).rgb());</span>
        <span class="token comment">//     &#125;</span>
        <span class="token comment">// &#125;</span>


        <span class="token comment">//建立球R1</span>
        Sphere <span class="token function">R1</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 绿色球</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> x <span class="token operator">&lt;</span>image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token comment">//世界坐标系转化</span>
                <span class="token keyword">double</span> true_x<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>camera<span class="token punctuation">.</span>x<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0f</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>
                <span class="token keyword">double</span> true_y<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>camera<span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0f</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>y<span class="token punctuation">;</span>

                <span class="token comment">// Ray Hit_R1(camera,Vector3(true_x,true_y,z),0);//0是随意赋的值，无实义</span>
                <span class="token comment">// bool flag=if_Hit(R1.center,R1.radius,Hit_R1);</span>
                <span class="token comment">// if(flag)</span>
                <span class="token comment">// &#123;</span>
                <span class="token comment">//     Vector3 point=multisample(true_x,true_y,R1);</span>

                <span class="token comment">//     QColor color2(point.x,point.y,point.z);</span>

                Vector3 color <span class="token operator">=</span> <span class="token function">multisample2</span><span class="token punctuation">(</span>true_x<span class="token punctuation">,</span> true_y<span class="token punctuation">,</span> R1<span class="token punctuation">,</span> light<span class="token punctuation">,</span>R0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>x<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>color<span class="token punctuation">.</span>y<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>color<span class="token punctuation">.</span>z<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    image<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">QColor</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>x<span class="token punctuation">,</span> color<span class="token punctuation">.</span>y<span class="token punctuation">,</span> color<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//渲染球体</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 绘制图像到窗口</span>
        painter<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    ImageWidget widget<span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span>  <span class="token number">301</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置窗口大小</span>
    widget<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="新版代码"><a href="#新版代码" class="headerlink" title="新版代码"></a>新版代码</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QImage></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLabel></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPixmap></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QColor></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMouseEvent></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QKeyEvent></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QTimer></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random></span></span>

<span class="token comment">// ===== 数学基础：三维向量类 =====</span>
<span class="token keyword">class</span> <span class="token class-name">Vector3</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>  <span class="token comment">// 三维向量的三个分量</span>

    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">,</span> <span class="token keyword">double</span> newY<span class="token punctuation">,</span> <span class="token keyword">double</span> newZ<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>newX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>newY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">z</span><span class="token punctuation">(</span>newZ<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token comment">// 向量基本运算重载</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">+</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token comment">// 向量加法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>  <span class="token comment">// 向量减法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">,</span> y <span class="token operator">*</span> a<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>              <span class="token comment">// 向量与标量乘法</span>
    Vector3 <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">/</span> a<span class="token punctuation">,</span> y <span class="token operator">/</span> a<span class="token punctuation">,</span> z <span class="token operator">/</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>              <span class="token comment">// 向量与标量除法</span>
    <span class="token keyword">double</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">+</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>         <span class="token comment">// 向量点积（返回标量）</span>

    <span class="token comment">// 逐元素相乘（Hadamard乘积），用于颜色混合</span>
    Vector3 <span class="token function">hadamard</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 向量叉积，用于计算法向量和相机坐标系</span>
    Vector3 <span class="token function">cross</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector3</span><span class="token punctuation">(</span>y <span class="token operator">*</span> a<span class="token punctuation">.</span>z <span class="token operator">-</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">,</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 向量工具函数</span>
    <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">getlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>         <span class="token comment">// 计算向量长度</span>
    <span class="token keyword">static</span> Vector3 <span class="token function">unitization</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> a <span class="token operator">/</span> <span class="token function">getlen</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>     <span class="token comment">// 向量归一化</span>
    <span class="token keyword">static</span> Vector3 <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> I<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> N<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token comment">// 计算反射向量</span>
        <span class="token keyword">return</span> I <span class="token operator">-</span> N <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>I <span class="token operator">*</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// I表示入射光线，N表示法向量</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 计算折射向量（Snell定律）</span>
    <span class="token comment">/*
     *  I : 入射光线的单位向量（从折射点指向光源）
     *  N : 法向量的单位向量
     *  eta_ratio : eta_ratio：折射率比值（入射介质折射率 / 折射介质折射率，例如从空气到水为 1.0/1.33）
     */</span>
    <span class="token keyword">static</span> Vector3 <span class="token function">refract</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> I<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> N<span class="token punctuation">,</span> <span class="token keyword">double</span> eta_ratio<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">double</span> cosi <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>I <span class="token operator">*</span> N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 点积表示向量余弦值， clamp函数限制余弦值范围</span>
        Vector3 n <span class="token operator">=</span> N<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cosi <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// 入射向量和法向量不是同一方向的</span>
            cosi <span class="token operator">=</span> <span class="token operator">-</span>cosi<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            n <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">;</span>          <span class="token comment">// 调整法线方向</span>
            eta_ratio <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> eta_ratio<span class="token punctuation">;</span>  <span class="token comment">// 调整折射率为倒数</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">double</span> k <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> eta_ratio <span class="token operator">*</span> eta_ratio <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> cosi <span class="token operator">*</span> cosi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 全反射情况处理</span>
        <span class="token keyword">return</span> k <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>I <span class="token operator">*</span> eta_ratio <span class="token operator">+</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>eta_ratio <span class="token operator">*</span> cosi <span class="token operator">-</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 场景元素定义 =====</span>
<span class="token comment">// 光源类型枚举</span>
<span class="token keyword">enum</span> <span class="token class-name">LightType</span> <span class="token punctuation">&#123;</span>
    POINT_LIGHT<span class="token punctuation">,</span>      <span class="token comment">// 点光源（从一点向四周发射光线）</span>
    DIRECTIONAL_LIGHT <span class="token comment">// 方向光（平行光，如太阳光）</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 光源结构体</span>
<span class="token keyword">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">&#123;</span>
    LightType type<span class="token punctuation">;</span>         <span class="token comment">// 光源类型</span>
    Vector3 position<span class="token punctuation">;</span>       <span class="token comment">// 点光源位置 / 方向光方向向量</span>
    Vector3 color<span class="token punctuation">;</span>          <span class="token comment">// 光源颜色</span>
    <span class="token keyword">double</span> intensity<span class="token punctuation">;</span>       <span class="token comment">// 光源强度</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 材质属性结构体（定义物体表面光学特性）</span>
<span class="token keyword">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">&#123;</span>
    Vector3 ambient<span class="token punctuation">;</span>        <span class="token comment">// 环境光反射系数</span>
    Vector3 diffuse<span class="token punctuation">;</span>        <span class="token comment">// 漫反射系数</span>
    Vector3 specular<span class="token punctuation">;</span>       <span class="token comment">// 镜面反射系数</span>
    <span class="token keyword">double</span> shininess<span class="token punctuation">;</span>       <span class="token comment">// 光泽度（控制高光范围） 控制镜面反射高光的大小和锐利程度。值越大，高光越集中、越亮；值越小，高光越分散、越模糊。</span>
    <span class="token keyword">double</span> reflectivity<span class="token punctuation">;</span>    <span class="token comment">// 反射率 控制物体表面反射周围环境的能力，即镜面反射光线的比例。</span>
    <span class="token keyword">double</span> transparency<span class="token punctuation">;</span>    <span class="token comment">// 透明度</span>
    <span class="token keyword">double</span> refractiveIndex<span class="token punctuation">;</span> <span class="token comment">// 折射率</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 光线定义 =====</span>
<span class="token keyword">class</span> <span class="token class-name">Ray</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 A<span class="token punctuation">;</span>  <span class="token comment">// 光线起点</span>
    Vector3 B<span class="token punctuation">;</span>  <span class="token comment">// 光线方向（已归一化）</span>
    <span class="token keyword">float</span> t<span class="token punctuation">;</span>    <span class="token comment">// 光线参数</span>

    <span class="token function">Ray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token function">Ray</span><span class="token punctuation">(</span>Vector3 newA<span class="token punctuation">,</span> Vector3 newB<span class="token punctuation">,</span> <span class="token keyword">float</span> newt<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">A</span><span class="token punctuation">(</span>newA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>newB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">t</span><span class="token punctuation">(</span>newt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token comment">// 计算光线上参数t处的点</span>
    Vector3 <span class="token function">ProjectivePoint</span><span class="token punctuation">(</span><span class="token keyword">float</span> t<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> A <span class="token operator">+</span> B <span class="token operator">*</span> t<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 场景物体基类 =====</span>
<span class="token keyword">class</span> <span class="token class-name">Object</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Material material<span class="token punctuation">;</span>  <span class="token comment">// 物体材质</span>

    <span class="token function">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

    <span class="token comment">// 纯虚函数：检测光线与物体是否相交</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">class</span> <span class="token class-name">Ray</span><span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// 纯虚函数：获取物体表面法向量</span>
    <span class="token keyword">virtual</span> Vector3 <span class="token function">getNormal</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> point<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 球体类（继承自物体基类）=====</span>
<span class="token keyword">class</span> <span class="token class-name">Sphere</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Object</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 center<span class="token punctuation">;</span>  <span class="token comment">// 球心位置</span>
    <span class="token keyword">double</span> radius<span class="token punctuation">;</span>   <span class="token comment">// 球体半径</span>

    <span class="token function">Sphere</span><span class="token punctuation">(</span>Vector3 newCenter<span class="token punctuation">,</span> <span class="token keyword">double</span> newRadius<span class="token punctuation">,</span> Material mat<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">center</span><span class="token punctuation">(</span>newCenter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">radius</span><span class="token punctuation">(</span>newRadius<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        material <span class="token operator">=</span> mat<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 光线与球体相交检测（使用二次方程求解），判断是否相交就是求Δ判别式</span>
    <span class="token keyword">bool</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Ray<span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        Vector3 oc <span class="token operator">=</span> ray<span class="token punctuation">.</span>A <span class="token operator">-</span> center<span class="token punctuation">;</span>         <span class="token comment">// 光线起点到球心的向量</span>
        <span class="token keyword">double</span> a <span class="token operator">=</span> ray<span class="token punctuation">.</span>B <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">;</span>            <span class="token comment">// 二次项系数</span>
        <span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>oc <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 一次项系数</span>
        <span class="token keyword">double</span> c <span class="token operator">=</span> oc <span class="token operator">*</span> oc <span class="token operator">-</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span> <span class="token comment">// 常数项</span>
        <span class="token keyword">double</span> discriminant <span class="token operator">=</span> b <span class="token operator">*</span> b <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> a <span class="token operator">*</span> c<span class="token punctuation">;</span> <span class="token comment">// 判别式</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>discriminant <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 无实根，不相交</span>

        <span class="token keyword">double</span> sqrtDisc <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>discriminant<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> t1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>b <span class="token operator">-</span> sqrtDisc<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第一个交点</span>
        <span class="token keyword">double</span> t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>b <span class="token operator">+</span> sqrtDisc<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 第二个交点</span>

        <span class="token comment">// 选择最近的有效交点（t>0）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> t1 <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            t <span class="token operator">=</span> t1<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t2 <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> t2 <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            t <span class="token operator">=</span> t2<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 获取球体表面法向量（指向球外）</span>
    Vector3 <span class="token function">getNormal</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> point<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>point <span class="token operator">-</span> center<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 平面类（继承自物体基类）=====</span>
<span class="token keyword">class</span> <span class="token class-name">Plane</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Object</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    Vector3 normal<span class="token punctuation">;</span>  <span class="token comment">// 平面法线</span>
    <span class="token keyword">double</span> d<span class="token punctuation">;</span>        <span class="token comment">// 平面方程参数 (ax + by + cz + d = 0)</span>

    <span class="token function">Plane</span><span class="token punctuation">(</span>Vector3 normal<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> Material mat<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">normal</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">d</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        material <span class="token operator">=</span> mat<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 光线与平面相交检测</span>
    <span class="token keyword">bool</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Ray<span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">double</span> denom <span class="token operator">=</span> normal <span class="token operator">*</span> ray<span class="token punctuation">.</span>B<span class="token punctuation">;</span>  <span class="token comment">// 光线方向与法线的点积</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">abs</span><span class="token punctuation">(</span>denom<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-6</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 光线与平面平行</span>

        <span class="token keyword">double</span> t0 <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> ray<span class="token punctuation">.</span>A <span class="token operator">+</span> d<span class="token punctuation">)</span> <span class="token operator">/</span> denom<span class="token punctuation">;</span>  <span class="token comment">// 求解交点参数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t0 <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> t0 <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 只接受t>0的有效交点</span>
            t <span class="token operator">=</span> t0<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 获取平面法向量（始终为定义的法线）</span>
    Vector3 <span class="token function">getNormal</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> normal<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== 场景管理类 =====</span>
<span class="token keyword">class</span> <span class="token class-name">Scene</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Object<span class="token operator">*</span><span class="token operator">></span> objects<span class="token punctuation">;</span>      <span class="token comment">// 场景中的物体列表</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Light<span class="token operator">></span> lights<span class="token punctuation">;</span>         <span class="token comment">// 场景中的光源列表</span>
    Vector3 backgroundColor<span class="token punctuation">;</span>          <span class="token comment">// 背景颜色</span>
    <span class="token keyword">int</span> maxDepth<span class="token punctuation">;</span>                      <span class="token comment">// 光线追踪最大递归深度</span>

    <span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">backgroundColor</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token operator">~</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 释放所有物体内存</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> obj <span class="token operator">:</span> objects<span class="token punctuation">)</span>
            <span class="token keyword">delete</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>Object<span class="token operator">*</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> objects<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">void</span> <span class="token function">addLight</span><span class="token punctuation">(</span><span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> lights<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token comment">// 检测光线与场景中物体的相交 intersect 函数返回最近交点的距离 t 和物体指针 hitObject，是光线追踪的基础函数</span>
    <span class="token keyword">bool</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token keyword">const</span> Ray<span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> t<span class="token punctuation">,</span> Object<span class="token operator">*</span><span class="token operator">&amp;</span> hitObject<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        t <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化为无穷大</span>
        hitObject <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历所有物体，寻找最近的交点</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> obj <span class="token operator">:</span> objects<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">double</span> currentT <span class="token operator">=</span> t<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token operator">-></span><span class="token function">intersect</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> currentT<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> currentT <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                t <span class="token operator">=</span> currentT<span class="token punctuation">;</span>
                hitObject <span class="token operator">=</span> obj<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> hitObject <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 阴影检测：判断点是否在光源的阴影中</span>
    <span class="token comment">/*
     *
     *  判断阴影条件
     *  点光源：若射线与物体相交，比较交点距离 t 与光源距离 lightDist。若 t &lt; lightDist，说明物体在光源之前，point 于阴影中
     *  方向光：方向光被视为无限远，只要射线与任何物体相交，即认为 point 处于阴影中
     *
     */</span>
    <span class="token keyword">bool</span> <span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector3<span class="token operator">&amp;</span> point<span class="token punctuation">,</span> <span class="token keyword">const</span> Light<span class="token operator">&amp;</span> light<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        Vector3 lightDir<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>type <span class="token operator">==</span> POINT_LIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 点光源方向</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 方向光方向</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 偏移起点避免浮点误差导致的自相交</span>
        Ray <span class="token function">shadowRay</span><span class="token punctuation">(</span>point <span class="token operator">+</span> lightDir <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> lightDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> t<span class="token punctuation">;</span>
        Object<span class="token operator">*</span> hitObject<span class="token punctuation">;</span>

        <span class="token comment">// 射线检测：调用 intersect 函数检测射线是否与场景中的物体相交。若不相交，直接返回 false（无阴影）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intersect</span><span class="token punctuation">(</span>shadowRay<span class="token punctuation">,</span> t<span class="token punctuation">,</span> hitObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 点光源需要判断交点是否在光源之前</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>type <span class="token operator">==</span> POINT_LIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">double</span> lightDist <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">getlen</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> t <span class="token operator">&lt;</span> lightDist<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 方向光只要相交即处于阴影</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ===== UI窗口类（继承自QWidget）=====</span>
<span class="token keyword">class</span> <span class="token class-name">ImageWidget</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">&#123;</span>
    Q_OBJECT

<span class="token keyword">private</span><span class="token operator">:</span>
    Vector3 cameraPos<span class="token punctuation">;</span>      <span class="token comment">// 相机位置</span>
    Vector3 cameraTarget<span class="token punctuation">;</span>   <span class="token comment">// 相机目标点</span>
    Vector3 upVector<span class="token punctuation">;</span>       <span class="token comment">// 相机上方向向量</span>
    <span class="token keyword">double</span> cameraSpeed<span class="token punctuation">;</span>     <span class="token comment">// 相机移动速度</span>
    <span class="token keyword">double</span> rotationSpeed<span class="token punctuation">;</span>   <span class="token comment">// 相机旋转速度</span>

    Scene scene<span class="token punctuation">;</span>            <span class="token comment">// 渲染场景</span>
    QImage image<span class="token punctuation">;</span>           <span class="token comment">// 渲染图像</span>
    <span class="token keyword">bool</span> isRendering<span class="token punctuation">;</span>       <span class="token comment">// 渲染状态标记</span>
    <span class="token keyword">int</span> samplesPerPixel<span class="token punctuation">;</span>    <span class="token comment">// 每像素采样数（抗锯齿）</span>
    std<span class="token double-colon punctuation">::</span>mt19937 rng<span class="token punctuation">;</span>       <span class="token comment">// 随机数生成器（用于采样）</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ImageWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">cameraPos</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// 初始相机位置</span>
        <span class="token function">cameraTarget</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">// 初始观察点</span>
        <span class="token function">upVector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// 初始上方向</span>
        <span class="token function">cameraSpeed</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// 相机移动速度</span>
        <span class="token function">rotationSpeed</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// 相机旋转速度</span>
        <span class="token function">isRendering</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// 初始未渲染</span>
        <span class="token function">samplesPerPixel</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment">// 初始采样数</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 设置窗口大小</span>
        image <span class="token operator">=</span> <span class="token function">QImage</span><span class="token punctuation">(</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QImage<span class="token double-colon punctuation">::</span>Format_RGB32<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建渲染图像</span>

        <span class="token comment">// 初始化随机数生成器</span>
        std<span class="token double-colon punctuation">::</span>random_device rd<span class="token punctuation">;</span>
        rng <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">mt19937</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置场景（添加物体和光源）</span>
        <span class="token function">setupScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 延迟启动渲染</span>
        <span class="token class-name">QTimer</span><span class="token double-colon punctuation">::</span><span class="token function">singleShot</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ImageWidget<span class="token double-colon punctuation">::</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 场景设置函数</span>
    <span class="token keyword">void</span> <span class="token function">setupScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 定义不同材质（红色漫反射、蓝色漫反射、金属、玻璃、地面）</span>
        Material redDiffuse <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 环境光</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 漫反射</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 镜面反射</span>
            <span class="token number">32.0</span><span class="token punctuation">,</span>                    <span class="token comment">// 光泽度</span>
            <span class="token number">0.2</span><span class="token punctuation">,</span>                     <span class="token comment">// 反射率</span>
            <span class="token number">0.0</span><span class="token punctuation">,</span>                     <span class="token comment">// 透明度</span>
            <span class="token number">1.0</span>                      <span class="token comment">// 折射率</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        Material blueDiffuse <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">32.0</span><span class="token punctuation">,</span>
            <span class="token number">0.2</span><span class="token punctuation">,</span>
            <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token number">1.0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        Material reflective <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">128.0</span><span class="token punctuation">,</span>
            <span class="token number">0.8</span><span class="token punctuation">,</span>
            <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token number">1.0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        Material glass <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">64.0</span><span class="token punctuation">,</span>
            <span class="token number">0.2</span><span class="token punctuation">,</span>
            <span class="token number">0.9</span><span class="token punctuation">,</span>
            <span class="token number">1.5</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        Material floorMat <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">32.0</span><span class="token punctuation">,</span>
            <span class="token number">0.3</span><span class="token punctuation">,</span>
            <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token number">1.0</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加球体到场景</span>
        scene<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Sphere</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> redDiffuse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Sphere</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> blueDiffuse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Sphere</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> reflective<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Sphere</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> glass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加地面平面</span>
        scene<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Plane</span><span class="token punctuation">(</span><span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> floorMat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加光源（点光源和方向光）</span>
        Light light1<span class="token punctuation">;</span>
        light1<span class="token punctuation">.</span>type <span class="token operator">=</span> POINT_LIGHT<span class="token punctuation">;</span>
        light1<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light1<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light1<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span><span class="token function">addLight</span><span class="token punctuation">(</span>light1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Light light2<span class="token punctuation">;</span>
        light2<span class="token punctuation">.</span>type <span class="token operator">=</span> DIRECTIONAL_LIGHT<span class="token punctuation">;</span>
        light2<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light2<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light2<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span><span class="token function">addLight</span><span class="token punctuation">(</span>light2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 光线追踪核心函数：递归计算光线与场景的交互</span>
    Vector3 <span class="token function">traceRay</span><span class="token punctuation">(</span><span class="token keyword">const</span> Ray<span class="token operator">&amp;</span> ray<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">></span> scene<span class="token punctuation">.</span>maxDepth<span class="token punctuation">)</span> <span class="token keyword">return</span> scene<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">;</span>  <span class="token comment">// 达到最大递归深度，返回背景色</span>

        <span class="token keyword">double</span> t<span class="token punctuation">;</span>
        Object<span class="token operator">*</span> hitObject <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>scene<span class="token punctuation">.</span><span class="token function">intersect</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> t<span class="token punctuation">,</span> hitObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> scene<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">;</span>  <span class="token comment">// 无相交，返回背景色</span>

        Vector3 hitPoint <span class="token operator">=</span> ray<span class="token punctuation">.</span><span class="token function">ProjectivePoint</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 计算交点</span>
        Vector3 normal <span class="token operator">=</span> hitObject<span class="token operator">-></span><span class="token function">getNormal</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取交点法向量</span>
        Vector3 viewDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraPos <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 视图方向</span>

        <span class="token comment">// 环境光分量（直接使用材质环境光系数）</span>
        Vector3 ambient <span class="token operator">=</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>ambient<span class="token punctuation">;</span>

        <span class="token comment">// 漫反射和镜面反射分量（逐光源计算）</span>
        Vector3 <span class="token function">diffuse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vector3 <span class="token function">specular</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> light <span class="token operator">:</span> scene<span class="token punctuation">.</span>lights<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>scene<span class="token punctuation">.</span><span class="token function">isInShadow</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span> light<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>  <span class="token comment">// 点在阴影中，跳过</span>

            Vector3 lightDir<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>type <span class="token operator">==</span> POINT_LIGHT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> hitPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 点光源方向</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                lightDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 方向光方向</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// 漫反射计算：Phong模型</span>
            <span class="token keyword">double</span> diff <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>normal <span class="token operator">*</span> lightDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 漫反射强度（余弦值裁剪为非负）</span>
            <span class="token keyword">double</span> scalarFactor <span class="token operator">=</span> diff <span class="token operator">*</span> light<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>     <span class="token comment">// 标量因子（强度×余弦值）</span>
            <span class="token comment">// 物体漫反射颜色 × 光源颜色（逐元素相乘）× 标量因子</span>
            diffuse <span class="token operator">=</span> diffuse <span class="token operator">+</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">.</span><span class="token function">hadamard</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token operator">*</span> scalarFactor<span class="token punctuation">;</span>

            <span class="token comment">// 镜面反射计算：Phong模型</span>
            Vector3 reflectDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">reflect</span><span class="token punctuation">(</span>lightDir <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 反射方向</span>
            <span class="token keyword">double</span> spec <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">pow</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>viewDir <span class="token operator">*</span> reflectDir<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 镜面反射强度</span>
            <span class="token comment">// 物体镜面反射颜色 × 光源颜色 × 标量因子</span>
            specular <span class="token operator">=</span> specular <span class="token operator">+</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>specular<span class="token punctuation">.</span><span class="token function">hadamard</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token operator">*</span> spec <span class="token operator">*</span> light<span class="token punctuation">.</span>intensity<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 反射分量（递归追踪反射光线）</span>
        Vector3 <span class="token function">reflection</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>reflectivity <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            Vector3 reflectDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">reflect</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 反射方向</span>
            <span class="token comment">// 偏移起点避免自相交</span>
            Ray <span class="token function">reflectRay</span><span class="token punctuation">(</span>hitPoint <span class="token operator">+</span> reflectDir <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> reflectDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            reflection <span class="token operator">=</span> <span class="token function">traceRay</span><span class="token punctuation">(</span>reflectRay<span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>reflectivity<span class="token punctuation">;</span>  <span class="token comment">// 递归追踪</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 折射分量（递归追踪折射光线）</span>
        Vector3 <span class="token function">refraction</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>transparency <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">bool</span> inside <span class="token operator">=</span> normal <span class="token operator">*</span> ray<span class="token punctuation">.</span>B <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 判断光线是进入还是离开物体</span>
            Vector3 refractedNormal <span class="token operator">=</span> inside <span class="token operator">?</span> normal <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1.0</span> <span class="token operator">:</span> normal<span class="token punctuation">;</span>  <span class="token comment">// 调整折射法线方向</span>
            <span class="token keyword">double</span> eta <span class="token operator">=</span> inside <span class="token operator">?</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>refractiveIndex <span class="token operator">:</span> <span class="token number">1.0</span> <span class="token operator">/</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>refractiveIndex<span class="token punctuation">;</span>  <span class="token comment">// 折射率</span>

            Vector3 refractDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">refract</span><span class="token punctuation">(</span>ray<span class="token punctuation">.</span>B<span class="token punctuation">,</span> refractedNormal<span class="token punctuation">,</span> eta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 计算折射方向</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>refractDir<span class="token punctuation">.</span>x <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> refractDir<span class="token punctuation">.</span>y <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> refractDir<span class="token punctuation">.</span>z <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 非零折射方向</span>
                Ray <span class="token function">refractRay</span><span class="token punctuation">(</span>hitPoint <span class="token operator">+</span> refractDir <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">,</span> refractDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 偏移起点</span>
                refraction <span class="token operator">=</span> <span class="token function">traceRay</span><span class="token punctuation">(</span>refractRay<span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> hitObject<span class="token operator">-></span>material<span class="token punctuation">.</span>transparency<span class="token punctuation">;</span>  <span class="token comment">// 递归追踪</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 合并所有光照分量</span>
        Vector3 color <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular <span class="token operator">+</span> reflection <span class="token operator">+</span> refraction<span class="token punctuation">;</span>

        <span class="token comment">// 颜色值范围裁剪（0.0-1.0）</span>
        color<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        color<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        color<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">clamp</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 图像渲染函数</span>
    <span class="token keyword">void</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRendering<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// 避免重复渲染</span>

        isRendering <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        image<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>black<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空图像</span>

        <span class="token comment">// 构建相机坐标系（视图空间）</span>
        Vector3 viewDir <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 视图方向</span>
        Vector3 right <span class="token operator">=</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>upVector<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 右方向</span>
        Vector3 up <span class="token operator">=</span> right<span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// 上方向</span>

        <span class="token comment">// 相机参数设置</span>
        <span class="token keyword">double</span> fov <span class="token operator">=</span> <span class="token number">60.0</span> <span class="token operator">*</span> M_PI <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span>  <span class="token comment">// 视场角（弧度）</span>
        <span class="token keyword">double</span> aspectRatio <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 宽高比</span>
        <span class="token keyword">double</span> halfHeight <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">tan</span><span class="token punctuation">(</span>fov <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 半高</span>
        <span class="token keyword">double</span> halfWidth <span class="token operator">=</span> aspectRatio <span class="token operator">*</span> halfHeight<span class="token punctuation">;</span>  <span class="token comment">// 半宽</span>

        <span class="token comment">// 随机数分布（用于抗锯齿采样）</span>
        std<span class="token double-colon punctuation">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> <span class="token function">dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 逐像素渲染（外循环：行，内循环：列）</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                Vector3 <span class="token function">pixelColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 多重采样抗锯齿：每个像素采样多个点取平均</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> samplesPerPixel<span class="token punctuation">;</span> <span class="token operator">++</span>s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 在像素内添加随机偏移（抖动采样）</span>
                    <span class="token keyword">double</span> u <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token function">dist</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">double</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> y <span class="token operator">+</span> <span class="token function">dist</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// 构建视平面坐标系</span>
                    Vector3 lowerLeftCorner <span class="token operator">=</span> cameraPos <span class="token operator">+</span> viewDir <span class="token operator">-</span> right <span class="token operator">*</span> halfWidth <span class="token operator">-</span> up <span class="token operator">*</span> halfHeight<span class="token punctuation">;</span>
                    Vector3 horizontal <span class="token operator">=</span> right <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> halfWidth<span class="token punctuation">;</span>
                    Vector3 vertical <span class="token operator">=</span> up <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> halfHeight<span class="token punctuation">;</span>

                    <span class="token comment">// 计算光线方向</span>
                    Vector3 direction <span class="token operator">=</span> lowerLeftCorner <span class="token operator">+</span> horizontal <span class="token operator">*</span> u <span class="token operator">+</span> vertical <span class="token operator">*</span> v <span class="token operator">-</span> cameraPos<span class="token punctuation">;</span>
                    Ray <span class="token function">ray</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// 追踪光线并累加颜色</span>
                    pixelColor <span class="token operator">=</span> pixelColor <span class="token operator">+</span> <span class="token function">traceRay</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token comment">// 平均采样颜色</span>
                pixelColor <span class="token operator">=</span> pixelColor <span class="token operator">/</span> samplesPerPixel<span class="token punctuation">;</span>

                <span class="token comment">// 伽马校正（补偿显示器非线性响应）</span>
                pixelColor<span class="token punctuation">.</span>x <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>pixelColor<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                pixelColor<span class="token punctuation">.</span>y <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>pixelColor<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                pixelColor<span class="token punctuation">.</span>z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>pixelColor<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 转换为QColor并设置像素</span>
                <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">255.99</span> <span class="token operator">*</span> pixelColor<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">255.99</span> <span class="token operator">*</span> pixelColor<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">255.99</span> <span class="token operator">*</span> pixelColor<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
                image<span class="token punctuation">.</span><span class="token function">setPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">qRgb</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// 每渲染10行更新一次显示，提供进度反馈</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        isRendering <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 渲染完成后更新显示</span>
    <span class="token punctuation">&#125;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token comment">// 绘图事件处理</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent<span class="token operator">*</span> event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 绘制渲染图像</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRendering<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            painter<span class="token punctuation">.</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>
            painter<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"Rendering..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 显示渲染状态</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 键盘事件处理（相机控制）</span>
    <span class="token keyword">void</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>QKeyEvent<span class="token operator">*</span> event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">bool</span> needUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 相机移动控制</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token operator">-></span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_W<span class="token operator">:</span>  <span class="token comment">// 向前移动</span>
            cameraPos <span class="token operator">=</span> cameraPos <span class="token operator">+</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_S<span class="token operator">:</span>  <span class="token comment">// 向后移动</span>
            cameraPos <span class="token operator">=</span> cameraPos <span class="token operator">-</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_A<span class="token operator">:</span>  <span class="token comment">// 向左移动</span>
            cameraPos <span class="token operator">=</span> cameraPos <span class="token operator">-</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>upVector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_D<span class="token operator">:</span>  <span class="token comment">// 向右移动</span>
            cameraPos <span class="token operator">=</span> cameraPos <span class="token operator">+</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>upVector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Up<span class="token operator">:</span>  <span class="token comment">// 向上移动观察点</span>
            cameraTarget <span class="token operator">=</span> cameraTarget <span class="token operator">+</span> upVector <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Down<span class="token operator">:</span>  <span class="token comment">// 向下移动观察点</span>
            cameraTarget <span class="token operator">=</span> cameraTarget <span class="token operator">-</span> upVector <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Left<span class="token operator">:</span>  <span class="token comment">// 向左移动观察点</span>
            cameraTarget <span class="token operator">=</span> cameraTarget <span class="token operator">-</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>upVector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Right<span class="token operator">:</span>  <span class="token comment">// 向右移动观察点</span>
            cameraTarget <span class="token operator">=</span> cameraTarget <span class="token operator">+</span> <span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span><span class="token double-colon punctuation">::</span><span class="token function">unitization</span><span class="token punctuation">(</span>cameraTarget <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>upVector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Space<span class="token operator">:</span>  <span class="token comment">// 重置相机</span>
            cameraPos <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cameraTarget <span class="token operator">=</span> <span class="token function">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            needUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Plus<span class="token operator">:</span>  <span class="token comment">// 增加采样数（提高图像质量）</span>
            samplesPerPixel <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span>samplesPerPixel <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Samples per pixel:"</span> <span class="token operator">&lt;&lt;</span> samplesPerPixel<span class="token punctuation">;</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_Minus<span class="token operator">:</span>  <span class="token comment">// 减少采样数（提高渲染速度）</span>
            samplesPerPixel <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>samplesPerPixel <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Samples per pixel:"</span> <span class="token operator">&lt;&lt;</span> samplesPerPixel<span class="token punctuation">;</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>Key_R<span class="token operator">:</span>  <span class="token comment">// 重新渲染</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 重新渲染场景</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 更新显示</span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"update"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 窗口大小调整事件处理</span>
    <span class="token keyword">void</span> <span class="token function">resizeEvent</span><span class="token punctuation">(</span>QResizeEvent<span class="token operator">*</span> event<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">QWidget</span><span class="token double-colon punctuation">::</span><span class="token function">resizeEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        image <span class="token operator">=</span> <span class="token function">QImage</span><span class="token punctuation">(</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QImage<span class="token double-colon punctuation">::</span>Format_RGB32<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 重新创建图像</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 重新渲染</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ImageWidget widget<span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"光线追踪渲染器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    widget<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"main.moc"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后渲染出来的结果如图所示：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/image-20250614202856162.png" alt="image-20250614202856162" style="zoom:80%;">
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://0zxm.github.io">0zxm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://0zxm.github.io/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/">https://0zxm.github.io/2025/03/04/ji-suan-ji-tu-xing-xue-he-xu-ni-xian-shi/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://0zxm.github.io" target="_blank">0zxm</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a></div><div class="post-share"><div class="social-share" data-image="/img/cover2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/05/shou-ji-ruan-jian-kai-fa/" title="手机软件开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">手机软件开发</div></div><div class="info-2"><div class="info-item-1">使用AndroidStudio开发手机软件</div></div></div></a><a class="pagination-related" href="/2025/03/03/wang-luo-yu-xin-xi-an-quan/" title="网络信息安全和密码学"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">网络信息安全和密码学</div></div><div class="info-2"><div class="info-item-1">网络信息安全和密码学</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">0zxm</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/0zxm"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/0zxm" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:m15813109801@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="http://0zxm.github.io" target="_blank" title="博客"><i class="fab fa-algolia" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%BB%AA%E8%AE%BA"><span class="toc-text">第一章 绪论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E7%9A%84%E7%A0%94%E7%A9%B6%E5%86%85%E5%AE%B9"><span class="toc-text">1.1 计算机图形学的研究内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-text">1.2 计算机图形学发展历程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E7%9A%84%E5%BA%94%E7%94%A8%E5%8F%8A%E7%A0%94%E7%A9%B6%E5%89%8D%E6%B2%BF"><span class="toc-text">1.3 计算机图形学的应用及研究前沿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%9B%BE%E5%BD%A2%E8%AE%BE%E5%A4%87"><span class="toc-text">1.4 图形设备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E6%9C%80%E6%96%B0%E7%A0%94%E7%A9%B6%E6%96%B9%E5%90%91"><span class="toc-text">1.5 最新研究方向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E4%BA%8C%E7%BB%B4%E5%8F%98%E6%8D%A2"><span class="toc-text">第二章 二维变换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%90%91%E9%87%8F"><span class="toc-text">2.1 向量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-text">2.2 坐标系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BA%8C%E7%BB%B4%E5%9B%BE%E5%BD%A2%E5%8F%98%E6%8D%A2"><span class="toc-text">2.3 二维图形变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87"><span class="toc-text">2.4 齐次坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%B9%B3%E7%A7%BB%E5%8F%98%E6%8D%A2"><span class="toc-text">2.5 平移变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E6%AF%94%E4%BE%8B%E5%8F%98%E6%8D%A2"><span class="toc-text">2.6 比例变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%AF%B9%E7%A7%B0%E5%8F%98%E6%8D%A2"><span class="toc-text">2.7 对称变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E6%97%8B%E8%BD%AC%E5%8F%98%E6%8D%A2"><span class="toc-text">2.8 旋转变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E9%94%99%E5%88%87%E5%8F%98%E6%8D%A2"><span class="toc-text">2.9 错切变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E5%A4%8D%E5%90%88%E5%8F%98%E6%8D%A2"><span class="toc-text">2.10 复合变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E7%AA%97%E5%8F%A3%E3%80%81%E8%A7%86%E5%8C%BA%E5%8F%8A%E5%8F%98%E6%8D%A2"><span class="toc-text">2.11 窗口、视区及变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84"><span class="toc-text">2.12 最重要的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%85%89%E6%A0%85%E5%9B%BE%E5%BD%A2%E5%AD%A6"><span class="toc-text">第三章 光栅图形学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%9B%B4%E7%BA%BF%E6%AE%B5%E7%9A%84%E6%89%AB%E6%8F%8F%E8%BD%AC%E6%8D%A2%E7%AE%97%E6%B3%95"><span class="toc-text">3.1 直线段的扫描转换算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DDA%E6%95%B0%E5%80%BC%E5%BE%AE%E5%88%86%E7%AE%97%E6%B3%95"><span class="toc-text">DDA数值微分算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E7%82%B9%E7%94%BB%E7%BA%BF%E6%B3%95"><span class="toc-text">中点画线法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bresenham%E7%AE%97%E6%B3%95"><span class="toc-text">Bresenham算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%89%AB%E6%8F%8F%E7%AE%97%E6%B3%95"><span class="toc-text">3.2 多边形扫描算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E8%A3%81%E5%89%AA%E7%AE%97%E6%B3%95"><span class="toc-text">3.3 裁剪算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E7%9B%B4%E7%BA%BF%E6%AE%B5%E8%A3%81%E5%89%AA"><span class="toc-text">3.2.1 直线段裁剪</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E8%A3%81%E5%89%AA-Suther-land-Hodgeman%E7%AE%97%E6%B3%95"><span class="toc-text">3.2.2 多边形裁剪 Suther land-Hodgeman算法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%9C%9F%E5%AE%9E%E6%84%9F%E5%9B%BE%E5%BD%A2%E5%AD%A6"><span class="toc-text">第四章 真实感图形学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E9%A2%9C%E8%89%B2%E8%A7%86%E8%A7%89"><span class="toc-text">4.1 颜色视觉</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E5%AD%A6%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86"><span class="toc-text">光学补充知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.2 简单光照模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pong%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">Pong光照模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%85%89%EF%BC%88Ambient-Light%EF%BC%89"><span class="toc-text">1. 环境光（Ambient Light）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BC%AB%E5%8F%8D%E5%B0%84%E5%85%89%EF%BC%88Diffuse-Light%EF%BC%89"><span class="toc-text">2. 漫反射光（Diffuse Light）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%95%9C%E9%9D%A2%E5%8F%8D%E5%B0%84%E5%85%89%EF%BC%88Specular-Light%EF%BC%89"><span class="toc-text">3. 镜面反射光（Specular Light）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9C%80%E7%BB%88%E9%A2%9C%E8%89%B2%E8%AE%A1%E7%AE%97"><span class="toc-text">4. 最终颜色计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%EF%BC%88%E5%9F%BA%E4%BA%8E-OpenGL-%E7%9A%84%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8%EF%BC%89"><span class="toc-text">示例代码（基于 OpenGL 的片段着色器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%A2%9E%E9%87%8F%E5%BC%8F%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.3 增量式光照模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E7%BA%BF%E6%80%A7%E5%85%89%E5%BC%BA%E6%8F%92%E5%80%BC"><span class="toc-text">双线性光强插值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E7%BA%BF%E6%80%A7%E6%B3%95%E5%90%91%E6%8F%92%E5%80%BC"><span class="toc-text">双线性法向插值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%B1%80%E9%83%A8%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.4 局部光照模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E9%80%8F%E5%B0%84%E6%A8%A1%E5%9E%8B"><span class="toc-text">4.5 透射模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E7%AE%97%E6%B3%95"><span class="toc-text">4.6 光线追踪算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%87%A0%E4%BD%95%E9%80%A0%E5%9E%8B%E6%8A%80%E6%9C%AF"><span class="toc-text">第五章 几何造型技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E6%9B%B2%E9%9D%A2"><span class="toc-text">5.1 贝塞尔曲线曲面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-B%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF%E6%9B%B2%E9%9D%A2"><span class="toc-text">5.2 B样条曲线曲面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E4%BD%9C%E4%B8%9A"><span class="toc-text">大作业</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Phong%E6%A8%A1%E5%9E%8B"><span class="toc-text">Phong模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA"><span class="toc-text">光线追踪</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Snell%E5%AE%9A%E5%BE%8B"><span class="toc-text">Snell定律</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%85%89%E7%BA%BF%E5%92%8C%E7%89%A9%E4%BD%93%E7%A2%B0%E6%92%9E"><span class="toc-text">判断光线和物体碰撞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E7%9A%84%E9%98%B4%E5%BD%B1%E5%A4%84%E7%90%86"><span class="toc-text">光线追踪的阴影处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%97%E9%94%AF%E9%BD%BF%E9%87%87%E6%A0%B7"><span class="toc-text">抗锯齿采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E7%89%88%E4%BB%A3%E7%A0%81"><span class="toc-text">新版代码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/25/framwork-kuang-jia-xue-xi/" title="Django REST framwork框架学习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Django REST framwork框架学习"/></a><div class="content"><a class="title" href="/2025/06/25/framwork-kuang-jia-xue-xi/" title="Django REST framwork框架学习">Django REST framwork框架学习</a><time datetime="2025-06-25T13:09:01.000Z" title="发表于 2025-06-25 21:09:01">2025-06-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/19/wide-deep-mo-xing/" title="Wide&amp;Deep模型"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Wide&amp;Deep模型"/></a><div class="content"><a class="title" href="/2025/06/19/wide-deep-mo-xing/" title="Wide&amp;Deep模型">Wide&amp;Deep模型</a><time datetime="2025-06-19T05:30:40.000Z" title="发表于 2025-06-19 13:30:40">2025-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/java-ji-chu-xia/" title="Java基础下"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java基础下"/></a><div class="content"><a class="title" href="/2025/03/08/java-ji-chu-xia/" title="Java基础下">Java基础下</a><time datetime="2025-03-08T03:43:21.000Z" title="发表于 2025-03-08 11:43:21">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/duo-xian-cheng-e-wai-kuo-zhan/" title="Java基础之多线程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java基础之多线程"/></a><div class="content"><a class="title" href="/2025/03/08/duo-xian-cheng-e-wai-kuo-zhan/" title="Java基础之多线程">Java基础之多线程</a><time datetime="2025-03-08T03:43:21.000Z" title="发表于 2025-03-08 11:43:21">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/07/qian-ru-shi-xi-tong-gai-shu/" title="嵌入式系统概述"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="嵌入式系统概述"/></a><div class="content"><a class="title" href="/2025/03/07/qian-ru-shi-xi-tong-gai-shu/" title="嵌入式系统概述">嵌入式系统概述</a><time datetime="2025-03-07T06:08:48.000Z" title="发表于 2025-03-07 14:08:48">2025-03-07</time></div></div></div></div></div></div><!-- 登录验证模态框--></main><footer id="footer" style="background-image: url(/img/footer.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By 0zxm</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- CSS 样式--><style>#login-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  cursor: pointer;
}

.modal-content {
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  width: 80%;
  max-width: 400px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index:999;
}

input#password-input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  margin-bottom: 20px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button#submit-btn {
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button#submit-btn:hover {
  background-color: #45a049;
}
</style><!-- JavaScript 验证--><script>document.addEventListener('DOMContentLoaded', function() {

  (function() {
  // 禁用右键菜单
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
  });

  // 禁用快捷键 (F12/Ctrl+Shift+I/Ctrl+Shift+J/Ctrl+Shift+C)
  document.addEventListener('keydown', function(e) {
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
        (e.ctrlKey && e.shiftKey && e.key === 'C')) {
      e.preventDefault();
      return false;
    }
  });
  })();
  

  const modal = document.getElementById('login-modal');
  const passwordInput = document.getElementById('password-input');
  const submitBtn = document.getElementById('submit-btn');
  const errorMsg = document.getElementById('error-msg');
  const bodyWrap = document.getElementById('body-wrap');


  // 默认显示模态框
  modal.style.display = 'flex';

  // 自动聚焦到密码输入框
  passwordInput.focus();

  submitBtn.addEventListener('click', function(e) {
    e.preventDefault();
    const password = passwordInput.value;
    const correctPassword = 'D&X'; // 替换为实际密码

    if (password === correctPassword) {
      modal.style.display = 'none';
      bodyWrap.style.opacity = 1; // 显示页面内容
    } else {
      passwordInput.classList.add('error');
      errorMsg.style.display = 'block';
      setTimeout(() => {
        passwordInput.classList.remove('error');
        errorMsg.style.display = 'none';
      }, 2000);
    }
  });
  // 按下 Enter 键提交
  passwordInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      submitBtn.click();
    }
  });
});</script></body></html>