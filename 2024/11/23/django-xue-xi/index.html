<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Django学习 | 0zxm</title><meta name="author" content="0zxm"><meta name="copyright" content="0zxm"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Django框架的学习">
<meta property="og:type" content="article">
<meta property="og:title" content="Django学习">
<meta property="og:url" content="https://0zxm.github.io/2024/11/23/django-xue-xi/index.html">
<meta property="og:site_name" content="0zxm">
<meta property="og:description" content="Django框架的学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://0zxm.github.io/img/cover2.jpg">
<meta property="article:published_time" content="2024-11-23T05:51:37.000Z">
<meta property="article:modified_time" content="2024-12-19T11:43:16.336Z">
<meta property="article:author" content="0zxm">
<meta property="article:tag" content="python">
<meta property="article:tag" content="web框架">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://0zxm.github.io/img/cover2.jpg"><link rel="shortcut icon" href="/favicon.png"><link rel="canonical" href="https://0zxm.github.io/2024/11/23/django-xue-xi/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Django学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-19 19:43:16'
}</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/src/"><i class="fa-fw fas fa-cloud"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">0zxm</span></a><a class="nav-page-title" href="/"><span class="site-name">Django学习</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/src/"><i class="fa-fw fas fa-cloud"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Django学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-23T05:51:37.000Z" title="发表于 2024-11-23 13:51:37">2024-11-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-19T11:43:16.336Z" title="更新于 2024-12-19 19:43:16">2024-12-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E5%BC%80%E5%8F%91/">web开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">19.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>80分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、Django快速入门"><a href="#一、Django快速入门" class="headerlink" title="一、Django快速入门"></a>一、Django快速入门</h2><ol>
<li>使用最新版本 Django4.2LTS 版本,3 年内不需要更换版本</li>
<li>由浅入深讲解，浅显易懂</li>
<li>课程大纲全面包含 Django 框架知识点，内容丰富全面细致</li>
<li>知识点结合项目实战实现全栈项目应用</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fh4y1Z7jp">视频教程</a></p>
<p><a target="_blank" rel="noopener" href="https://geek-docs.com/django/django-questions/372_django_html_autocomplete_is_not_working_along_with_django_extension_in_vscode.html">Django的HTML自动补全功能与VSCode中的Django扩展无法正常工作|极客教程</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gandongusa/article/details/123049993">VSCode中安装Django插件后实现html语法提示_vscode html提示-CSDN博客</a></p>
<p>Django 官网(文档): <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/">https://docs.djangoproject.com/zh-hans/</a></p>
<p>Django 是一个开放源代码的 Web 应用框架，由 Python 写成。采用了 MTV 的框架模式，即<code>模型M，视图V和模版T</code></p>
<p>它最初是被开发来用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站的，即是 CMS(内容管理系统)软件。</p>
<p>并于 2005 年 7 月在 BSD 许可证下发布。这套框架是以比利时的吉普赛爵士吉他手 Django Reinhardt 来命名的。</p>
<p>2020 年，Django 3.0 发布</p>
<p>2022 年，Django 4.0 发布。Django4.0 将支持 Python3.8、3.9 与 3.10</p>
<p>2023 年，Django 4.2LTS 发布，长期支持版本，会维护 3 年，在企业中我们建议使用 LTS 版本</p>
<p>Django 每 2 年会推出全新的大版本。</p>
<h3 id="1-创建虚拟环境"><a href="#1-创建虚拟环境" class="headerlink" title="1. 创建虚拟环境"></a>1. 创建虚拟环境</h3><ol>
<li><p>打开<code>cmd</code></p>
</li>
<li><p>安装<code>virtualenv</code>,使用<code>pip install virtualenv virtualenvwrapper-win</code>,Linux 下不用写<code>-win</code></p>
</li>
<li><p><code>workon</code> 查看虚拟环境</p>
 <pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">workon<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>mkvirtualenv</code>创建新的虚拟环境</p>
 <pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">mkvirtualenv env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>rmvirtualenv</code>删除虚拟环境</p>
</li>
<li><p><code>workon env</code>进入虚拟环境(使用 cmd 才行)</p>
</li>
</ol>
<h4 id="python-m-venv"><a href="#python-m-venv" class="headerlink" title="python -m venv"></a><code>python -m venv</code></h4><ul>
<li><p><strong>内置方法</strong>：<code>venv</code> 是 Python 标准库中的模块，因此不需要额外安装。</p>
</li>
<li><p><strong>基本功能</strong>：创建一个轻量级的虚拟环境，隔离项目的依赖包。</p>
</li>
<li><p>命令示例</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python <span class="token parameter variable">-m</span> venv myenv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><strong>平台兼容性</strong>：可以在所有支持的 Python 环境中使用。</p>
</li>
<li><p><strong>灵活性</strong>：适用于简单的虚拟环境需求，使用简单明了。</p>
</li>
</ul>
<h4 id="mkvirtualenv"><a href="#mkvirtualenv" class="headerlink" title="mkvirtualenv"></a><code>mkvirtualenv</code></h4><ul>
<li><p><strong>来自第三方库</strong>：<code>mkvirtualenv</code> 是 <code>virtualenvwrapper</code> 的一部分，<code>virtualenvwrapper</code> 是一个为 <code>virtualenv</code> 提供更高层次的封装的工具。</p>
</li>
<li><p><strong>附加功能</strong>：提供了更多的功能，如项目管理、容易的环境切换、环境的创建和删除等，支持管理多个虚拟环境。</p>
</li>
<li><p><strong>依赖</strong>：需要先安装 <code>virtualenv</code> 和 <code>virtualenvwrapper</code>，这可能需要额外的配置。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mkvirtualenv myenv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>或者指定你要创建虚拟环境的目录</strong></p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">virtualenv /path/to/your/folder/env
运行 <span class="token punctuation">\</span>path<span class="token punctuation">\</span>to<span class="token punctuation">\</span>your<span class="token punctuation">\</span>folder<span class="token punctuation">\</span>env<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate  <span class="token comment"># 激活虚拟环境(遇到权限问题Set-ExecutionPolicy RemoteSigned --Windows环境下)</span>
deactivate <span class="token comment"># 退出虚拟环境</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>命名规则</strong>：自带命名规则和其他一些便利的功能，使得管理虚拟环境更加便捷。</p>
</li>
</ul>
<h3 id="2-安装-django-可以在虚拟环境中"><a href="#2-安装-django-可以在虚拟环境中" class="headerlink" title="2. 安装 django(可以在虚拟环境中)"></a>2. 安装 django(可以在虚拟环境中)</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">pip install django==4<span class="token punctuation">.</span>2 <span class="token operator">-</span>i https:<span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn/simple<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>(4.2 是 LTS 长期支持版本,推荐使用，如不写则会安装最新版本)</p>
<p>测试是否安装成功</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip show django<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-创建-Django-项目"><a href="#3-创建-Django-项目" class="headerlink" title="3. 创建 Django 项目"></a>3. 创建 Django 项目</h3><p>方式一: 进入到指定要存放项目的目录，执行 <code>django-admin startproject HelloDjango</code> 来创建一个名字为 HelloDjango 的工程</p>
<p>方式二:使用 Pycharm 专业版创建 Django 项目.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/pycharm%E5%88%9B%E5%BB%BAdjango%E9%A1%B9%E7%9B%AE.png" alt="image-20241123150020267"></p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">manage.py：
	这是Django项目的核心命令行工具。通过这个文件，您可以启动开发服务器、运行数据库迁移、创建数据库表、清理数据库等。例如，python manage.py runserver 会启动开发服务器。

HelloDjango/：
	这是项目的根目录，通常与项目的主模块同名。

HelloDjango/__init__.py：
	这个文件使得Python将HelloDjango目录视为一个包。即使这个文件是空的，它也是必需的，因为它告诉Python解释器这个目录应该被视为Python的包。

HelloDjango/settings.py：
	这个文件包含了项目的配置信息。它定义了Django如何运行，包括数据库配置、时区、使用的应用程序、中间件、模板配置等。

HelloDjango/urls.py：
	这个文件定义了项目的URL路由。它告诉Django对于每个请求的URL，应该调用哪个视图函数来处理。

HelloDjango/wsgi.py：
	这个文件是Web服务器网关接口（WSGI）的入口点，用于部署Django项目到生产服务器。WSGI是一个Python标准，用于在服务器和Web应用程序之间传递信息。

HelloDjango/asgi.py：
	这个文件定义了异步服务器网关接口（ASGI）的入口点。ASGI是Django 3.0引入的，用于支持异步Web应用，这对于提高性能和处理大量并发连接非常有用，特别是在需要长轮询和WebSockets的应用中(类似Tornado异步框架)。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="创建带应用的项目"><a href="#创建带应用的项目" class="headerlink" title="创建带应用的项目"></a>创建带应用的项目</h3><ol>
<li><p><strong>使用 Django 创建一个带有应用的项目</strong>：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 Django</span>
pip <span class="token function">install</span> django

<span class="token comment"># 创建一个 Django 项目</span>
django-admin startproject myproject

<span class="token comment"># 进入项目目录</span>
<span class="token builtin class-name">cd</span> myproject

<span class="token comment"># 创建一个 Django 应用</span>
python manage.py startapp myapp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>使用 Flask 创建一个带有应用的项目</strong>：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 Flask</span>
pip <span class="token function">install</span> Flask

<span class="token comment"># 创建项目目录</span>
<span class="token function">mkdir</span> myproject
<span class="token builtin class-name">cd</span> myproject

<span class="token comment"># 创建应用文件</span>
<span class="token function">touch</span> app.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>使用 Node.js 和 Express 创建一个应用项目</strong>：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 Express 生成器</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> express-generator

<span class="token comment"># 创建一个 Express 应用</span>
express myapp

<span class="token comment"># 进入应用目录并安装依赖</span>
<span class="token builtin class-name">cd</span> myapp
<span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>使用 Vue CLI 创建一个 Vue.js 项目</strong>：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装 Vue CLI</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @vue/cli

<span class="token comment"># 创建一个 Vue 项目</span>
vue create myproject<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token comment"># 项目根目录</span>
<span class="token comment"># Build paths inside the project like this: BASE_DIR / 'subdir'.</span>
BASE_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent


<span class="token comment"># Quick-start development settings - unsuitable for production</span>
<span class="token comment"># See https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/</span>

<span class="token comment"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="token comment"># 密钥</span>
SECRET_KEY <span class="token operator">=</span> <span class="token string">'django-insecure-*x+ln#hax3c-a26$cc*cl2+w#h(6^=%_0reqp^ju!fr$galzd6'</span>

<span class="token comment"># SECURITY WARNING: don't run with debug turned on in production!</span>
<span class="token comment"># 是否使用调试模式, 开发环境建议设置为True, 生产(上线部署)环境设置为False</span>
DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token comment"># 允许访问的主机</span>
<span class="token comment"># * 表示允许所有主机访问,允许任何电脑访问(局域网)</span>
<span class="token comment"># 上线后可以指定哪些允许</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span>


<span class="token comment"># Application definition</span>
<span class="token comment"># 定义应用</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>

    <span class="token comment"># 自定义应用</span>
    <span class="token string">"user"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 中间件</span>
MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 根路由路径</span>
ROOT_URLCONF <span class="token operator">=</span> <span class="token string">'DjangoPro1.urls'</span>

<span class="token comment"># 模板配置</span>
TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># 如果你要在其他地方创建前端文件,请把路径加上,如BASE_DIR/"templates",</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># wsgi目录</span>
WSGI_APPLICATION <span class="token operator">=</span> <span class="token string">'DjangoPro1.wsgi.application'</span>


<span class="token comment"># Database</span>
<span class="token comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#databases</span>
<span class="token comment"># 数据库</span>
DATABASES <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 只支持关系型数据库</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.sqlite3'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> BASE_DIR <span class="token operator">/</span> <span class="token string">'db.sqlite3'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment"># Password validation</span>
<span class="token comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#auth-password-validators</span>
<span class="token comment"># 密码验证</span>
AUTH_PASSWORD_VALIDATORS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token comment"># Internationalization</span>
<span class="token comment"># https://docs.djangoproject.com/en/4.2/topics/i18n/</span>
<span class="token comment"># 国际化</span>
LANGUAGE_CODE <span class="token operator">=</span> <span class="token string">'en-us'</span> <span class="token comment"># zh-hans 中文</span>

TIME_ZONE <span class="token operator">=</span> <span class="token string">'UTC'</span>

USE_I18N <span class="token operator">=</span> <span class="token boolean">True</span>

USE_TZ <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token comment"># Static files (CSS, JavaScript, Images)</span>
<span class="token comment"># https://docs.djangoproject.com/en/4.2/howto/static-files/</span>
<span class="token comment"># 静态文件</span>
STATIC_URL <span class="token operator">=</span> <span class="token string">'static/'</span>

<span class="token comment"># Default primary key field type</span>
<span class="token comment"># https://docs.djangoproject.com/en/4.2/ref/settings/#default-auto-field</span>
<span class="token comment"># 默认主键类型a</span>
DEFAULT_AUTO_FIELD <span class="token operator">=</span> <span class="token string">'django.db.models.BigAutoField'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-测试服务器的启动"><a href="#4-测试服务器的启动" class="headerlink" title="4. 测试服务器的启动"></a>4. 测试服务器的启动</h3><p><code>python manage.py runserver [ip:port]</code> 记得关防火墙</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">可以直接进行服务运行 默认执行起来的端口是8000

也可以自己指定ip和端口:
1.监听机器所有可用 ip(电脑可能有多个内网ip或多个外网ip)
	python manage.py runserver 0.0.0.0:8000

2.同时在settings.py中将
	ALLOWED_HOSTS=['*']

3.在其他局域网电脑上可以通过在浏览器输入 Django项目所在电脑的 IP:8000 来访问<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-数据迁移"><a href="#5-数据迁移" class="headerlink" title="5. 数据迁移"></a>5. 数据迁移</h3><p><code>迁移的概念:就是将模型迁移到数据库的过程</code></p>
<p>生成迁移文件: python manage.py makemigrations (可加具体应用)</p>
<p>执行迁移: python manage.py migrate (可加具体应用)</p>
<blockquote>
<p>不需要初始化迁移文件夹,每个应用默认有迁移文件夹 migrations</p>
</blockquote>
<h3 id="6-创建应用"><a href="#6-创建应用" class="headerlink" title="6. 创建应用"></a>6. 创建应用</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python manage.py startapp App<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建名称为 App 的应用<br>使用应用前需要将应用配置到项目中，<strong>在<code>settings.py</code>中将应用加入到<code>INSTALLED_APPS</code>选项中</strong></p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">应用目录介绍:
__init__·py:
	其中暂无内容，使得app成为一个包
admin.py:
	管理站点模型的声明文件，默认为空
apps.py:
	应用信息定义文件，在其中生成了AppConfig，该类用于定义应用名等数据
models.py:
	添加模型层数据类文件
views.py:
	定义URL相应函数
migrations包:
	自动生成，生成迁移文件的
tests.py:
	测试代码文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-基本视图"><a href="#7-基本视图" class="headerlink" title="7. 基本视图"></a>7. 基本视图</h3><p><code>首先我们在应用的views.py中建立一个路由响应函数</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">def</span> <span class="token function">welcome</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 视图函数需要带参数request</span>
	<span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'HelloDjango'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment"># 渲染模板的方式(在你的应用新建一个templates文件夹,里面放index.html)</span>
    <span class="token comment"># return render(request, 'index.html')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>然后在项目根目录下的urls.py文件中注册路由函数,当有前端请求对应路径时,会交给路由函数处理</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span>include
<span class="token keyword">from</span> user<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 视图函数对应路由</span>
    <span class="token comment"># 直接访问视图函数,没有访问子路由</span>
    path<span class="token punctuation">(</span><span class="token string">'welcome/'</span><span class="token punctuation">,</span> welcome<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># welcome指你的路由响应函数</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样当请求<code>127.0.0.1:8000/welcome/</code>时,会获得 HelloDjango 响应</p>
<h4 id="使用子路由的响应"><a href="#使用子路由的响应" class="headerlink" title="使用子路由的响应"></a>使用子路由的响应</h4><p><code>在应用app中新建urls.py,结构与根目录下urls.py类似</code></p>
<p><code>app/urls.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> user<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># 子路由</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># url路由写法(正则)</span>
    <span class="token comment"># url(r'^index/', index),</span>

    <span class="token comment"># v2.0,v3.0,v4.x版本的路由写法</span>
    path<span class="token punctuation">(</span><span class="token string">'welcome/'</span><span class="token punctuation">,</span>welcome<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'welcome'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'welcome2/'</span><span class="token punctuation">,</span>welcome2<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'welcome2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 子路由写法如下</span>
urlpatterns <span class="token operator">=</span><span class="token punctuation">[</span>
	<span class="token comment"># django1.8，2.0正则表达式写法:不再使用,不推荐</span>
    <span class="token comment"># url(r'^index/$',index),</span>
	<span class="token comment"># Djangov2.0，v3.0，v4.0写法:常用</span>
    path<span class="token punctuation">(</span><span class="token string">r'hello/'</span><span class="token punctuation">,</span>hello<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># name是这条路由的名字,以后做重定向会用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>接着我们在 urls.py 中进行注册</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 1.直接访问视图</span>
<span class="token comment"># path(r'hello/',hello, name='hello'),</span>
<span class="token comment"># 2.导入App中的子路由urls.py文件</span>
path<span class="token punctuation">(</span><span class="token string">'app/'</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">'App.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 3.使用命名空间</span>
<span class="token comment">#path('app/',include(('App.urls','App'),namespace='App'))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样当我们访问<code>127.0.0.1:8000/app/welcome</code>会返回 welcome,访问<code>127.0.0.1:8000/app/welcome2</code>会返回 welcome2</p>
<h3 id="前后端交互"><a href="#前后端交互" class="headerlink" title="前后端交互"></a>前后端交互</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92.png" alt="	"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/Django%E6%A1%86%E6%9E%B6%E6%B5%81%E7%A8%8B.png" alt="image-20241123155328362"></p>
<h3 id="8-基本模板"><a href="#8-基本模板" class="headerlink" title="8. 基本模板"></a>8. 基本模板</h3><p><code>模板文件夹templates</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">模板实际上就是我们用HTML写好的页面
创建模板文件夹templates，在模板文件夹中创建模板文件
在views中去加载渲染模板，使用render函数<span class="token punctuation">:</span>
<span class="token keyword">return</span> render<span class="token punctuation">(</span>request，<span class="token string">'index.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="9-定义模型"><a href="#9-定义模型" class="headerlink" title="9. 定义模型"></a>9. 定义模型</h3><p>在models.py中引入models</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建自己的模型类，但切记要<code>继承自 models.Model</code></p>
<p>案例驱动: 使用模型定义班级，并在模板上显示班级列表</p>
<ol>
<li>修改<code>user/models.py</code> (<code>__str__函数</code>是用于规定打印输出时转换成什么字符串)</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>

<span class="token comment"># 模型 &lt;==> 数据库表   相对应</span>
<span class="token comment"># 模型类属性 &lt;==> 数据库表字段   相对应</span>
<span class="token comment"># 模型类实例 &lt;==> 数据库表记录   相对应</span>
<span class="token comment"># 模型类方法 &lt;==> 数据库表记录   相对应</span>
<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 姓名 字符串类型 最大长度32 name varchar(32)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>  <span class="token comment"># 年龄 整型 age int default 18</span>
    sex <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 性别 字符串类型 最大长度10 sex varchar(10) </span>
    is_delete <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 是否删除 布尔类型 is_delete boolean default false</span>

	<span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span> <span class="token comment"># 修改__str__方法, 方便在admin中查看对象信息</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>age<span class="token punctuation">&#125;</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>sex<span class="token punctuation">&#125;</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>is_delete<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
<span class="token comment"># 表字段</span>
<span class="token comment"># name - 用户名称</span>
<span class="token comment"># age - 年龄</span>
<span class="token comment"># sex - 性别</span>
<span class="token comment"># is_delete - 是否删除</span>

<span class="token comment"># 注意:</span>
<span class="token comment"># 数据迁移 models对应的表结构一旦改变, 必须执行迁移命令才会更新数据库表结构</span>
<span class="token comment"># `迁移的概念:就是将模型迁移到数据库的过程`</span>
<span class="token comment"># 生成迁移文件: python manage.py makemigrations</span>
<span class="token comment"># 执行迁移: python manage.py migrate</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>新增视图函数</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 视图函数</span>
<span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取所有用户信息</span>
    users <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 传递给模板</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'users.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'users'</span><span class="token punctuation">:</span> users<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>在<code>templates文件夹</code>中新增users.html对应于视图函数,注意模板语法</li>
</ol>
<p><code>假如是pycharm开发,记得在设置中 找到template语法设置为 Django </code></p>
<pre class="line-numbers language-django" data-language="django"><code class="language-django"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>所有用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>所有用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
      <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">user</span> <span class="token keyword">in</span> <span class="token variable">users</span> <span class="token delimiter punctuation">%&#125;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">name</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>, <span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">age</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>

      <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>最后,更改路由设置</li>
</ol>
<p><code>path(&quot;users/&quot;,get_user,name=&quot;users&quot;)</code></p>
<h3 id="10-admin后台管理系统"><a href="#10-admin后台管理系统" class="headerlink" title="10. admin后台管理系统"></a>10. admin后台管理系统</h3><p>在admin.py中将model加入后台管理</p>
<p><code>admin.site.register(GradeModel)</code></p>
<p>创建超级用户: <code>python manage.py create superuser</code>(相应的,在数据库中的auth_user表也会多一个超级管理员记录)</p>
<p>访问admin后台:<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E7%AE%A1%E7%90%86%E5%91%98%E7%95%8C%E9%9D%A2.png" alt="image-20241123204004601"></p>
<p>可以在settings中设置<code>LANGUAGE_CODE = zh-hans</code>设置中文</p>
<h2 id="二、Django路由Router"><a href="#二、Django路由Router" class="headerlink" title="二、Django路由Router"></a>二、Django路由Router</h2><p>在实际开发过程中，一个Django 项目会包含很多的 app ，这时候如果我们只在主路由里进行配置就会显得杂乱无章，所以通常会在每个 app 里，创建<code>各自的urls.py路由模块</code>，然后从根路由出发，将 app 所属的 url 请求，全部转发到相应的 urls.py 模块中。而这个从主路由转发到各个应用路由的过程叫做<code>路由的分发</code></p>
<h3 id="re-path正则路由的写法"><a href="#re-path正则路由的写法" class="headerlink" title="re_path正则路由的写法"></a>re_path正则路由的写法</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># re_path正则写法 ()表示正则分组为一个参数 (?P&lt;参数名>regex)</span>
re_path<span class="token punctuation">(</span><span class="token string">r'^user_view_ab/(?P&lt;a>\d+)/(?P&lt;b>\d+)/$'</span><span class="token punctuation">,</span> user_view_ab<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"user_view_ab"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这样就是匹配<code>user_view_ab/1/2</code>等数字参数</p>
<h3 id="路由匹配"><a href="#路由匹配" class="headerlink" title="路由匹配"></a><code>路由匹配</code></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用url给视图函数传参数</span>
path<span class="token punctuation">(</span><span class="token string">'index/'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
path<span class="token punctuation">(</span><span class="token string">'detail/&lt;int:id>/'</span><span class="token punctuation">,</span> detail<span class="token punctuation">)</span>


<span class="token comment"># 给url取别名，那么在使用此url的地方(例如页面模板反向解析)可以使用别名。比如:</span>
path<span class="token punctuation">(</span><span class="token string">'index/'</span><span class="token punctuation">,</span>index<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span>
path<span class="token punctuation">(</span><span class="token string">'detail/&lt;int:id>/'</span><span class="token punctuation">,</span> detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'detail'</span><span class="token punctuation">)</span>

根据路由的name属性<span class="token punctuation">,</span>获取路由url
reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> 路由<span class="token string">'index/'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h3><p><code>Django路由反向解析</code>是一个非常重要的功能，它可以让我们在代码中使用路由别名替代URL路径，在修改URL时避免代码中的硬编码依赖，同时也可以提高可读性和可维护性。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 在视图函数中，反向解析url:</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>reverse
<span class="token keyword">def</span> <span class="token function">buy</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'detail'</span><span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'detail'</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#在templates中，使用别名:</span>
	<span class="token punctuation">&#123;</span><span class="token operator">%</span> url <span class="token string">'detail'</span> stu<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    
<span class="token comment"># 使用命名空间:</span>
<span class="token comment"># 指定命令空间后，使用反向解析时需要加上命名空间，比如:</span>
<span class="token comment">#	1.在视图函数中:</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'App:index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#	2.在templates中:</span>
	<span class="token punctuation">&#123;</span><span class="token operator">%</span> url <span class="token string">'App:index'</span><span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="页面之间相互跳转-通过html"><a href="#页面之间相互跳转-通过html" class="headerlink" title="页面之间相互跳转(通过html)"></a>页面之间相互跳转(通过html)</h3><ol>
<li>在根目录下的<code>urls.py</code>添加如下代码</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include<span class="token punctuation">,</span> path
<span class="token keyword">from</span> App<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 使用子路由: </span>
    path<span class="token punctuation">(</span><span class="token string">"user/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"App.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment"># 使用子路由: 使用命名空间</span>
    path<span class="token punctuation">(</span><span class="token string">"user/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"App.urls"</span><span class="token punctuation">,</span><span class="token string">"App"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">"App"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>App&#x2F;urls.py子路由文件</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> tkinter<span class="token punctuation">.</span>font <span class="token keyword">import</span> names
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> App<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token operator">*</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 首页</span>
    path<span class="token punctuation">(</span><span class="token string">'index/'</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 用户列表</span>
    path<span class="token punctuation">(</span><span class="token string">'user_list/'</span><span class="token punctuation">,</span> user_list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user_list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>定义<code>视图函数</code>和 <code>user_list.html</code>文件</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 用户列表</span>
<span class="token keyword">def</span> <span class="token function">user_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'user_list.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>在想要添加跳转链接的页面(<strong>这里只使用后端的Django跳转方式,不使用前端超链接</strong>)添加代码</li>
</ol>
<pre class="line-numbers language-django" data-language="django"><code class="language-django"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Index<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">comment</span> <span class="token delimiter punctuation">%&#125;</span></span> url路由来跳转 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endcomment</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/user_list/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>url路由跳转: 进入用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>

    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">comment</span> <span class="token delimiter punctuation">%&#125;</span></span> 反向解析来跳转 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endcomment</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">url</span> <span class="token string">'user_list'</span> <span class="token delimiter punctuation">%&#125;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>反向解析跳转: 进入用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    user_list是路由路径的name值
      url 是Django的模板,用于生成url
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>

    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">comment</span> <span class="token delimiter punctuation">%&#125;</span></span> 带命名空间的反向解析 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endcomment</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">url</span> <span class="token string">'App:user_list'</span> <span class="token delimiter punctuation">%&#125;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>带命名空间的反向解析: 进入用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>url路由跳转方式: 链接路径为 127.0.0.1:8000后面的内容</li>
<li>反向解析来跳转: 反向解析就是从 html页面(点击) -&gt; 找到路由 -&gt; 找到视图函数(<code>user_list是路由路径的name值</code>)</li>
<li>带命名空间的反向解析: 命名空间就是<code>根/urls.py文件include方法</code>中指定的<code>namespace</code>,命名空间就是为了使不同的应用之间可以使用相同的子路由路径名(例如上面的user_list)</li>
</ul>
<h3 id="路由传参-单个参数"><a href="#路由传参-单个参数" class="headerlink" title="路由传参(单个参数)"></a>路由传参(单个参数)</h3><p>在<code>App</code>的子路由中新增以下路由规则</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 详情页 &lt;> 号内为参数传给user_detail视图函数</span>
path<span class="token punctuation">(</span><span class="token string">'user_detail/&lt;int:uid>/'</span><span class="token punctuation">,</span> user_detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user_detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>定义视图函数<code>user_detail</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 用户列表</span>
<span class="token keyword">def</span> <span class="token function">user_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取所有用户数据</span>
    users <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'user_list.html'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">"users"</span><span class="token punctuation">:</span>users<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># uid从路由参数中获取</span>
    <span class="token comment"># print("uid",uid)</span>
    <span class="token comment"># 获取单个用户数据</span>
    user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>uid<span class="token punctuation">)</span>    <span class="token comment"># pk是主键primary key</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'user_detail.html'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">"user"</span><span class="token punctuation">:</span>user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment"># 传递参数到模板中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>在user_list.html文件中接收</code>user_list传过来的users参数,遍历(利用模板语法添加li&gt;a标签)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%8201.png" alt="image-20241124122311334"></p>
<pre class="line-numbers language-django" data-language="django"><code class="language-django"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
            <span class="token selector">a</span> <span class="token punctuation">&#123;</span>
                <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">user</span> <span class="token keyword">in</span> <span class="token variable">users</span> <span class="token delimiter punctuation">%&#125;</span></span> <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">comment</span> <span class="token delimiter punctuation">%&#125;</span></span> 反向解析 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endcomment</span> <span class="token delimiter punctuation">%&#125;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span><span class="token tag keyword">url</span> <span class="token string">'App:user_detail'</span> <span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">id</span><span class="token delimiter punctuation">%&#125;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span><span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">name</span><span class="token delimiter punctuation">&#125;&#125;</span></span> - <span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span><span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">age</span><span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以,最终生成的a标签变成了<code>&lt;a href=&quot;/user/user_detail/1/&quot;&gt;张三 - 19&lt;/a&gt;</code></p>
<blockquote>
<p>整个过程就是按顺序发生</p>
<ul>
<li>首先用户访问user&#x2F;user_list.html界面,程序调用<code>视图函数</code>获取所有用户列表并传参</li>
<li>在<code>user_list</code>函数中,程序渲染<code>本地的user_list.html</code>返回,在渲染的过程中,将uset_list()中获取的用户列表逐个渲染成具体的链接</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>这是对模板语法的解释</strong></li>
<li><code>url</code> 代表当前界面的url, <code>App:user_detail</code>表示到根路由<code>path(&quot;user/&quot;, include((&quot;App.urls&quot;,&quot;App&quot;), namespace=&quot;App&quot;))</code>中在逐层(<code>include((&quot;App.urls&quot;,&quot;App&quot;)</code>,从应用App的urls.py子路由文件)找到名为<code>user_detail</code>的路由项</li>
<li>找到如下所示<code>path(&#39;user_detail/&lt;int:uid&gt;/&#39;, user_detail, name=&#39;user_detail&#39;)</code></li>
<li>然后<code>user.id</code>就是把id属性传给路由参数,相对于变成&#96;&#96;path(‘user_detail&#x2F;user.id&#x2F;‘, user_detail, name&#x3D;’user_detail’)&#96;</li>
</ul>
</blockquote>
<h3 id="路由参数支持的类型"><a href="#路由参数支持的类型" class="headerlink" title="路由参数支持的类型"></a>路由参数支持的类型</h3><p>Django支持多种类型的路由参数，常见的有：</p>
<ol>
<li><strong>int</strong>：接收整数，如 <code>&lt;int:user_id&gt;</code>。</li>
<li><strong>str</strong>：接收字符串，如 <code>&lt;str:username&gt;</code>。</li>
<li><strong>slug</strong>：接收短横线连接的字符串，如 <code>&lt;slug:slug&gt;</code>。</li>
<li><strong>uuid</strong>：接收UUID，如 <code>&lt;uuid:uuid&gt;</code>。</li>
<li><strong>path</strong>：接收包含斜杠的字符串，如 <code>&lt;path:subpath&gt;</code>。</li>
</ol>
<h3 id="路由传参-多参数"><a href="#路由传参-多参数" class="headerlink" title="路由传参(多参数)"></a>路由传参(多参数)</h3><p><strong>视图函数</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">user_view_ab</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"a=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string">,b=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>子路由</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 带参数的视图函数,注意,参数的名字必须和视图函数中参数的名字一致</span>
path<span class="token punctuation">(</span><span class="token string">"user_view_ab/&lt;int:a>/&lt;int:b>/"</span><span class="token punctuation">,</span> user_view_ab<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"user_view_ab"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>注意!!! 参数名称要对应</code></p>
<h3 id="重定向redirect函数"><a href="#重定向redirect函数" class="headerlink" title="重定向redirect函数"></a>重定向<code>redirect</code>函数</h3><blockquote>
<p>在视图函数中,可以重定向到别的网页或者路径</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">path<span class="token punctuation">(</span><span class="token string">'user_detail/&lt;int:a>/'</span><span class="token punctuation">,</span>user_detail<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'userdetail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">def</span> user_detail<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"user_detail"</span><span class="token punctuation">)</span>
<span class="token comment"># 重定向</span>
<span class="token keyword">def</span> <span class="token function">my_redirect</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">my_redirect2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/user/user_list/'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">my_redirect3</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># reverse反向解析(根据路由name属性找到对应url)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'user_list'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 相当于  return redirect(/user/user_list/)</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'App:userdetail'</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 传参给path('user_detail/&lt;int:a>/',user_detail,name='userdetail'),args=元组或列表,kawrgs=字典</span>
	<span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'App:userdetail'</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在子路由中增加重定向部分</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 用户列表(原有)</span>
path<span class="token punctuation">(</span><span class="token string">'user_list/'</span><span class="token punctuation">,</span> user_list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user_list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'user_detail/&lt;int:a>/'</span><span class="token punctuation">,</span>user_detail<span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'userdetail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment"># 重定向</span>
path<span class="token punctuation">(</span><span class="token string">'myredirect/'</span><span class="token punctuation">,</span> my_redirect<span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'myredirect2/'</span><span class="token punctuation">,</span> my_redirect2<span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'myredirect3/'</span><span class="token punctuation">,</span> my_redirect3<span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="render和redirect的区别"><a href="#render和redirect的区别" class="headerlink" title="render和redirect的区别"></a>render和redirect的区别</h3><p>在Django中，<code>redirect</code> 和 <code>render</code> 是两个用于处理HTTP请求并返回响应的函数，但它们的作用和使用场景有所不同。</p>
<ol>
<li><p><code>redirect</code> 函数：</p>
<ul>
<li><code>redirect</code> 函数用于重定向到另一个URL。它接受一个URL作为参数，可以是一个绝对URL，也可以是一个相对URL。</li>
<li>当使用 <code>redirect</code> 时，Django会向客户端发送一个HTTP重定向响应，告诉客户端去访问指定的URL。</li>
<li>重定向通常用于用户完成某个操作后，将其引导到另一个页面，例如登录成功后重定向到用户的个人资料页面。</li>
</ul>
<p> 示例代码：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect

<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 重定向到另一个视图</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/some/other/view/'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>render</code> 函数：</p>
<ul>
<li><code>render</code> 函数用于渲染一个模板并返回一个HTTP响应。它接受三个参数：请求对象、模板名称和一个包含模板上下文数据的字典。</li>
<li>当使用 <code>render</code> 时，Django会将模板上下文数据填充到模板中，然后将渲染后的HTML内容作为响应返回给客户端。</li>
<li><code>render</code> 通常用于显示页面内容，例如显示一个表单、一个列表或者一个详细信息页面。</li>
</ul>
<p> 示例代码：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 渲染模板并返回响应</span>
    context <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'my_template.html'</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>总结：</p>
<ul>
<li><code>redirect</code> 用于重定向到另一个URL，发送一个HTTP重定向响应。</li>
<li><code>render</code> 用于渲染模板并返回一个HTTP响应，包含渲染后的HTML内容。</li>
</ul>
<p>在你的代码中，如果你想在用户上传图片后重定向到 <code>showicon</code> 页面，你应该使用 <code>redirect</code> 函数，因为你需要告诉客户端去访问另一个URL。如果你使用 <code>render</code> 函数，它将渲染 <code>showicon.html</code> 模板并返回响应，但这不会改变URL，用户仍然停留在当前页面。</p>
<p>所以，正确的代码应该是:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'showicon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样，当用户上传图片后，他们将被重定向到 <code>showicon</code> 页面。</p>
<h2 id="三、Django模板"><a href="#三、Django模板" class="headerlink" title="三、Django模板"></a>三、Django模板</h2><h3 id="模板Templates"><a href="#模板Templates" class="headerlink" title="模板Templates"></a>模板Templates</h3><blockquote>
<p>在Django框架中，模板是可以帮助开发者快速生成呈现给用户页面的工具</p>
<p>模板的设计方式实现了我们MVT中VT的<code>解耦(M:Model，V:View，T:Template)</code>，VT有着N:M的关系，一个V可以调用任意T，一个T可以供任意V使用</p>
<p>模板处理分为两个过程</p>
<ul>
<li>加载HTML</li>
<li>渲染数据  render()</li>
</ul>
<p>模板主要有两个部分</p>
<ul>
<li><p>HTML静态代码</p>
</li>
<li><p>模板语言，动态插入的代码段(挖坑，填坑) </p>
</li>
<li><p>模板中的动态代码段除了做基本的静态填充，还可以实现一些基本的运算，转换和逻辑</p>
</li>
</ul>
<p>静态页面: 页面数据是本地固定的<br>动态页面: 页面数据来源于后台服务器</p>
<p><strong><code>模板中的变量:视图传递给模板的数据，遵守标识符规则</code></strong></p>
<p>​	语法:<br>​	如果变量不存在，则插入空字符串</p>
<p><strong>方法不能有参数</strong></p>
<p>​	</p>
<p>​	 # 不能带括号</p>
<p>​	 </p>
<p>​	</p>
<p><strong>列表,使用索引,不允许使用负索引</strong></p>
<p>​	items &#x3D; [‘apple’ ‘bananas’]</p>
<p>​	<code>&#123;&#123; items.1 &#125;&#125; </code></p>
</blockquote>
<ul>
<li><code>MVC软件设计模式</code>: Model(数据库),View(界面),Controller(控制器,相当于Django的视图函数)</li>
<li><code>MVT : M:Model(数据库)，V:View视图函数，T:Template(界面)</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="image-20241124210843757"></p>
<blockquote>
<p><strong><code>模板中的标签</code></strong></p>
<p>​	<code>语法: &#123;&#123;% tag %&#125;&#125;</code></p>
<p>作用: </p>
<ol>
<li>加载外部传入的变量</li>
<li>在输出中创建文本</li>
<li><code>控制循环或逻辑</code></li>
</ol>
</blockquote>
<pre class="line-numbers language-django" data-language="django"><code class="language-django">if 语句:

  格式: 
    if单分支
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span>表达式 <span class="token delimiter punctuation">%&#125;</span></span> 语句   <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>

   if双分支
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span>表达式 <span class="token delimiter punctuation">%&#125;</span></span> 语句 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%&#125;</span></span> 语句2  <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>

   if多分支
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span>表达式 <span class="token delimiter punctuation">%&#125;</span></span> 语句 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">elif</span>表达式 <span class="token delimiter punctuation">%&#125;</span></span> 语句2 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%&#125;</span></span> 语句3 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>

判断true或者false(可以使用and or not in,语法与python类似)

	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span> <span class="token variable">tody_is_weekend</span> <span class="token delimiter punctuation">%&#125;</span></span>
		\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Welcome to the weekend!!!\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>

使用 in 和 not in
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span> <span class="token variable">user</span> <span class="token keyword">in</span> <span class="token variable">users</span> <span class="token delimiter punctuation">%&#125;</span></span>
		\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>User已经存在<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-django" data-language="django"><code class="language-django">for 语句
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> 变量 <span class="token keyword">in</span> 列表	<span class="token delimiter punctuation">%&#125;</span></span>
		语句1
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">empty</span> <span class="token delimiter punctuation">%&#125;</span></span>
		语句2
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>
	当列表为空或者不存在的时候,执行empty后的语句

===================forloop.counter示例=================
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">forloop</span><span class="token punctuation">.</span><span class="token variable">counter</span> <span class="token delimiter punctuation">%&#125;</span></span> 表示当前是第几次循环,从1开始
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">item</span> <span class="token keyword">in</span> <span class="token variable">todo_list</span> <span class="token delimiter punctuation">%&#125;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span> <span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span><span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">counter</span><span class="token delimiter punctuation">&#125;&#125;</span></span> : <span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">item</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>

	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">counter0</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>表示当前是第几次循环，从0开始
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">revcounter</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>表示当前是第几次循环，倒着数数，到1停
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">for1oop</span><span class="token punctuation">.</span><span class="token variable">revcounter</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>表示当前第几次循环，倒着数，到0停
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">first</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>是否是第一个 布尔值

<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">object</span> <span class="token keyword">in</span> <span class="token variable">objects</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">first</span> <span class="token delimiter punctuation">%&#125;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">object</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">else</span> <span class="token delimiter punctuation">%&#125;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">object</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>

<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">link</span> <span class="token keyword">in</span> <span class="token variable">links</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">link</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">if</span> <span class="token keyword">not</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">last</span> <span class="token delimiter punctuation">%&#125;</span></span>|<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%&#125;</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>

===================forloop.parentloop示例=================
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">country</span> <span class="token keyword">in</span> <span class="token variable">countries</span> <span class="token delimiter punctuation">%&#125;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">for</span> <span class="token variable">city</span> <span class="token keyword">in</span> <span class="token variable">country</span><span class="token punctuation">.</span><span class="token variable">city_list</span> <span class="token delimiter punctuation">%&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>Country #<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">parentloop</span><span class="token punctuation">.</span><span class="token variable">counter</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>City #<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">forloop</span><span class="token punctuation">.</span><span class="token variable">counter</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">city</span> <span class="token delimiter punctuation">&#125;&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E6%A0%87%E7%AD%BE.png" alt="image-20241124221016900"></p>
<pre class="line-numbers language-django" data-language="django"><code class="language-django">注释:
	单行注释
	<span class="token django language-django"><span class="token comment">&#123;# 被注释掉的内容 #&#125;</span></span>
	多行注释
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">comment</span> <span class="token delimiter punctuation">%&#125;</span></span> 多行内容 <span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endcomment</span> <span class="token delimiter punctuation">%&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-django" data-language="django"><code class="language-django">过滤器:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">var</span><span class="token operator">|</span>过滤器 <span class="token delimiter punctuation">&#125;&#125;</span></span>
	作用: 在变量显示前修改

add:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">value</span><span class="token operator">|</span><span class="token filter function">add</span><span class="token punctuation">:</span><span class="token number">2</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
	没有减法过滤器，但加法里可以加负数：
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">value</span><span class="token operator">|</span><span class="token filter function">add</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
lower:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">name</span><span class="token operator">|</span><span class="token filter function">lower</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
upper:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">my_list</span><span class="token operator">|</span><span class="token filter function">fisrt</span><span class="token operator">|</span><span class="token filter function">upper</span> <span class="token delimiter punctuation">&#125;&#125;</span></span> 将my_list的第一个值变成大写
截断:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">bio</span><span class="token operator">|</span><span class="token filter function">truncatechars</span><span class="token punctuation">:</span><span class="token number">30</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
	
过滤器可以传递参数，参数需要使用引号引起来,
	比如join:<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">students</span><span class="token operator">|</span><span class="token filter function">join</span><span class="token punctuation">:</span><span class="token string">'='</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>

默认值: default，格式<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">var</span><span class="token operator">|</span><span class="token filter function">default</span><span class="token punctuation">:</span><span class="token variable">value</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
	如果变量没有被提供或者为False，空，会使用默认值

根据指定格式转换日期为字符串，处理时间的
	就是针对date进行的转换<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">dateVal</span> <span class="token operator">|</span> <span class="token variable">date</span><span class="token punctuation">:</span><span class="token string">'y-m-d'</span><span class="token delimiter punctuation">&#125;&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-django" data-language="django"><code class="language-django">HTML转义:
	将接收到的数据当成普通字符串处理还是当成HTML代码来渲染的一个问题

渲染成html:
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">code</span><span class="token operator">|</span><span class="token filter function">safe</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>
关闭自动转义 
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">autoescape</span> <span class="token variable">off</span> <span class="token delimiter punctuation">%&#125;</span></span>
		code
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endautoescape</span> <span class="token delimiter punctuation">%&#125;</span></span>
打开自动转义转义
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">autoescape</span> <span class="token variable">on</span> <span class="token delimiter punctuation">%&#125;</span></span>
	code
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endautoescape</span> <span class="token delimiter punctuation">%&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8Chtml%E8%BD%AC%E4%B9%89.png" alt="image-20241125113906892"></p>
<pre class="line-numbers language-django" data-language="django"><code class="language-django">模板继承:
	block:
		<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">block</span> <span class="token variable">XXX</span> <span class="token delimiter punctuation">%&#125;</span></span>
			code
		<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%&#125;</span></span>

	extends 继承，写在开头位置
		<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">extends</span><span class="token string">'父模板路径'</span><span class="token delimiter punctuation">%&#125;</span></span>
	
	include:加载模板进行渲染
		<span class="token django language-django"><span class="token delimiter punctuation">&#123;%</span> <span class="token tag keyword">include</span><span class="token string">'模板文件'</span><span class="token delimiter punctuation">%&#125;</span></span>
	
	<span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span> <span class="token variable">block</span><span class="token punctuation">.</span><span class="token variable">super</span> <span class="token delimiter punctuation">&#125;&#125;</span></span>:获取父模板中block中的内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF1.png" alt="image-20241125115722854"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF2.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF3.png" alt="image-20241125115904169"></p>
<h3 id="在Django模板中使用jinja2模板引擎"><a href="#在Django模板中使用jinja2模板引擎" class="headerlink" title="在Django模板中使用jinja2模板引擎"></a>在Django模板中使用jinja2模板引擎</h3><p><code>Jinja2</code>是之前我们在<code>Flask框架</code>讲过的一个模板引擎，是模仿Django默认模板引擎基础上开发的，比Django模板引擎性能更好，功能更全.</p>
<blockquote>
<p>jinja2宣称比django默认模板引擎快10-20倍。Django也支持jinja2</p>
</blockquote>
<h4 id="1-安装jinja2模块"><a href="#1-安装jinja2模块" class="headerlink" title="1.安装jinja2模块"></a>1.安装jinja2模块</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">pip install jinja2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-在settings-py所在的目录中创建jinja2-env-py文件-并写入以下内容"><a href="#2-在settings-py所在的目录中创建jinja2-env-py文件-并写入以下内容" class="headerlink" title="2.在settings.py所在的目录中创建jinja2_env.py文件,并写入以下内容"></a>2.在settings.py所在的目录中创建jinja2_env.py文件,并写入以下内容</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>templatetags<span class="token punctuation">.</span>static <span class="token keyword">import</span> static
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> jinja2 <span class="token keyword">import</span> Environment

<span class="token keyword">def</span> <span class="token function">environment</span><span class="token punctuation">(</span><span class="token operator">**</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>
	env <span class="token operator">=</span> Environment<span class="token punctuation">(</span><span class="token operator">**</span>options<span class="token punctuation">)</span>
    env<span class="token punctuation">.</span><span class="token builtin">globals</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
		<span class="token string">'static'</span><span class="token punctuation">:</span> static<span class="token punctuation">,</span>
		<span class="token string">'url'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-修改项目的settings-py文件"><a href="#3-修改项目的settings-py文件" class="headerlink" title="3.修改项目的settings.py文件"></a>3.修改项目的settings.py文件</h4><p>原本的不能删除</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># 使用jinja2模板引擎</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.jinja2.Jinja2'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token comment"># 这里要添加environment变量,指向自定义的jinja2环境,DjangoPro2项目目录下的jinja2_env.py文件里面的environment函数</span>
            <span class="token string">"environment"</span><span class="token punctuation">:</span> <span class="token string">"DjangoPro2.jinja2_env.environment"</span><span class="token punctuation">,</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment"># 原来自带的Django模板引擎</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-在修改Pycharm中settings的模板语言为Jinja2"><a href="#4-在修改Pycharm中settings的模板语言为Jinja2" class="headerlink" title="4.在修改Pycharm中settings的模板语言为Jinja2"></a>4.在修改Pycharm中settings的模板语言为Jinja2</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/pycharm%E4%BF%AE%E6%94%B9jinja2.png" alt="image-20241125130810745"></p>
<h3 id="创建html文件-使用Jinja2语法"><a href="#创建html文件-使用Jinja2语法" class="headerlink" title="创建html文件,使用Jinja2语法"></a>创建html文件,使用Jinja2语法</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Jinja2模板语言<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Jinja2模板语言<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>name = &#123;&#123; name &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

    &#123;% for n in name %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span>&#123;&#123;n&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span>
    &#123;% endfor %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>

    &#123;% for n in name %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;loop.index&#125;&#125; : &#123;&#123;n&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    &#123;% endfor %&#125;

    &#123;# Jinja2是可以使用带括号的函数调用的 #&#125;
    &#123;% for i in range(1, 10) %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;i&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    &#123;% endfor %&#125;
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意: 这只是一个简单的Jinja2模板语法示例,要使用更多语法,可以查阅以下资料</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ak_bingbing/article/details/135788226">深入剖析Jinja2语法：高效开发的关键技巧_jinja2 函数-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.jinkan.org/docs/jinja2/">欢迎来到 Jinja2 — Jinja2 2.7 documentation</a></li>
</ul>
<h2 id="四、Django模型基础"><a href="#四、Django模型基础" class="headerlink" title="四、Django模型基础"></a>四、Django模型基础</h2><h3 id="1-models字段类型"><a href="#1-models字段类型" class="headerlink" title="1. models字段类型"></a>1. models字段类型</h3><blockquote>
<p><strong>概述</strong></p>
<p>django根据属性的类型确定以下信息</p>
<ul>
<li>当前选择的数据库支持字段的类型</li>
<li>渲染管理表单时使用的默认html控件</li>
<li>在管理站点最低限度的验证</li>
</ul>
<p>django会为表增加自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后则django不会再生成默认的主键列</p>
</blockquote>
<blockquote>
<p><strong>属性命名限制</strong></p>
<ul>
<li><p>遵循标识符规则</p>
</li>
<li><p>由于django的查询方式，不允许使用连续的下划线定义属性时，</p>
</li>
</ul>
<p>需要字段类型，字段类型被定义在diango.db.models.fields目录下，为了方便使用被导入到django.db.models中</p>
</blockquote>
<blockquote>
<p><strong>使用方式</strong></p>
<ul>
<li>导入from django.db import models</li>
<li>通过models.Field创建字段类型的对象，赋值给属性</li>
</ul>
</blockquote>
<blockquote>
<p><strong>逻辑删除和物理删除</strong></p>
<p>对于重要数据都做逻辑删除，不做物理删除，实现方法是定义is_delete属性，类型为BooleanField,默认值为False<br>is_delete &#x3D; models.BooleanField(default&#x3D;False)</p>
</blockquote>
<blockquote>
<p><strong>常用字段类型</strong></p>
<ul>
<li><p><code>AutoField</code>: 一个根据实际ID自动增长的IntegerField，通常不指定，如果不指定，主键字段id将自动添加到模型中</p>
</li>
<li><p><code>CharField</code>(max_length&#x3D;字符长度)</p>
</li>
<li><p>字符串，默认的表单样式是 Input</p>
</li>
<li><p><code>TextField</code><br>大文本字段，一般超过4000使用，默认的表单控件是Textarea</p>
</li>
<li><p><code>IntegerField</code></p>
</li>
<li><p>整数</p>
</li>
<li><p><code>DecimalField(max_digits=None,decimal_places=None)</code></p>
</li>
<li><p>使用python的Decimal实例表示的十进制浮点数</p>
</li>
<li><p>参数说明</p>
<ul>
<li>DecimalField.max_digits -&gt; 位数总数</li>
<li>DecimalField.decimal_places -&gt; 小数点后的数字位数</li>
</ul>
</li>
<li><p><code>FloatField</code>: 用Python的float实例来表示的浮点数</p>
</li>
<li><p><code>BooleanField</code></p>
</li>
<li><p>True&#x2F;False 字段，此字段的默认表单控制是CheckboxInput</p>
</li>
<li><p><code>DateField([auto_now=False,auto_now_add=False])</code></p>
</li>
<li><p>使用Python的datetime.date实例表示的日期参数说明</p>
</li>
<li><p>参数说明</p>
<ul>
<li>DateField.auto_now<br>  每次保存对象时，自动设置该字段为当前时间，用于**”最后一次修改”**的时间戳，它总是使用当前日期，默认为false</li>
<li>DateField.auto_now_add<br>  当对象第一次被创建时自动设置当前时间，用于<strong>创建</strong>的时间戳，它总是使用创建时的日期，默认为false</li>
<li>注意:auto_now_add，auto_now，and_default 这些设置是相互排斥的他们之间的任何组合将会发生错误的结果</li>
</ul>
</li>
<li><p><code>TimeField</code>: 使用Python的datetime.time实例表示的时间，参数同DateField</p>
</li>
<li><p><code>DateTimeField</code>: 使用Python的datetime.datetime实例表示的日期和时间，参数同DateField</p>
</li>
<li><p><code>FileField</code></p>
</li>
<li><p>一个上传文件的字段</p>
</li>
<li><p><code>ImageField</code>:</p>
</li>
<li><p>继承了FileField的所有属性和方法，但对上传的对象进行校验，确保它是个有效的image</p>
</li>
<li><p>需要安装Pillow: “pip install Pillow”</p>
</li>
</ul>
</blockquote>
<h3 id="2-常用字段参数"><a href="#2-常用字段参数" class="headerlink" title="2. 常用字段参数"></a>2. 常用字段参数</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 常用字段选项(通过字段选项，可以实现对字段的约束)</span>
	<span class="token number">1.</span> null<span class="token operator">=</span><span class="token boolean">True</span>
		数据库中字段是否可以为空
	<span class="token number">2.</span> blank<span class="token operator">=</span><span class="token boolean">True</span>
		django的 Admin 中添加数据时是否可允许空值

	一般null<span class="token operator">=</span><span class="token boolean">True</span> <span class="token operator">&amp;</span> blank<span class="token operator">=</span><span class="token boolean">True</span> 搭配着用，出现null<span class="token operator">=</span><span class="token boolean">True</span>就用上blank<span class="token operator">=</span><span class="token boolean">True</span>
    
	<span class="token number">3.</span> primary_key <span class="token operator">=</span> <span class="token boolean">True</span>
    	主键，对AutoField设置主键后，就会代替原来的自增<span class="token builtin">id</span>列
        
    <span class="token number">4.</span> auto_now和auto_now_add
        auto_now 自动创建 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> 无论添加或修改，都是当前操作的时间
        auto_now_add 自动创建 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> 永远是创建时的时间
        
    <span class="token number">5.</span> choices <span class="token punctuation">(</span>后台admin下拉菜单<span class="token punctuation">)</span>
        USER_TYPE_LIST <span class="token operator">=</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span>，<span class="token string">'超级用户'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span>，<span class="token string">'普通用户'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token punctuation">)</span>
		user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>USER_TYPE_LIST<span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'用户类型'</span><span class="token punctuation">)</span>
        
    <span class="token number">6.</span> max_length 最大长度
	<span class="token number">7.</span> default 	  默认值
	<span class="token number">8.</span> verbose_name		Admin<span class="token punctuation">(</span>后台显示的名称<span class="token punctuation">)</span>中字段的显示名称
	<span class="token number">9.</span> name<span class="token operator">|</span>db_column	数据库中的字段名称
	<span class="token number">10.</span> unique<span class="token operator">=</span><span class="token boolean">True</span>		不允许重复
	<span class="token number">11.</span> db_index <span class="token operator">=</span> <span class="token boolean">True</span>	数据库索引<span class="token punctuation">,</span>例如<span class="token punctuation">:</span>如果你想通过name查询的更快的话，给他设置为索引即可
    <span class="token number">12.</span>	editable<span class="token operator">=</span><span class="token boolean">True</span> 	在Admin里是否可编辑，不可编辑则不显示
	<span class="token number">13.</span> 设置表名
	<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
		db_table <span class="token operator">=</span><span class="token string">'person'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>在创建模型迁移之时,经常会遇到以下问题,这是以为原先数据库中已经有数据,这时创建新的数据字段,原先的记录不知道填充什么内容进新增字段(假设不是所有新增字段都有默认值)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/image-20241125145725199.png" alt="image-20241125145725199"></p>
<p><code>模型在admin后台默认的html控件</code> –&gt; 渲染管理表单时使用的默认html控件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%A8%A1%E5%9E%8B%E5%9C%A8admin%E7%9A%84%E9%BB%98%E8%AE%A4html%E6%8F%92%E4%BB%B6.png" alt="image-20241125150605940"></p>
<h3 id="3-迁移怎么回滚"><a href="#3-迁移怎么回滚" class="headerlink" title="3.迁移怎么回滚"></a>3.迁移怎么回滚</h3><p>完成迁移之后,会在应用文件夹<code>App/migrations</code>文件夹下创建迁移文件,并且在数据库表<code>django_migrations</code>中创建对应记录</p>
<p><strong>想要回滚,可以删除对应的迁移python文件以及对应数据库记录</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95.png" alt="image-20241126165647058"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.png" alt="image-20241126170751229"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E5%85%B6%E4%BB%96%E7%BA%A6%E6%9D%9F.png" alt="image-20241126171433600"></p>
<h3 id="4-models基本操作"><a href="#4-models基本操作" class="headerlink" title="4. models基本操作"></a>4. models基本操作</h3><blockquote>
<p>一般的数据库操作流程:</p>
<ol>
<li>创建数据库，设计表结构和字段</li>
<li>连接Mysql数据库，并编写数据访问层代码</li>
<li>业务逻辑层去调用数据访问层执行数据库操作</li>
</ol>
<p>Django通过Model操作数据库，不管你数据库的类型是MySql或者Sqlite，Django自动帮你生成相应数据库类型的SQL语句，所以不需要关注SQL语句和类型，对数据的操作Django帮我们自动完成。</p>
<p>只要会写Model就可以了。django使用<code>对象关系映射(Object Relational Mapping，简称ORM)</code>框架去操控数据库。ORM(Object Relational Mapping)对象关系映射，是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。</p>
</blockquote>
<p>在Django模型中可以使用<code>内部类Meta</code>为模型提供选项,具体请见<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/5.1/ref/models/options">文档</a></p>
<h4 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h4><p><strong><code>ORM</code></strong></p>
<ul>
<li>模型    &lt;&#x3D;&gt; 表</li>
<li>类结构   -&gt; 表结构</li>
<li>对象     -&gt; 表的一条数据</li>
<li>类属性   -&gt; 表的字段</li>
</ul>
<p><strong><code>模型基本操作</code></strong></p>
<ol>
<li><p><strong>增:</strong> (假设模型是Author)</p>
<ol>
<li>创建对象实例,然后调用<code>save</code>方法</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">obj <span class="token operator">=</span> Author<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>first_name <span class="token operator">=</span> <span class="token string">"zhang"</span>
obj<span class="token punctuation">.</span>last_name <span class="token operator">=</span> <span class="token string">'san'</span>
obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>创建对象并初始化,在调用save方法</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">obj <span class="token operator">=</span> Author<span class="token punctuation">(</span>first_name <span class="token operator">=</span> <span class="token string">"zhang"</span><span class="token punctuation">,</span>last_name <span class="token operator">=</span> <span class="token string">'san'</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="3">
<li>使用<code>create</code>方法</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>first_name <span class="token operator">=</span> <span class="token string">"zhang"</span><span class="token punctuation">,</span>last_name <span class="token operator">=</span> <span class="token string">'san'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li>使用<code>get_or_create</code>方法,可以防止重复</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get_or_create<span class="token punctuation">(</span>first_name <span class="token operator">=</span> <span class="token string">"zhang"</span><span class="token punctuation">,</span>last_name <span class="token operator">=</span> <span class="token string">'san'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE.png" alt="image-20241126174245659"></p>
<p><code>注意: 添加失败是因为PersonModel模型中name属性设置的是unique</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 增加数据</span>
<span class="token keyword">def</span> <span class="token function">add_person</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># # 方式1</span>
    <span class="token comment"># try:</span>
    <span class="token comment">#     p = PersonModel(name='张三', age=20)</span>
    <span class="token comment">#     p.save()</span>
    <span class="token comment"># except Exception as e:</span>
    <span class="token comment">#     print(e)</span>
    <span class="token comment">#     return HttpResponse('添加失败')</span>

    <span class="token comment"># return HttpResponse('添加成功')</span>

    <span class="token comment"># 方式2</span>
    <span class="token comment"># PersonModel.objects.create(name='李四', age=25)</span>
    <span class="token comment"># return HttpResponse('添加成功')</span>

    <span class="token comment"># 方式3</span>
    ret <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get_or_create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'李四'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ret"</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span>
    <span class="token comment"># ret:(&lt;PersonModel:PersonModelobject(2)>，True)</span>
    <span class="token comment"># 如果是第一次创建: 则是True，如果已经存在则是False</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'添加成功'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li><p><strong>删:</strong></p>
<ol>
<li>获取单个对象并调用<code>Queryset的delete()方法</code></li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">p <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 获取第一个数据</span>
p<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"李四"</span><span class="token punctuation">)</span>   <span class="token comment"># 根据对应的id获取数据</span>
p<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> <strong>注意: objects不能直接调用delete()方法</strong></p>
<ol start="2">
<li>使用模型过滤<code>filter()</code>,再对过滤结果进行删除</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用过滤器</span>
PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__gt <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 删除年龄大于15的数据        </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><strong>改</strong>:</p>
<ol>
<li>直接使用<code>对象.属性</code>修改</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取数据</span>
p <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span>
p<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 修改多条数据</span>
p_list <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> p <span class="token keyword">in</span> p_list<span class="token punctuation">:</span>
	p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span>
   	p<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>修改多条数据</li>
</ol>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>  <span class="token comment"># 修改所有数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> <code>save()</code>更新时,会对所有字段进行更新操作,如果想要只更新某个字段,减少数据库操作,可以这么做:</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">obj<span class="token punctuation">.</span>first_name <span class="token operator">=</span> <span class="token string">"zhang"</span>
obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span>update_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><strong>查:</strong></p>
</li>
</ol>
<p>对查询集可使用的函数</p>
<ul>
<li><p><code>get()</code>:获取单条数据  <code>Author.objects.get(id=123)</code></p>
<ul>
<li>如果没有找到符合条件的对象，会引发<strong>模型类.DoesNotExist</strong>异常</li>
<li>如果找到多个，会引发<strong>模型类.MultipleObjectsReturned</strong>异常</li>
</ul>
</li>
<li><p><code>first()</code>:返回<code>査询集(Queryset)</code>中的第一个对象</p>
</li>
<li><p><code>last()</code>:返回查询集中的最后一个对象</p>
</li>
<li><p><code>count()</code>:返回当前查询集中的对象个数</p>
</li>
<li><p><code>exists()</code>:判断查询集中是否有数据，如果有数据返回True没有反之</p>
</li>
<li><p><code>all()</code>获取全部数据: Author.objects.all()</p>
</li>
<li><p><code>values()</code>:获取指定列的值，可以传多个参数!  返回包含字典的列表(保存了字段名和对应的值) —&gt; </p>
<p>  Author.objects.all().values(‘password’)</p>
</li>
<li><p><code>values_list()</code>:获取指定列的值，可以传多个参数!   返回包含元组列表(只保存值) —&gt;  </p>
<p>  Author.objects.all().values_list(‘password’)</p>
</li>
<li><p><code>filter()</code></p>
</li>
</ul>
<p><code>查询集可以被链式调用,Author.objects.filter(name=&quot;seven&quot;).filter(age=18)</code></p>
<h4 id="进阶操作"><a href="#进阶操作" class="headerlink" title="进阶操作"></a>进阶操作</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取个数</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"seven"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取id大于1的值</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__gt<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id > 1</span>
<span class="token comment"># 获取id大于或等于1的值</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__gte<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id >= 1</span>
<span class="token comment"># 获取id小于10的值</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__lt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id &lt; 10</span>
<span class="token comment"># 获取id小于或等于10的值</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__lte<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id >= 1</span>

<span class="token comment"># 获取id大于1且小于10的值</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__lt<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>id__gt<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id > 1 AND id &lt; 10</span>
<span class="token comment"># 获取id在11,22,33的数据</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id IN (11,22,33)</span>

<span class="token comment"># 获取id`不在`11,22,33的数据</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>id__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE id NOT IN (11,22,33)</span>

<span class="token comment"># 获取name包含"ven"的数据 (和数据库中like语法相似)</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__contains<span class="token operator">=</span><span class="token string">"ven"</span><span class="token punctuation">)</span>	<span class="token comment"># SELET * FROM Author WHERE name LIKE '%ven%'</span>

<span class="token comment"># icontains()大小写不敏感</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__icontains<span class="token operator">=</span><span class="token string">"ven"</span><span class="token punctuation">)</span>

Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name_regex<span class="token operator">=</span><span class="token string">"^ven"</span><span class="token punctuation">)</span>	<span class="token comment"># 正则匹配</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name_iregex<span class="token operator">=</span><span class="token string">"^ven"</span><span class="token punctuation">)</span>	<span class="token comment"># 正则匹配,忽略大小写</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   	<span class="token comment"># 范围bettwen and</span>

<span class="token comment"># startswith,istartswith,endswith,iendswith:</span>
<span class="token comment"># 以什么开始，以什么结束，和上面一样带i的是大小写不敏感的， 其实不带i的也忽略大小写</span>

Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'seven'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span>	<span class="token comment"># asc升序, 多个属性->id相同时,按照age来排序</span>
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'seven'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-id'</span><span class="token punctuation">)</span>	<span class="token comment"># desc降序</span>

Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token comment"># 切片，取所有数据的18条到20条，分页的时候用的到</span>
<span class="token comment"># 下标从0开始，不能为负数，可以实现分页</span>

<span class="token comment"># 手动分页</span>
page 页码 
per_page 每页数量 <span class="token operator">=</span> <span class="token number">5</span>
第<span class="token number">1</span>页<span class="token punctuation">(</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">-</span><span class="token number">4</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
第<span class="token number">2</span>页<span class="token punctuation">(</span>page<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token operator">-</span><span class="token number">9</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
第<span class="token number">3</span>页<span class="token punctuation">(</span>page<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token operator">-</span><span class="token number">14</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span>
第<span class="token number">4</span>页<span class="token punctuation">(</span>page<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>

每一页数据范围<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> per_page <span class="token punctuation">:</span> page <span class="token operator">*</span> per_page<span class="token punctuation">]</span>

<span class="token comment"># 聚合</span>
使用aggregate<span class="token punctuation">(</span><span class="token punctuation">)</span>函数返回聚合函数的值
<span class="token operator">-</span> Avg<span class="token punctuation">:</span>平均值
<span class="token operator">-</span> Count<span class="token punctuation">:</span>数量
<span class="token operator">-</span> Max<span class="token punctuation">:</span>最大
<span class="token operator">-</span> Min<span class="token punctuation">:</span>最小
<span class="token operator">-</span> Sum<span class="token punctuation">:</span>求和
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Count<span class="token punctuation">,</span>Min<span class="token punctuation">,</span>Max，Sum
Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Max<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-views-py"><a href="#5-views-py" class="headerlink" title="5. views.py"></a>5. views.py</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Avg<span class="token punctuation">,</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum
<span class="token comment"># Create your views here.</span>

<span class="token keyword">from</span> App<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token comment"># 增加数据</span>
<span class="token keyword">def</span> <span class="token function">add_person</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># # 方式1</span>
    <span class="token comment"># try:</span>
    <span class="token comment">#     p = PersonModel(name='张三', age=20)</span>
    <span class="token comment">#     p.save()</span>
    <span class="token comment"># except Exception as e:</span>
    <span class="token comment">#     print(e)</span>
    <span class="token comment">#     return HttpResponse('添加失败')</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> PersonModel<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'张三'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># return HttpResponse('添加成功')</span>

    <span class="token comment"># 方式2</span>
    <span class="token comment"># PersonModel.objects.create(name='李四', age=25)</span>
    <span class="token comment"># return HttpResponse('添加成功')</span>

    <span class="token comment"># 方式3</span>
    <span class="token comment"># ret = PersonModel.objects.get_or_create(name='李四', age=26)</span>
    <span class="token comment"># print("ret",ret)</span>
    <span class="token comment"># ret:(&lt;PersonModel:PersonModelobject(5)>，True)</span>
    <span class="token comment"># 如果是第一次创建: 则是True，如果已经存在则是False</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'添加成功'</span><span class="token punctuation">)</span>


<span class="token comment"># 删除数据</span>
<span class="token keyword">def</span> <span class="token function">del_person</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># p = PersonModel.objects.first() # 获取第一个数据</span>
        <span class="token comment"># p = PersonModel.objects.get(name="李四")   # 根据对应的id获取数据</span>
        <span class="token comment"># p.delete()</span>
        <span class="token comment"># 使用过滤器</span>
        PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__gt <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 删除年龄大于15的数据</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'删除失败'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>

<span class="token comment"># 修改数据</span>
<span class="token keyword">def</span> <span class="token function">update_person</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取数据</span>
        <span class="token comment"># p = PersonModel.objects.first()</span>
        <span class="token comment"># p.age = 25</span>
        <span class="token comment"># p.save()</span>

        <span class="token comment"># 修改多条数据</span>
        p_list <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># PersonModel.objects.all().update(age=25)  # 修改所有数据</span>
        <span class="token keyword">for</span> p <span class="token keyword">in</span> p_list<span class="token punctuation">:</span>
            p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span>
            p<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'修改失败'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'修改成功'</span><span class="token punctuation">)</span>

        
<span class="token keyword">def</span> <span class="token function">get_person</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># get() 方法获取单个数据</span>
    <span class="token comment"># p = PersonModel.objects.get(id=1)</span>

    <span class="token comment"># p = PersonModel.objects.get(pk=18)    # primary key等于18</span>
    <span class="token comment"># p = PersonModel.objects.get(age=100)  # 找不到对应的数据时会报错，找到多条数据时也会报错   </span>
    <span class="token comment"># print(p,type(p))    # &lt;PersonModel: PersonModelobject(1)> &lt;class 'App.models.PersonModel'></span>
    <span class="token comment"># print(p.name,p.age)</span>

    <span class="token comment"># all() 方法返回所有数据</span>
    p_list <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p_list<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>p_list<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#  &lt;PersonModel: PersonModel object (25)>]> &lt;class 'django.db.models.query.QuerySet'> 查询集,可以遍历</span>

    <span class="token comment"># first() 方法获取第一个数据</span>
    <span class="token comment"># p = PersonModel.objects.first()</span>

    <span class="token comment"># last() 方法获取最后一个数据   </span>
    <span class="token comment"># p = PersonModel.objects.last()</span>

    <span class="token comment"># exists() 方法判断数据是否存在</span>
    <span class="token comment"># if PersonModel.objects.filter(name='张三').exists():</span>
    <span class="token comment">#     print('存在')</span>
    <span class="token comment"># else:</span>
    <span class="token comment">#     print('不存在')</span>

    <span class="token comment"># values() 方法返回指定字段的数据</span>
    <span class="token comment"># p_list = PersonModel.objects.values('name','age')   #返回包含字典的列表</span>
    p_list <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span>   <span class="token comment"># 返回包含元组列表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p_list<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>p_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># filter() 方法过滤数据，返回一个```查询集````,参数为空时返回所有数据</span>
    <span class="token comment"># p_list = PersonModel.objects.filter(age__gt=15)   # 年龄大于15的数据</span>
    <span class="token comment"># p_list = PersonModel.objects.filter(name__contains='三')   # 名字包含'三'的数据</span>
    <span class="token comment"># p_list = PersonModel.objects.filter(name__startswith='张')   # 名字以'张'开头的数据</span>

    <span class="token comment"># exclude() 方法排除数据，返回一个```查询集````,参数为空时返回所有数据</span>
    <span class="token comment"># p_list = PersonModel.objects.exclude(age__gt=15)   # 年龄不大于15的数据</span>

    <span class="token comment"># order_by() 方法排序数据，返回一个```查询集````,参数为空时返回所有数据</span>
    <span class="token comment"># p_list = PersonModel.objects.order_by('age')   # 按年龄排序</span>
    <span class="token comment"># p_list = PersonModel.objects.order_by('-age')   # 按年龄倒序排序</span>

    <span class="token comment"># contains() 方法查找字符串是否在指定字段中，返回一个```查询集````,参数为空时返回所有数据</span>
    p_list <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__contains<span class="token operator">=</span><span class="token string">'三'</span><span class="token punctuation">)</span>   <span class="token comment"># 名字包含'三'的数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p_list<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>p_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># regex() 方法查找正则表达式是否匹配指定字段，返回一个```查询集````,参数为空时返回所有数据</span>
    <span class="token comment"># p_list = PersonModel.objects.filter(name__regex=r'^张')   # 名字以'张'开头的数据</span>

    <span class="token comment"># 聚合函数</span>
    <span class="token comment"># count() 方法计算数据条数</span>
    <span class="token comment"># count = PersonModel.objects.count()</span>
    <span class="token comment"># print(count)</span>

    <span class="token comment"># max() 方法获取最大值</span>
    <span class="token comment"># max_age = PersonModel.objects.all().aggregate(Max('age'))</span>
    <span class="token comment"># print(max_age)</span>

    <span class="token comment"># min() 方法获取最小值</span>
    <span class="token comment"># min_age = PersonModel.objects.all().aggregate(Min('age'))</span>
    <span class="token comment"># print(min_age)</span>

    <span class="token comment"># sum() 方法求和</span>
    <span class="token comment"># total_age = PersonModel.objects.all().aggregate(Sum('age'))</span>
    <span class="token comment"># print(total_age)</span>

    <span class="token comment"># avg() 方法求平均值</span>
    result <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Avg<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'获取成功'</span><span class="token punctuation">)</span>


<span class="token comment"># 分页数据</span>
<span class="token keyword">def</span> <span class="token function">paginate</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 页码: page</span>
    <span class="token comment"># 每页显示条数: per_page</span>
    per_page <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># 数据范围的计算公式 -> (页码-1)*每页显示条数 ~ 页码*每页显示条数</span>

    <span class="token builtin">all</span> <span class="token operator">=</span> PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    start <span class="token operator">=</span> <span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> per_page
    end <span class="token operator">=</span> page <span class="token operator">*</span> per_page
    p_list <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">[</span>start<span class="token punctuation">:</span>end<span class="token punctuation">]</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">"page_list.html"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'p_list'</span><span class="token punctuation">:</span>p_list<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>


<span class="token comment"># 自动分页器</span>
<span class="token keyword">def</span> <span class="token function">auto_paginate</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 自动分页器</span>
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>paginator <span class="token keyword">import</span> Paginator
    <span class="token comment"># 实例化分页器</span>
    paginator <span class="token operator">=</span> Paginator<span class="token punctuation">(</span>PersonModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    page <span class="token operator">=</span> <span class="token number">1</span>
    persons <span class="token operator">=</span> paginator<span class="token punctuation">.</span>page<span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token comment"># 获取第page页的数据</span>
    paginator<span class="token punctuation">.</span>page_range   <span class="token comment"># 页码范围,可以遍历</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="五、Django模型进阶"><a href="#五、Django模型进阶" class="headerlink" title="五、Django模型进阶"></a>五、Django模型进阶</h2><h3 id="1-配置MySql"><a href="#1-配置MySql" class="headerlink" title="1. 配置MySql"></a>1. 配置MySql</h3><ul>
<li><p>安装mysql</p>
</li>
<li><p>MySql驱动</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python">pip install mysqlclient
如果上面的命令安装失败，则尝试使用国内豆瓣源安装<span class="token punctuation">:</span>
pip install <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple mysqlclient

<span class="token punctuation">(</span>Linux Ubuntu下需要
先安装<span class="token punctuation">:</span>apt install libmysqld<span class="token operator">-</span>dev
再安装<span class="token punctuation">:</span>apt install libmysqld<span class="token operator">-</span>dev<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>在Django中配置和使用mysql数据库</p>
<p>  使用mysql数据库,<code>settings.py文件配置如下</code></p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'default'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>
        <span class="token string">'ENGINE'</span> <span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span> <span class="token punctuation">:</span> <span class="token string">'DjangoModeldb_1'</span><span class="token punctuation">,</span>    <span class="token comment"># 数据库名字 </span>
        <span class="token string">'USER'</span> <span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>    <span class="token comment"># 数据库用户名 </span>
        <span class="token string">'PASSWORD'</span> <span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库密码 </span>
        <span class="token string">'HOST'</span> <span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>   <span class="token comment"># 数据库主机地址 </span>
        <span class="token string">'PORT'</span> <span class="token punctuation">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>    <span class="token comment"># 数据库端口号 mysql默认是3306</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="2-多模块关联关系-多表操作"><a href="#2-多模块关联关系-多表操作" class="headerlink" title="2. 多模块关联关系(多表操作)"></a>2. 多模块关联关系(多表操作)</h3><blockquote>
<p>多个模块关联	</p>
<p>关联分类</p>
<ul>
<li>ForeignKey: 一对多，将字段定义在多的端中</li>
<li>ManyToManyField: 多对多，将字段定义在两端的任意一端中</li>
<li>OneToOneField: 一对一，将字段定义在任意一端中</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB.png" alt="多表关系"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">多个模块关联
  关联分类
    · ForeignKey：一对多，将字段定义在多的端中
    · ManyToManyField：多对多，将字段定义在两端的任意一端中
    · OneToOneField：一对一，将字段定义在任意一端中
        
一对多关系，举例说明（一对一， 多对多类似）： 
一个班级可以有多个学生， 一个学生只能属于一个班级
      <span class="token keyword">class</span> <span class="token class-name">Grade</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
      	name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
      <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
        grade <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Grade<span class="token punctuation">,</span> on_delete<span class="token operator">=</span><span class="token punctuation">)</span>
一对多关联  
    对象的使用：
        正向（在Student这边，有grade属性的这一边）：
              获取学生所在班级（对象）<span class="token punctuation">:</span> stu<span class="token punctuation">.</span>grade
              获取学生所在班级的属性<span class="token punctuation">:</span> stu<span class="token punctuation">.</span>grade<span class="token punctuation">.</span>name
        反向（在Grade这边）：
              获取班级的所有学生<span class="token punctuation">(</span>获取Manager对象<span class="token punctuation">)</span>：grade<span class="token punctuation">.</span>student_set
         	  获取班级的所有学生（获取QuerySet查询集）<span class="token punctuation">:</span> grade<span class="token punctuation">.</span>student_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                
	<span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>等操作中的使用：
        正向（在Student这边，有grade属性的这一边）：
                 Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>属性__name<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">)</span>
              如：Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade__name<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">)</span>
        反向（在Grade这边）：
                 Grade<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>类名小写__id<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
              如：Grade<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>student__id<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-Model连表关系"><a href="#3-Model连表关系" class="headerlink" title="3. Model连表关系"></a>3. Model连表关系</h3><ul>
<li>一对多：models.ForeignKey(其他表)</li>
<li>多对多：models.ManyToManyField(其他表)</li>
<li>一对一：models.OneToOneField(其他表)</li>
</ul>
<p><strong>应用场景：</strong></p>
<ul>
<li>一对多：当一张表中创建一行数据时，有一个单选的下拉框（可以被重复选择）<ul>
<li>例如：创建用户信息时候，需要选择一个用户类型【普通用户】【金牌用户】【铂金用户】</li>
</ul>
</li>
<li>多对多：在某表中创建一行数据时，有一个可以多选的下拉框。（猫眼App, 淘票票，格拉瓦电影）<ul>
<li>例如：创建用户信息，需要为用户指定多个爱好。</li>
</ul>
</li>
<li>一对一：在某表中创建一行数据时，有一个单选的下拉框（下拉框中的内容被用过一次就消失了）<ul>
<li>例如：有个身份证表，有个person表。每个人只能有一张身份证，一张身份证也只能对应一个人，这就是一对一关系</li>
</ul>
</li>
</ul>
<h3 id="4-一对多关系，即外键"><a href="#4-一对多关系，即外键" class="headerlink" title="4. 一对多关系，即外键"></a>4. 一对多关系，即外键</h3><h4 id="为什么要用一对多"><a href="#为什么要用一对多" class="headerlink" title="为什么要用一对多"></a>为什么要用一对多</h4><p>先来看一个例子。有一个用户信息表，其中有个用户类型字段，存储用户的用户类型。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>不使用外键时用户类型存储在每一行数据中。如使用外键则只需要存储关联表的id即可，能够节省大量的存储空间。同时使用外键有利于维持<strong>数据完整性</strong>和<strong>一致性</strong>。当然也有缺点，数据库设计变的更复杂了。每次做 DELETE 或者 UPDATE 都必须考虑外键约束。</p>
<h4 id="刚才的例子使用外键的情况"><a href="#刚才的例子使用外键的情况" class="headerlink" title="刚才的例子使用外键的情况"></a>刚才的例子使用外键的情况</h4><p>单独定义一个用户类型表：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">UserType</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    caption <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'UserType'</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们约定</p>
<ul>
<li><strong>正向操作</strong>: ForeignKey在UserInfo表里，如果根据UserInfo去操作就是正向操作。</li>
<li><strong>反向操作</strong>: ForeignKey不在UserType里，如果根据UserType去操作就是反向操作。</li>
</ul>
<h4 id="一对多的关系的增删改查"><a href="#一对多的关系的增删改查" class="headerlink" title="一对多的关系的增删改查"></a>一对多的关系的增删改查</h4><h5 id="正向操作"><a href="#正向操作" class="headerlink" title="正向操作"></a>正向操作</h5><p><strong>增</strong></p>
<ol>
<li><p>创建对象实例，然后调用save方法：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">obj <span class="token operator">=</span> UserInfo<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'li'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">44</span><span class="token punctuation">,</span> user_type_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>使用create方法：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'li'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">44</span><span class="token punctuation">,</span> user_type_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用get_or_create方法，可以防止重复：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get_or_create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'li'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">55</span><span class="token punctuation">,</span> user_type_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用字典：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">'user_type_id'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">&#125;</span>
UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>dic<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>通过对象添加：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">usertype <span class="token operator">=</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'li'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">55</span><span class="token punctuation">,</span> user_type<span class="token operator">=</span>usertype<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<p><strong>删</strong></p>
<p>和普通模式一样删除即可。如：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>改</strong></p>
<p>和普通模式一样修改即可。如：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>user_type_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>查</strong></p>
<p>正向查找所有用户类型为钻石用户的用户，使用双下划线：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">users <span class="token operator">=</span> UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>user_type__caption__contains<span class="token operator">=</span><span class="token string">'钻石'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>正向获取关联表中的属性可以直接使用<code>点.语法</code>，比如：获取users查询集中第一个用户的caption：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>user_type<span class="token punctuation">.</span>caption<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="反向操作"><a href="#反向操作" class="headerlink" title="反向操作"></a>反向操作</h5><p><strong>增</strong></p>
<p>通过usertype来创建userinfo：</p>
<ol>
<li><p>通过userinfo_set的create方法：</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">ut <span class="token operator">=</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
ut<span class="token punctuation">.</span>userinfo_set<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'smith'</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<p><strong>删</strong></p>
<p>删除操作可以在定义外键关系的时候，通过on_delete参数来配置删除时做的操作。**(修改on_delete参数之后要重新同步数据库)**</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">on_delete参数主要有以下几个可选值：
<span class="token operator">-</span> models<span class="token punctuation">.</span>CASCADE  表示级联删除，即删除UserType时，相关联的UserInfo也会被删除。
<span class="token operator">-</span> models<span class="token punctuation">.</span>PROTECT  保护模式，阻止级联删除。
<span class="token operator">-</span> models<span class="token punctuation">.</span>SET_NULL 置空模式，设为null，null<span class="token operator">=</span><span class="token boolean">True</span>参数必须具备
<span class="token operator">-</span> models<span class="token punctuation">.</span>SET_DEFAULT 置默认值 设为默认值，default参数必须具备
<span class="token operator">-</span> models<span class="token punctuation">.</span>SET<span class="token punctuation">(</span><span class="token punctuation">)</span>  删除的时候重新动态指向一个实体访问对应元素，可传函数
<span class="token operator">-</span> models<span class="token punctuation">.</span>DO_NOTHING   什么也不做。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>改</strong></p>
<p>和普通模式一样，不会影响级联表。</p>
<p><strong>查</strong></p>
<p>通过usertype对象来查用户类型为1的用户有哪些：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">obj<span class="token operator">=</span>UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>userinfo_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可以通过在定义foreign key时指定related_name来修改默认的userinfo_set，比如指定related_name为info：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'UserType'</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'info'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>指定related_name之后，反向查的时候就变成了：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">obj<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>获取用户类型为1且用户名为shuaige的用户：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">obj<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'shuaige'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>外键关系中，django自动给usertype加了一个叫做userinfo的属性。使用双下划线，可以通过userinfo提供的信息来查usertype (了解)：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">user_type_obj <span class="token operator">=</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>userinfo__username<span class="token operator">=</span><span class="token string">'zs'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="models-py"><a href="#models-py" class="headerlink" title="models.py"></a>models.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">def</span> <span class="token function">set_user_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'超级用户'</span><span class="token punctuation">)</span>

<span class="token comment"># 定义一对多关系的模型 1 : N</span>
<span class="token comment"># 用户类型 1对多 用户</span>
<span class="token keyword">class</span> <span class="token class-name">UserType</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
   
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    <span class="token comment"># 外键</span>
    <span class="token comment"># user_type = models.ForeignKey(UserType, on_delete=models.CASCADE)    # 级联删除</span>

    <span class="token comment"># 自定义的删除策略,当删除UserType时,将其关联的UserInfo的user_type字段设置为set_user_type()函数返回的UserType对象</span>
    <span class="token comment"># user_type = models.ForeignKey(UserType, on_delete=models.SET(set_user_type))</span>
    <span class="token comment"># 保护模式</span>
    user_type <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>UserType<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>PROTECT<span class="token punctuation">)</span>
    <span class="token comment"># 置空模式</span>
    <span class="token comment"># user_type3 = models.ForeignKey(UserType, on_delete=models.SET_NULL, null=True)  # null=True参数必须具备</span>
    <span class="token comment"># 置默认值模式</span>
    <span class="token comment"># user_type4 = models.ForeignKey(UserType, on_delete=models.SET_DEFAULT, default=UserType.objects.create(name='普通用户'))    # 需要先创建默认值对象</span>

    <span class="token comment"># user_type = models.ForeignKey(UserType, on_delete=models.PROTECT, related_name='users')   # 反向查询时,可通过user_type.users获取所有关联的UserInfo对象</span>



<span class="token triple-quoted-string string">"""
on_delete参数主要有以下几个可选值:
- models.CASCADE  表示级联删除,即删除UserType时,相关联的UserInfo也会被删除。
- models.PROTECT  保护模式,阻止级联删除。
- models.SET_NULL 置空模式,设为null,null=True参数必须具备
- models.SET_DEFAULT 置默认值 设为默认值,default参数必须具备
- models.SET()  删除的时候重新动态指向一个实体访问对应元素,可传函数
- models.DO_NOTHING   什么也不做。
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> os <span class="token keyword">import</span> name
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">from</span> One2Many<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 一对多关系</span>

<span class="token comment"># 添加数据</span>
<span class="token keyword">def</span> <span class="token function">add_user</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 给user_type添加数据</span>
    <span class="token comment"># user_type = ['普通用户', 'VIP', 'SVIP']</span>
    <span class="token comment"># for name in user_type:</span>
    <span class="token comment">#     UserType.objects.create(name=name)</span>

    <span class="token comment"># 给user添加数据</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 使用外键关联UserType的主键</span>
        <span class="token comment"># user = User.objects.create(name='user' + str(i), age=i, user_type_id= i % 3 + 1)</span>

        <span class="token comment"># 使用外键关联UserType的对象</span>
        user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'user'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> age<span class="token operator">=</span>i<span class="token punctuation">,</span> user_type <span class="token operator">=</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'添加成功'</span><span class="token punctuation">)</span>


<span class="token comment"># 删除数据</span>
<span class="token keyword">def</span> <span class="token function">del_user</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 删除User数据</span>
    User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 删除UserType数据</span>
    UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"SVIP"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 因为在设置模型时,UserType作为User的外键,on_delete=models.CASCADE,所以删除UserType会自动删除User(级联删除)</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>

<span class="token comment"># 修改数据</span>
<span class="token keyword">def</span> <span class="token function">update_user</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># 修改用户类型</span>
    UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'SVIP'</span><span class="token punctuation">)</span>

    <span class="token comment"># 修改用户</span>
    User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"super_user"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> user_type_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'修改成功'</span><span class="token punctuation">)</span>

<span class="token comment"># 查询数据</span>
<span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 正向查询： 在User模型中根据user_type外键查找到对应的UserType对象</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span>user<span class="token punctuation">.</span>age<span class="token punctuation">,</span>user<span class="token punctuation">.</span>user_type<span class="token punctuation">,</span>user<span class="token punctuation">.</span>user_type_id<span class="token punctuation">)</span>  <span class="token comment"># super_user 20 UserType object (4) 4</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_type<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 超级用户</span>

    <span class="token comment"># 反向查询： 在UserType模型中根据user外键查找到对应的User对象</span>
    utype <span class="token operator">=</span> UserType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>utype<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>utype<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># UserType自己的属性 4 超级用户</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>utype<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;User: User object (2)>]></span>
    <span class="token comment"># user_set是反向查询的属性,返回的是一个Manager管理对象,可以用all()方法获取QuerySet集合对象,默认生成的,可以在Model定义related_name='related_name'来自定义名称</span>


    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*"</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> utype<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">,</span> user<span class="token punctuation">.</span>user_type<span class="token punctuation">,</span> user<span class="token punctuation">.</span>user_type_id<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token comment"># 在filter()方法</span>
    <span class="token comment"># users = User.objects.filter(user_type=UserType.objects.get(name='VIP'))</span>
    <span class="token comment"># users = User.objects.filter(user_type_id=4)</span>
    <span class="token comment"># users = User.objects.filter(user_type__name='SVIP') # 传入UserType的name属性作为参数</span>
    users <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>user_type__id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># 传入UserType的id属性作为参数</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"查询成功"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-多对多关系"><a href="#5-多对多关系" class="headerlink" title="5. 多对多关系"></a>5. 多对多关系</h3><p><strong>针对多对多关系django会自动创建第三张表。也可以通过through参数指定第三张表。</strong></p>
<p>用户和组是典型的多对多关系：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Group</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
   	password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
    groups <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Group<span class="token punctuation">)</span> <span class="token comment"># 设置多对多关系</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      	<span class="token keyword">return</span> self<span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="操作"><a href="#操作" class="headerlink" title="操作"></a><strong>操作</strong></h5><ul>
<li><p><strong>增：</strong> </p>
</li>
<li><p>先分别创建user和group, 再使用add关联</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    u <span class="token operator">=</span> User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'aa'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'123'</span><span class="token punctuation">)</span>
    u<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    g <span class="token operator">=</span> Group<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'g5'</span><span class="token punctuation">)</span>
    g<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>通过Manager对象使用add()方法</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">u<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>add<span class="token punctuation">(</span>g<span class="token punctuation">)</span>  或  g<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>删： </p>
<ul>
<li><p>delete()方法, 和一对多类似，删除user或group会级联删除user_groups表中的关联数据</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 删除中间表</span>
user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'张三1'</span><span class="token punctuation">)</span>
<span class="token comment"># delete会级联删除(假如电影1 只被张三1收藏，则电影1在电影表中也会被删除)</span>
user<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'电影1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 删除张三1 收藏 电影1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>remove()方法</code></p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用remove方法</span>
movie <span class="token operator">=</span> Movie<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'电影1'</span><span class="token punctuation">)</span>
user<span class="token punctuation">.</span>movies<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>  <span class="token comment"># 删除张三1 收藏 电影1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>改：<br>  和一对多类似，只修改当前表</p>
</li>
<li><p>查:</p>
<ul>
<li><p>正向：</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查询id=2的用户所在的所有组group</span>
u <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
u<span class="token punctuation">.</span>groups<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>反向:</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查询id=1的组中包含的所有用户</span>
g <span class="token operator">=</span> Group<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h5 id="models-py-1"><a href="#models-py-1" class="headerlink" title="models.py"></a>models.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>

<span class="token comment"># 多对多模型 N : M</span>

<span class="token comment"># 一个用户可以收藏多个电影</span>
<span class="token comment"># 一个电影可以被多个用户收藏</span>

<span class="token comment"># 电影</span>
<span class="token keyword">class</span> <span class="token class-name">Movie</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    duration <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>

<span class="token comment"># 用户</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    <span class="token comment"># 多对多关系</span>
    movies <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Movie<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="views-py-1"><a href="#views-py-1" class="headerlink" title="views.py"></a>views.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">from</span> Many2Many<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span> 
<span class="token comment"># Create your views here.</span>


<span class="token comment"># 多对多</span>
<span class="token comment"># 增加数据</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 添加User数据</span>
    <span class="token comment"># for i in range(1, 10):</span>
    <span class="token comment">#     User.objects.create(name='张三' + str(i))</span>

    <span class="token comment"># # 添加Movie数据</span>
    <span class="token comment"># for i in range(1, 10):</span>
    <span class="token comment">#     Movie.objects.create(name='电影' + str(i))</span>

    <span class="token comment"># 添加User和Movie的关系数据</span>
    <span class="token comment"># 张三1 收藏 电影1</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'张三1'</span><span class="token punctuation">)</span>
    movie <span class="token operator">=</span> Movie<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'电影1'</span><span class="token punctuation">)</span>

    <span class="token comment"># 添加收藏</span>
    <span class="token comment"># user.movies.add(movie)  # 用户收藏电影  </span>
    movie<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># 反向引用</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"增加数据成功"</span><span class="token punctuation">)</span>

<span class="token comment"># 删除数据</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 删除User数据</span>
    <span class="token comment"># User.objects.filter(id=9).delete()</span>
    <span class="token comment"># 删除Movie数据</span>
    <span class="token comment"># Movie.objects.filter(id=9).delete()</span>

    <span class="token comment"># 删除中间表</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'张三1'</span><span class="token punctuation">)</span>
    <span class="token comment"># delete会级联删除(假如电影1 只被张三1收藏，则电影1在电影表中也会被删除)</span>
    <span class="token comment"># user.movies.filter(id=1, name='电影1').delete()  # 删除张三1 收藏 电影1</span>

    <span class="token comment"># 使用remove方法</span>
    movie <span class="token operator">=</span> Movie<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'电影1'</span><span class="token punctuation">)</span>
    user<span class="token punctuation">.</span>movies<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>  <span class="token comment"># 删除张三1 收藏 电影1</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"删除数据成功"</span><span class="token punctuation">)</span>

<span class="token comment"># 查询数据</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取用户收藏的电影</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取张三1 收藏的所有电影</span>


    <span class="token comment"># 获取电影被哪些用户收藏</span>
    movie <span class="token operator">=</span> Movie<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>movie<span class="token punctuation">.</span>user_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取电影4 被哪些用户收藏</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"查询数据成功"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="6-一对一关系"><a href="#6-一对一关系" class="headerlink" title="6. 一对一关系"></a>6. 一对一关系</h3><p>一对一不是数据库的一个连表操作，而是Django独有的一个连表操作。</p>
<p>一对一关系相当于是<code>特殊的一对多关系</code>，只是相当于加了<code>unique=True</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/%E4%B8%80%E5%AF%B9%E4%B8%80.png" alt="image-20241128150631042"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">一个人只能有一张身份证，一张身份证对应一个人，是一个典型的一对一关系。
<span class="token keyword">class</span> <span class="token class-name">IDCard</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idnum <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>idnum<span class="token punctuation">)</span>
        
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idcard <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>IdCard<span class="token punctuation">)</span>
        name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一对一关系比较简单。两种表互相都有对方。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">\<span class="token operator">>></span><span class="token operator">></span> lisi <span class="token operator">=</span> Person<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
\<span class="token operator">>></span><span class="token operator">></span> lisi<span class="token punctuation">.</span>idcard
<span class="token operator">&lt;</span>IdCard<span class="token punctuation">:</span> <span class="token number">123456</span><span class="token operator">></span>
\<span class="token operator">>></span><span class="token operator">></span> ids <span class="token operator">=</span> IdCard<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
\<span class="token operator">>></span><span class="token operator">></span> ids<span class="token punctuation">.</span>person
<span class="token operator">&lt;</span>Person<span class="token punctuation">:</span> lisi<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="models-py-2"><a href="#models-py-2" class="headerlink" title="models.py"></a>models.py</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>

<span class="token comment"># 身份证</span>
<span class="token keyword">class</span> <span class="token class-name">IdCard</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    idcard_num <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    sex <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># 1对1关系，一个用户对应一个身份证</span>
    idcard <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>IdCard<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>PROTECT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="views-py-2"><a href="#views-py-2" class="headerlink" title="views.py"></a>views.py</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> One2One<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># Create your views here.</span>

<span class="token comment"># 一对一</span>

<span class="token comment"># 查询</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 查找某用户的身份证信息</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>idcard<span class="token punctuation">)</span>  <span class="token comment"># 对象(因为是1对1关系，所以返回的是单个对象)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>idcard<span class="token punctuation">.</span>idcard_num<span class="token punctuation">,</span> user<span class="token punctuation">.</span>idcard<span class="token punctuation">.</span>address<span class="token punctuation">)</span>  <span class="token comment"># 属性</span>

    <span class="token comment"># 查找身份证信息对应的用户</span>
    idcard <span class="token operator">=</span> IdCard<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>idcard_num<span class="token operator">=</span><span class="token string">'111'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>idcard<span class="token punctuation">.</span>user<span class="token punctuation">)</span>  <span class="token comment"># 对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>idcard<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> idcard<span class="token punctuation">.</span>user<span class="token punctuation">.</span>age<span class="token punctuation">,</span> idcard<span class="token punctuation">.</span>user<span class="token punctuation">.</span>sex<span class="token punctuation">)</span>  <span class="token comment"># 属性</span>

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"查询成功"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="六、图书馆综合项目"><a href="#六、图书馆综合项目" class="headerlink" title="六、图书馆综合项目"></a>六、图书馆综合项目</h2><p>创建一个项目, 用来说明出版社, 书籍和作者的关系。<br>假定关系：作者：书籍 &#x3D;&gt; 1:n  （一本书由一个作者完成， 一个作者可以创作多本书）<br>    出版社：书籍 &#x3D;&gt; n:n  （一个出版社可以出版多本书， 一本书可以由多个出版社出版）<br>要求:</p>
<ol>
<li>在书籍的book_index.html中有一个”查看所有书籍”的超链接按钮，点击进入书籍列表<code>book_list.html</code>⻚面.</li>
<li>在书籍的book_list.html中显示所有书名，点击书名可以进入书籍详情<code>book_detail.html</code>（通过书籍id）</li>
<li>在书籍book_detail.html中可以点击该书的作者和出版社，进入作者详情的<code>author_detail.html</code>和出版社详情的<code>publisher_detail.html</code>⻚面</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 出版社</span>

<span class="token keyword">class</span> <span class="token class-name">Publisher</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    city <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    state_province <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    website <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
    
<span class="token comment"># 书籍</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'书名'</span><span class="token punctuation">)</span>
    publish_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'出版时间'</span><span class="token punctuation">)</span>
    <span class="token comment"># 外键，book:author = N:1</span>
    <span class="token comment"># on_delete=models.CASCADE: 级联删除</span>

    <span class="token comment"># 主表 : Author 从表 : Book, Author是Book的外键 -> 一本书只能有一个作者</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Author<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'作者'</span><span class="token punctuation">)</span>
    <span class="token comment"># 多对多关系，book:publisher=N:N</span>
    publishers <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Publisher<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'出版社'</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title

<span class="token comment"># 出版社</span>

<span class="token keyword">class</span> <span class="token class-name">Publisher</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    city <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    state_province <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    website <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="在网页中插入静态文件"><a href="#在网页中插入静态文件" class="headerlink" title="在网页中插入静态文件"></a>在网页中插入静态文件</h3><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.2/howto/static-files/">如何管理静态文件（如图片、JavaScript、CSS） | Django 文档 | Django</a></p>
<ol>
<li>在项目根目录(settings.py的上上层)下创建<code>static</code>存放静态文件,可以根据<code>127.0.0.1/static/bg.jpg</code>访问</li>
<li>在<code>settings.py</code>文件中新增以下选项(根据实际自己定义)</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">STATICFILES_DIRS <span class="token operator">=</span> <span class="token punctuation">[</span>
    BASE_DIR <span class="token operator">/</span> <span class="token string">"static"</span><span class="token punctuation">,</span>
    <span class="token string">"/var/www/static/"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>在模板文件中,使用<code>&#123;% load static %&#125;</code>语法加载静态文件</li>
</ol>
<h2 id="七、Django视图view"><a href="#七、Django视图view" class="headerlink" title="七、Django视图view"></a>七、Django视图view</h2><h3 id="HttpRequest-和-HttpResponse"><a href="#HttpRequest-和-HttpResponse" class="headerlink" title="HttpRequest 和 HttpResponse"></a>HttpRequest 和 HttpResponse</h3><p><code>Django中的视图主要用来接受Web请求，并做出响应。</code></p>
<p>视图的本质就是一个Python中的函数</p>
<p>视图的响应分为两大类</p>
<ol>
<li>以<code>Json数据</code>形式返回(JsonResponse)</li>
<li>以网页的形式返回<ol>
<li>重定向到另一个网页 (HttpResponseRedirect)</li>
<li>错误视图(4XX,5XX) (HttpResponseNotFound, HttpResponseForbidden, HttpResponseNotAllowed 等)</li>
</ol>
</li>
<li>视图响应过程:<ol>
<li>浏览器输入-&gt; urls路由匹配 -&gt; 视图响应 -&gt; 回馈到浏览器</li>
</ol>
</li>
<li>视图参数:<ol>
<li>一个HttpRequest的实例，一般命名为request</li>
<li>通过ur1正则表达式传递过来的参数</li>
</ol>
</li>
<li>位置:</li>
</ol>
<p>通常在<code>应用下的views.py</code>中定义</p>
<ol start="6">
<li>错误视图:<ol>
<li>404视图(页面没找到)</li>
<li>400视图(客户操作错误)</li>
<li>500视图(服务器内部错误)</li>
</ol>
</li>
</ol>
<h4 id="HttpRequest"><a href="#HttpRequest" class="headerlink" title="HttpRequest"></a>HttpRequest</h4><p>服务器在接收到Http请求后，会根据报文创建HttpRequest对象</p>
<p>视图中的第一个参数就是HttpRequest对象</p>
<p><code>Django框架接收到http请求之后会将http请求包装为HttpRequest对象，之后传递给视图。</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">request常用属性和方法：
  属性：
    path    请求的完整路径
    method  请求的方法，常用GET<span class="token punctuation">,</span> POST
    GET     类似字典的参数，包含了get的所有参数
    POST    类似字典的参数，包含了post所有参数
    FILES   类似字典的参数，包含了上传的文件
    COOKIES 字典，包含了所有COOKIE
    session 类似字典，表示会话
    META    一个字典，包含了请求的元信息，例如：
            <span class="token string">'REMOTE_ADDR'</span> 客户端的IP地址
  方法：
    is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span>    判断是否是ajax请求，通常用在移动端和JS中
    get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回包含参数字符串的请求路径

QueryDict：
  类似字典的对象。与字典的区别：可以存在相同的键。
  QueryDict中数据获取方式：
    <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span> 或 <span class="token builtin">dict</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>    获取指定key对应的第一个值
    <span class="token builtin">dict</span><span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>                获取指定key对应的所有值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="HttpResponse"><a href="#HttpResponse" class="headerlink" title="HttpResponse"></a>HttpResponse</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">HttpResponse由程序员自己创建：
  <span class="token number">1</span>）不使用模板，直接调用HttpResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>，返回HttpResponse对象。
  <span class="token number">2</span>）调用模板，进行渲染。
    使用render
      render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> template_name<span class="token punctuation">[</span><span class="token punctuation">,</span> context<span class="token punctuation">]</span><span class="token punctuation">)</span>
      request     请求体对象
      template_name 模板路径
      context   字典参数，用来填坑
属性<span class="token punctuation">:</span>
  content      返回的内容
  charset    编码格式
  status_code  响应状态码<span class="token punctuation">(</span>2xx<span class="token punctuation">,</span> 3xx<span class="token punctuation">,</span> 4xx<span class="token punctuation">,</span> 5xx<span class="token punctuation">)</span>
方法<span class="token punctuation">:</span>
  write<span class="token punctuation">(</span>xxx<span class="token punctuation">)</span>      直接写出文本
  flush<span class="token punctuation">(</span><span class="token punctuation">)</span>       冲刷缓冲区
  set_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>  设置cookie
  delete_cookie<span class="token punctuation">(</span>key<span class="token punctuation">)</span>   删除cookie

HttpResponse子类
  HttpResponseRedirect
    响应重定向：可以实现服务器内部跳转
    <span class="token keyword">return</span> HttpResponseRedirect<span class="token punctuation">(</span><span class="token string">'/grade/2030'</span><span class="token punctuation">)</span>
    使用的时候推荐使用反向解析
  JsonResponse
    返回Json数据的请求，通常用在异步请求上
      JsonResponse<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span>
      返回json数据时<span class="token punctuation">,</span> Content<span class="token operator">-</span><span class="token builtin">type</span>是application<span class="token operator">/</span>json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="views-py-3"><a href="#views-py-3" class="headerlink" title="views.py"></a>views.py</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token punctuation">,</span> HttpResponseRedirect<span class="token punctuation">,</span> JsonResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect<span class="token punctuation">,</span> render

<span class="token comment"># Create your views here.</span>


<span class="token keyword">def</span> <span class="token function">myrequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>  <span class="token comment"># &lt;WSGIRequest: GET '/request/?name=lisi&amp;age=18'></span>

    <span class="token comment"># request对象的属性和方法</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span>  <span class="token comment"># GET / POST/ PUT/ DELETE</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>  <span class="token comment"># QueryDict对象(类字典对象,可以使用字典方法)，包含GET请求参数</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 如果name不存在，会报错</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 如果name不存在，返回None或者默认值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 如果name不存在，返回空列表, 否则返回列表</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>  <span class="token comment"># QueryDict对象，包含POST请求参数</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>path<span class="token punctuation">)</span>  <span class="token comment"># 请求路径/request/</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 请求完整路径 (包含查询字符串)/request/?name=lisi&amp;age=18</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">)</span>  <span class="token comment"># 字典对象，包含cookie信息</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>session<span class="token punctuation">)</span>  <span class="token comment"># 字典对象，包含session信息</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>FILES<span class="token punctuation">)</span> <span class="token comment"># 如果是上传文件，返回一个文件对象，否则返回None,前端上传的文件</span>
    <span class="token comment"># print(request.META) # 字典对象，包含HTTP请求头信息</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>META<span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 

    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"Hello Django!"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">myresponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. 直接返回字符串</span>
    <span class="token comment"># return HttpResponse("Hello Django!")</span>

    <span class="token comment"># 2. 传入模板文件, 前后端不分离</span>
    <span class="token comment"># return render(request, 'index.html')</span>

    <span class="token comment"># 3. 重定向, redirect, reverse</span>
    <span class="token comment"># return redirect('/request/')</span>
    <span class="token comment"># return HttpResponseRedirect('/request/')</span>

    <span class="token comment"># 4. 返回json数据, 前后端分离的方式</span>
    <span class="token comment"># data = &#123;'name': 'lisi', 'age': 18&#125;</span>
    <span class="token comment"># return JsonResponse(data)</span>

    response <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'Hello Django!'</span>
    response<span class="token punctuation">.</span>status_code <span class="token operator">=</span> <span class="token number">200</span>
    <span class="token keyword">return</span> response
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="八、Cookie和Session技术"><a href="#八、Cookie和Session技术" class="headerlink" title="八、Cookie和Session技术"></a>八、Cookie和Session技术</h2><h3 id="注册小案例"><a href="#注册小案例" class="headerlink" title="注册小案例"></a>注册小案例</h3><ol>
<li>新建<code>templates/register.html</code></li>
</ol>
<p>**<code>&#123;% csrf_token %&#125;</code>**是用于防止请求被csrf安全验证拒绝的代码</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> &#123;# action为空表示默认表单提交到本网址url,所以返回的HttpRequest可以在register视图函数中接收到 #&#125;
        &#123;% csrf_token %&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>
        首页
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>
    &#123;% if user %&#125;
        当前登陆的用户: &#123;&#123; user.username &#125;&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;%url 'logout'%&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>注销<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    &#123;% else %&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;%url 'register'%&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;%url 'login'%&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    &#123;% endif %&#125;

    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>登陆<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        &#123;% csrf_token %&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>登陆<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>在<code>views.py</code>中接收前端发送的数据</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> datetime
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect<span class="token punctuation">,</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> User<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># Create your views here.</span>

<span class="token comment"># 首页</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># cookie区别登陆状态</span>
    <span class="token comment"># userid = request.COOKIES.get('userid', 0) # 获取cookie, 设置默认值0</span>
    <span class="token comment"># session区别登陆状态</span>
    userid <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'userid'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 获取session, 设置默认值0</span>

    <span class="token keyword">if</span> userid<span class="token punctuation">:</span>
        user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>userid<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 根据id获取用户信息</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'user'</span><span class="token punctuation">:</span> user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment"># 登录页面</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 登陆功能</span>

        <span class="token comment"># 1. 先接收前端表单提交的数据</span>
        uname <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        pwd <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>

        <span class="token comment"># 2. 验证用户名和密码是否正确</span>
        users <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>username<span class="token operator">=</span>uname<span class="token punctuation">,</span> password<span class="token operator">=</span>pwd<span class="token punctuation">)</span>
        <span class="token keyword">if</span> users<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取登陆的用户对象</span>
            user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

            response <span class="token operator">=</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 3. 设置cookie</span>
            <span class="token comment"># 注意:  a. cookie 存储在浏览器本地</span>
            <span class="token comment">#       b. cookie 不能跨域</span>
            <span class="token comment">#       c. cookie 存储的内容是字符串,不能为中文,一般大小不要超过4kb</span>
            <span class="token comment">#       d. cookie 一般由后端设置,前端只需要读取即可</span>
            
            <span class="token comment"># 设置过期时间为1天</span>
            <span class="token comment"># response.set_cookie('username', user.username, max_age=3600*24)</span>
            <span class="token comment"># response.set_cookie('username', user.username, expires=datetime.datetime(2024,1,1,1,1,1))</span>
            <span class="token comment"># response.set_cookie('userid', user.id) # 设置cookie</span>

            <span class="token comment"># 3. 设置session</span>
            request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'userid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token builtin">id</span>
            request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token comment"># 设置session过期时间为1天</span>

            <span class="token comment"># 跳转到登陆页面</span>
            <span class="token keyword">return</span> response

<span class="token comment"># 注册页面</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 处理表单提交的数据</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>
        age <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"----"</span><span class="token punctuation">)</span>

        <span class="token comment"># 保存用户信息到数据库</span>
        <span class="token comment"># 先判断用户是否存在</span>
        users <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> users<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">,</span> age<span class="token operator">=</span>age<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'用户已存在'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'login.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token comment"># 显示注册页面</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>
    

<span class="token comment"># 退出登录</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 清除cookie</span>
    response<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">'userid'</span><span class="token punctuation">)</span>
    <span class="token comment"># 清除session</span>
    session_key <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>session_key   <span class="token comment"># 当前会话的session_key</span>
    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>session_key<span class="token punctuation">)</span>

    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><blockquote>
<p>​    理论上，一个用户的所有请求操作都应该属于同一个会话，而另一个用户的所有请求操作则应该属于另一个会话，二者不能混淆。而Web应用程序是使用HTTP协议传输数据的。HTTP协议是无状态的协议。一旦数据交换完毕，客户端与服务器端的连接就会关闭，再次交换数据需要建立新的连接。这就意味着服务器无法从连接上跟踪会话。要跟踪该会话，必须引入一种机制。</p>
<p>Cookie就是这样的一种机制。它可以弥补HTTP协议无状态的不足。在Session出现之前，基本上所有的网站都采用Cookie来跟踪会话。</p>
<p>​    Cookie实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户状态，就使用response向客户端浏览器颁发一个Cookie。客户端浏览器会把Cookie保存起来。当浏览器再请求该网站时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器检查该Cookie，以此来辨认用户状态。服务器还可以根据需要修改Cookie的内容。</p>
<p>​    由于HTTP是一种无状态的协议，服务器单从网络连接上无从知道客户身份。怎么办呢？就给客户端们颁发一个通行证吧，每人一个，无论谁访问都必须携带自己通行证。这样服务器就能从通行证上确认客户身份了。这就是Cookie的工作原理。</p>
<p>cookie本身由服务器生成，通过Response将cookie写到浏览器上，下一次访问，浏览器会根据不同的规则携带cookie过来。</p>
<p><code>注意：cookie不能跨浏览器，一般不跨域</code></p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">设置cookie（使用response设置）：
response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">[</span>max_age<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>expires<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  max_age<span class="token punctuation">:</span> 整数 单位为秒，指定cookie过期时间
            设置为<span class="token boolean">None</span><span class="token punctuation">:</span>浏览器关闭失效，默认值
  expires<span class="token punctuation">:</span> 指定过期时间，还支持datetime或timedelta，可以指定一个具体日期时间
            expires<span class="token operator">=</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2030</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
            或 datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

        注意<span class="token punctuation">:</span>max_age和expires两个选一个指定
      <span class="token comment"># response.set_cookie('username', username, max_age=10) </span>
      <span class="token comment"># response.set_cookie("username", username1, expires=d)</span>

获取cookie<span class="token punctuation">(</span>使用request获取<span class="token punctuation">)</span>：
request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>

删除cookie<span class="token punctuation">(</span>使用response删除<span class="token punctuation">)</span>：
response<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>

cookie存储到客户端
优点：
    数据存在在客户端，减轻服务器端的压力，提高网站的性能。
缺点：
    安全性不高：在客户端机很容易被查看或破解用户会话<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/cookie%E6%8A%80%E6%9C%AF.png" alt="image-20241130114511200"></p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Session技术使得用户在登陆之后,浏览器端保存sessionid,<code>django_session</code>数据库表保存一条(以sessionid为主键session_key的)记录,<code>session_data存放加密处理后的数据</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">服务器端会话技术，依赖于cookie。
  django中启用SESSION
    settings中
      INSTALLED_APPS：
        <span class="token string">'django.contrib.sessions'</span>
      MIDDLEWARE：
        <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span>

基本操作
  设置Sessions值（使用request设置）
    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token builtin">id</span>
    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token number">86400</span><span class="token punctuation">)</span>  <span class="token comment"># 设置过期时间</span>
  
  获取Sessions值 
    get<span class="token punctuation">(</span>key<span class="token punctuation">,</span>default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> 根据键获取会话的值
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user_id"</span><span class="token punctuation">)</span>  
    <span class="token comment"># 或 session_name = request.session["session_name"]</span>
  
  删除Sessions值
    <span class="token comment"># 获取当前请求的session的key</span>
    session_key <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>session_key
    <span class="token keyword">del</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span>session_key<span class="token punctuation">]</span>
    <span class="token comment"># request.session.delete(session_key)</span>
    flush<span class="token punctuation">(</span><span class="token punctuation">)</span> 删除当前的会话数据并删除会话的cookie
  
  clear<span class="token punctuation">(</span><span class="token punctuation">)</span> 清除所有会话
  数据存储到数据库中会进行编码<span class="token punctuation">,</span>使用的是Base64
每个HttpRequest对象都有一个session属性，也是一个类字典对象<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3><ul>
<li><code>CSRF全拼为 Cross Site Request Forgery，跨站请求伪造。</code></li>
<li>CSRF指攻击者盗用了你的身份，以你的名义发送恶意请求<ul>
<li>包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账…</li>
</ul>
</li>
<li>造成的问题：个人隐私泄露以及财产安全。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/11/23/django-xue-xi/csrf.png" alt="image-20241130141851252"></p>
<blockquote>
<p><strong>如何防止CSRF ?</strong></p>
</blockquote>
<p><strong>Django下的CSRF预防机制</strong></p>
<ul>
<li>django 第一次响应来自某个客户端的请求时，会在服务器端随机生成一个 token，把这个 token 放在 cookie 里。然后每次 POST 请求都会带上这个 token，这样就能避免被 CSRF 攻击。</li>
<li><code>在POST请求时，表单中添加 &#123;% csrf_token %&#125;</code></li>
</ul>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     &#123;% csrf_token %&#125;
     ...
&lt;/form<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="九、Django媒体文件-静态文件-文件上传"><a href="#九、Django媒体文件-静态文件-文件上传" class="headerlink" title="九、Django媒体文件&amp;静态文件&amp;文件上传"></a>九、Django媒体文件&amp;静态文件&amp;文件上传</h2><h3 id="1-静态文件和媒体文件"><a href="#1-静态文件和媒体文件" class="headerlink" title="1.静态文件和媒体文件"></a>1.静态文件和媒体文件</h3><ul>
<li>媒体文件: 用户上传的文件, 叫做<code>media</code></li>
<li>静态文件: 存放在服务器的 css, js, image等,叫做<code>static</code></li>
</ul>
<h4 id="在Django中使用静态文件"><a href="#在Django中使用静态文件" class="headerlink" title="在Django中使用静态文件"></a>在Django中使用静态文件</h4><ul>
<li><code>&#123;% static 'img/example.jpg' %&#125;</code> &#x3D;&gt; static模板关键字就是在<strong>settings.py</strong>中指定的静态文件夹中(<code>应用下的static</code>文件夹和<code>STATICFILES_DIR</code>寻找到符合条件的静态文件</li>
<li>然后将<code>相对路径写入</code>html标签中</li>
<li><code>注意</code>: 应用下的static文件夹里的文件(包括STATICFILES_DIR下的文件) 似乎在网站生成时都统一放在了<code>http://127.0.0.1:8000/static/</code>下</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"> 首先确保django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>staticfiles在INSTELLED_APPS中
<span class="token number">2</span><span class="token punctuation">)</span> 在 setting<span class="token punctuation">.</span>py中定义 SRARIC_URL
		STATIC_URL <span class="token operator">=</span> <span class="token string">'/static/'</span>
<span class="token number">3</span><span class="token punctuation">)</span> 在你的app的static目录中存放静态文件<span class="token punctuation">,</span>比如
		APP<span class="token operator">/</span> static<span class="token operator">/</span> example<span class="token punctuation">.</span>jpg
<span class="token number">4</span><span class="token punctuation">)</span> 如果有别的静态文件<span class="token punctuation">,</span>不在app的static目录下<span class="token punctuation">,</span>可以通过 STATICFILES_DIRS来指定额外的静态搜索目录
		STATICFILES_DIR <span class="token operator">=</span> <span class="token punctuation">[</span>
            os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">]</span>
<span class="token number">5</span><span class="token punctuation">)</span> 在模板中使用load标签去加载文件
		<span class="token punctuation">&#123;</span><span class="token operator">%</span> load static <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    	<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"/static/index.css"</span> <span class="token operator">/</span><span class="token operator">></span>
    	<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"&#123;% static 'img/example.jpg' %&#125;"</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="在django中使用媒体文件"><a href="#在django中使用媒体文件" class="headerlink" title="在django中使用媒体文件"></a>在django中使用媒体文件</h4><p>在settings中配置 <code>MEDIA_ROOT</code>, 就是指定文件上传的路径选项</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">MEDIA_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span><span class="token string">"media"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-文件上传"><a href="#2-文件上传" class="headerlink" title="2. 文件上传"></a>2. 文件上传</h3><h4 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">文件上传要求form表单存在enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span>属性，并且提交方法是post。
	<span class="token operator">&lt;</span>form enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span> action<span class="token operator">=</span><span class="token string">"/uploadFile/"</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"file"</span> name<span class="token operator">=</span><span class="token string">"myfile"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"upload"</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
        
最简单的文件上传<span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">file_upload</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span><span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取上传的文件，如果没有文件，则默认为None</span>
        myFile <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'myfile'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> myFile<span class="token punctuation">:</span>
                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"no files for upload"</span><span class="token punctuation">)</span>
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span> <span class="token string">'1.jpg'</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'ab'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                <span class="token keyword">for</span> part <span class="token keyword">in</span> myFile<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>part<span class="token punctuation">)</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"上传成功！"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="单文件上传案例"><a href="#单文件上传案例" class="headerlink" title="单文件上传案例"></a>单文件上传案例</h5><p><code>views.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> uuid
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect<span class="token punctuation">,</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> App<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># Create your views here.</span>


<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">index2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index2.html'</span><span class="token punctuation">)</span>


<span class="token comment"># 单文件上传</span>
<span class="token keyword">def</span> <span class="token function">upload1</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload1.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 单文件上传</span>
        uname <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        icon <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token comment"># 单个文件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 1.将上传的图片存储到后台对应的媒体文件中</span>
        <span class="token comment"># file_name = icon.name   # 尽量不要使用图片的原始名称, 避免重复  </span>
        <span class="token comment"># file_name = get_uuid() + icon.name[icon.name.rfind('.'):] # 获取后缀名</span>
        file_name <span class="token operator">=</span> get_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>icon<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 获取后缀名</span>
        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT <span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">for</span> chunk <span class="token keyword">in</span> icon<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 分块写入</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 立即写入</span>

        <span class="token comment"># 2.将该媒体文件的路径,存入到数据库中</span>
        user <span class="token operator">=</span> UserModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>name <span class="token operator">=</span> uname
        user<span class="token punctuation">.</span>icon <span class="token operator">=</span> <span class="token string">'uploads/'</span> <span class="token operator">+</span> file_name <span class="token comment"># 注意: 存储的是相对路径, 而不是绝对路径,相对于static的路径</span>
        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload1.html'</span><span class="token punctuation">)</span>
    

<span class="token comment"># 获取uuid, 用于生成唯一的文件名</span>
<span class="token keyword">def</span> <span class="token function">get_uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">showicon</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> uid <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token comment"># 如果没有传uid, 则默认为1</span>
        uid <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment"># 显示用户的头像</span>
    user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>icon<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'showicon.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'user'</span><span class="token punctuation">:</span> user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    

<span class="token comment"># 多文件上传</span>
<span class="token keyword">def</span> <span class="token function">upload2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload2.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 接收前端的参数</span>
        uname <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        uid <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>uname<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span>
        imgs <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'imgs'</span><span class="token punctuation">)</span> <span class="token comment"># 多个文件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span> imgs<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># [&lt;InMemoryUploadedFile: chapter11_主界面.png (image/png)>, &lt;InMemoryUploadedFile: chapter12_对话框.png (image/png)>] &lt;class 'list'></span>

        <span class="token comment"># 遍历文件列表, 依次上传</span>
        <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>
            <span class="token comment"># 1.将上传的图片存储到后台对应的媒体文件中</span>
            file_name <span class="token operator">=</span> get_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>img<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 获取后缀名</span>
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                <span class="token keyword">for</span> chunk <span class="token keyword">in</span> img<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 分块写入</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                    f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 立即写入</span>

            <span class="token comment"># 2.将该媒体文件的路径,存入到数据库中</span>
            photo <span class="token operator">=</span> PhotoModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
            photo<span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token string">'uploads/'</span> <span class="token operator">+</span> file_name
            photo<span class="token punctuation">.</span>user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>uname<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            photo<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'showicon'</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'uid'</span><span class="token punctuation">:</span> uid<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>settings.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">STATIC_URL <span class="token operator">=</span> <span class="token string">'static/'</span>
STATICFILES_DIRS <span class="token operator">=</span> <span class="token punctuation">[</span>
    BASE_DIR <span class="token operator">/</span> <span class="token string">'static'</span>
<span class="token punctuation">]</span>
MEDIA_ROOT <span class="token operator">=</span> BASE_DIR <span class="token operator">/</span><span class="token string">'static/uploads'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>models.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token comment"># Create your models here.</span>

<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># 头像(存储头像的路径)</span>
    icon <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>upload1.html</code></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>单文件上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        &#123;% csrf_token %&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>uname<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>头像: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>showicon.html</code></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>显示图标<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>显示图标<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>
    &#123;% load static  %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123;user.name&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static user.icon %&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">多文件上传和单文件上传类似
<span class="token number">1.</span>需要在模板文件的form表单<span class="token builtin">input</span>中添加multiple
<span class="token number">2.</span>后台获取时使用request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'myfile'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">file_upload2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取上传的文件，如果没有文件，则默认为None</span>
        myFiles <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'myfile'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> myFile <span class="token keyword">in</span> myFiles<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> myFile<span class="token punctuation">:</span>
                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"no files for upload"</span><span class="token punctuation">)</span>

            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span> myFile<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'ab'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
                <span class="token keyword">for</span> part <span class="token keyword">in</span> myFile<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>part<span class="token punctuation">)</span>

                    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"上传成功！"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="多文件上传案例"><a href="#多文件上传案例" class="headerlink" title="多文件上传案例"></a>多文件上传案例</h5><p><code>views.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> uuid
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect<span class="token punctuation">,</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> App<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># Create your views here.</span>


<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">index2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'index2.html'</span><span class="token punctuation">)</span>


<span class="token comment"># 单文件上传</span>
<span class="token keyword">def</span> <span class="token function">upload1</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload1.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 单文件上传</span>
        uname <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        icon <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token comment"># 单个文件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 1.将上传的图片存储到后台对应的媒体文件中</span>
        <span class="token comment"># file_name = icon.name   # 尽量不要使用图片的原始名称, 避免重复  </span>
        <span class="token comment"># file_name = get_uuid() + icon.name[icon.name.rfind('.'):] # 获取后缀名</span>
        file_name <span class="token operator">=</span> get_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>icon<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 获取后缀名</span>
        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT <span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">for</span> chunk <span class="token keyword">in</span> icon<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 分块写入</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 立即写入</span>

        <span class="token comment"># 2.将该媒体文件的路径,存入到数据库中</span>
        user <span class="token operator">=</span> UserModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>name <span class="token operator">=</span> uname
        user<span class="token punctuation">.</span>icon <span class="token operator">=</span> <span class="token string">'uploads/'</span> <span class="token operator">+</span> file_name <span class="token comment"># 注意: 存储的是相对路径, 而不是绝对路径,相对于static的路径</span>
        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload1.html'</span><span class="token punctuation">)</span>
    

<span class="token comment"># 获取uuid, 用于生成唯一的文件名</span>
<span class="token keyword">def</span> <span class="token function">get_uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">showicon</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> uid <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token comment"># 如果没有传uid, 则默认为1</span>
        uid <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment"># 显示用户的头像</span>
    user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>icon<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'showicon.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'user'</span><span class="token punctuation">:</span> user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    

<span class="token comment"># 多文件上传</span>
<span class="token keyword">def</span> <span class="token function">upload2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'upload2.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># 接收前端的参数</span>
        uname <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'uname'</span><span class="token punctuation">)</span>
        uid <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>uname<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span>
        imgs <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'imgs'</span><span class="token punctuation">)</span> <span class="token comment"># 多个文件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>uname<span class="token punctuation">,</span> imgs<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># [&lt;InMemoryUploadedFile: chapter11_主界面.png (image/png)>, &lt;InMemoryUploadedFile: chapter12_对话框.png (image/png)>] &lt;class 'list'></span>

        <span class="token comment"># 遍历文件列表, 依次上传</span>
        <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>
            <span class="token comment"># 1.将上传的图片存储到后台对应的媒体文件中</span>
            file_name <span class="token operator">=</span> get_uuid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>img<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 获取后缀名</span>
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                <span class="token keyword">for</span> chunk <span class="token keyword">in</span> img<span class="token punctuation">.</span>chunks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 分块写入</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
                    f<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 立即写入</span>

            <span class="token comment"># 2.将该媒体文件的路径,存入到数据库中</span>
            photo <span class="token operator">=</span> PhotoModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
            photo<span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token string">'uploads/'</span> <span class="token operator">+</span> file_name
            photo<span class="token punctuation">.</span>user <span class="token operator">=</span> UserModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span>uname<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            photo<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'showicon'</span><span class="token punctuation">,</span>kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'uid'</span><span class="token punctuation">:</span> uid<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>upload2.html</code>文件多选 -&gt; <strong><code>multiple</code></strong></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>多文件上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    &#123;% comment %&#125; multipart/form-data支持文件上传 &#123;% endcomment %&#125;
    &#123;% comment %&#125; multiple: 支持文件多选 &#123;% endcomment %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        &#123;% csrf_token %&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>uname<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>选择上传的图片: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgs<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>showicon.html</code>添加</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>显示图标<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>显示图标<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>
    &#123;% load static  %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123;user.name&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>头像<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static user.icon %&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123;user.name&#125;&#125;的相册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    &#123;% for photo in user.photomodel_set.all  %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;% static photo.img %&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>100</span><span class="token punctuation">></span></span>
    &#123;% endfor %&#125;

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://0zxm.github.io">0zxm</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://0zxm.github.io/2024/11/23/django-xue-xi/">https://0zxm.github.io/2024/11/23/django-xue-xi/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://0zxm.github.io" target="_blank">0zxm</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/web%E6%A1%86%E6%9E%B6/">web框架</a></div><div class="post-share"><div class="social-share" data-image="/img/cover2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/12/02/markdown-yu-fa-gui-ze/" title="markdown的使用说明"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">markdown的使用说明</div></div><div class="info-2"><div class="info-item-1">markdown格式使用说明,搭配Typora一起使用</div></div></div></a><a class="pagination-related" href="/2024/11/21/python-zhong-de-import/" title="python中的import"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">python中的import</div></div><div class="info-2"><div class="info-item-1">介绍python中的import机制及其使用方法</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/09/09/pyqt-kai-fa-yi-ge-ji-shi-ben/" title="pyqt开发一个记事本"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-09</div><div class="info-item-2">pyqt开发一个记事本</div></div><div class="info-2"><div class="info-item-1">构建一个功能丰富的记事本应用：深入 PyQt5</div></div></div></a><a class="pagination-related" href="/2024/11/21/python-zhong-de-import/" title="python中的import"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-21</div><div class="info-item-2">python中的import</div></div><div class="info-2"><div class="info-item-1">介绍python中的import机制及其使用方法</div></div></div></a><a class="pagination-related" href="/2024/09/02/python-wang-luo-bian-cheng/" title="python网络编程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-02</div><div class="info-item-2">python网络编程</div></div><div class="info-2"><div class="info-item-1">使用python进行网络编程开发</div></div></div></a><a class="pagination-related" href="/2024/09/07/selenium-zi-dong-hua-qiang-piao-12306/" title="selenium自动化抢票12306"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-07</div><div class="info-item-2">selenium自动化抢票12306</div></div><div class="info-2"><div class="info-item-1">自动化脚本模拟浏览器抢票</div></div></div></a><a class="pagination-related" href="/2024/08/04/scrapy-kuang-jia/" title="scrapy框架"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-04</div><div class="info-item-2">scrapy框架</div></div><div class="info-2"><div class="info-item-1">python爬虫scrapy框架</div></div></div></a><a class="pagination-related" href="/2024/09/03/shu-ju-wa-jue/" title="数据挖掘"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-03</div><div class="info-item-2">数据挖掘</div></div><div class="info-2"><div class="info-item-1">数据挖掘课程笔记</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">0zxm</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/0zxm"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/0zxm" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:m15813109801@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="http://0zxm.github.io" target="_blank" title="博客"><i class="fab fa-algolia" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Django%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">一、Django快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">1. 创建虚拟环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#python-m-venv"><span class="toc-text">python -m venv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mkvirtualenv"><span class="toc-text">mkvirtualenv</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85-django-%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%B8%AD"><span class="toc-text">2. 安装 django(可以在虚拟环境中)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA-Django-%E9%A1%B9%E7%9B%AE"><span class="toc-text">3. 创建 Django 项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A6%E5%BA%94%E7%94%A8%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建带应用的项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#settings-py"><span class="toc-text">settings.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-text">4. 测试服务器的启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-text">5. 数据迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-text">6. 创建应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%9F%BA%E6%9C%AC%E8%A7%86%E5%9B%BE"><span class="toc-text">7. 基本视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%90%E8%B7%AF%E7%94%B1%E7%9A%84%E5%93%8D%E5%BA%94"><span class="toc-text">使用子路由的响应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92"><span class="toc-text">前后端交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%9F%BA%E6%9C%AC%E6%A8%A1%E6%9D%BF"><span class="toc-text">8. 基本模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B"><span class="toc-text">9. 定义模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-admin%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-text">10. admin后台管理系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Django%E8%B7%AF%E7%94%B1Router"><span class="toc-text">二、Django路由Router</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#re-path%E6%AD%A3%E5%88%99%E8%B7%AF%E7%94%B1%E7%9A%84%E5%86%99%E6%B3%95"><span class="toc-text">re_path正则路由的写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D"><span class="toc-text">路由匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-text">反向解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E4%B9%8B%E9%97%B4%E7%9B%B8%E4%BA%92%E8%B7%B3%E8%BD%AC-%E9%80%9A%E8%BF%87html"><span class="toc-text">页面之间相互跳转(通过html)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82-%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-text">路由传参(单个参数)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E6%94%AF%E6%8C%81%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">路由参数支持的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82-%E5%A4%9A%E5%8F%82%E6%95%B0"><span class="toc-text">路由传参(多参数)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91redirect%E5%87%BD%E6%95%B0"><span class="toc-text">重定向redirect函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render%E5%92%8Credirect%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">render和redirect的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Django%E6%A8%A1%E6%9D%BF"><span class="toc-text">三、Django模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BFTemplates"><span class="toc-text">模板Templates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8Django%E6%A8%A1%E6%9D%BF%E4%B8%AD%E4%BD%BF%E7%94%A8jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-text">在Django模板中使用jinja2模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85jinja2%E6%A8%A1%E5%9D%97"><span class="toc-text">1.安装jinja2模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8settings-py%E6%89%80%E5%9C%A8%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9B%E5%BB%BAjinja2-env-py%E6%96%87%E4%BB%B6-%E5%B9%B6%E5%86%99%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9"><span class="toc-text">2.在settings.py所在的目录中创建jinja2_env.py文件,并写入以下内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E7%9A%84settings-py%E6%96%87%E4%BB%B6"><span class="toc-text">3.修改项目的settings.py文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%9C%A8%E4%BF%AE%E6%94%B9Pycharm%E4%B8%ADsettings%E7%9A%84%E6%A8%A1%E6%9D%BF%E8%AF%AD%E8%A8%80%E4%B8%BAJinja2"><span class="toc-text">4.在修改Pycharm中settings的模板语言为Jinja2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAhtml%E6%96%87%E4%BB%B6-%E4%BD%BF%E7%94%A8Jinja2%E8%AF%AD%E6%B3%95"><span class="toc-text">创建html文件,使用Jinja2语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Django%E6%A8%A1%E5%9E%8B%E5%9F%BA%E7%A1%80"><span class="toc-text">四、Django模型基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-models%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-text">1. models字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%8F%82%E6%95%B0"><span class="toc-text">2. 常用字段参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BF%81%E7%A7%BB%E6%80%8E%E4%B9%88%E5%9B%9E%E6%BB%9A"><span class="toc-text">3.迁移怎么回滚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-models%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">4. models基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">增删改查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E6%93%8D%E4%BD%9C"><span class="toc-text">进阶操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-views-py"><span class="toc-text">5. views.py</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Django%E6%A8%A1%E5%9E%8B%E8%BF%9B%E9%98%B6"><span class="toc-text">五、Django模型进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AEMySql"><span class="toc-text">1. 配置MySql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%9A%E6%A8%A1%E5%9D%97%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB-%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">2. 多模块关联关系(多表操作)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Model%E8%BF%9E%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">3. Model连表关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%EF%BC%8C%E5%8D%B3%E5%A4%96%E9%94%AE"><span class="toc-text">4. 一对多关系，即外键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">为什么要用一对多</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9A%E6%89%8D%E7%9A%84%E4%BE%8B%E5%AD%90%E4%BD%BF%E7%94%A8%E5%A4%96%E9%94%AE%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">刚才的例子使用外键的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E7%B3%BB%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">一对多的关系的增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E6%93%8D%E4%BD%9C"><span class="toc-text">正向操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E6%93%8D%E4%BD%9C"><span class="toc-text">反向操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#models-py"><span class="toc-text">models.py</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#views-py"><span class="toc-text">views.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-text">5. 多对多关系</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-text">操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#models-py-1"><span class="toc-text">models.py</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#views-py-1"><span class="toc-text">views.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="toc-text">6. 一对一关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#models-py-2"><span class="toc-text">models.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#views-py-2"><span class="toc-text">views.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%9B%BE%E4%B9%A6%E9%A6%86%E7%BB%BC%E5%90%88%E9%A1%B9%E7%9B%AE"><span class="toc-text">六、图书馆综合项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%8F%92%E5%85%A5%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">在网页中插入静态文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Django%E8%A7%86%E5%9B%BEview"><span class="toc-text">七、Django视图view</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest-%E5%92%8C-HttpResponse"><span class="toc-text">HttpRequest 和 HttpResponse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpRequest"><span class="toc-text">HttpRequest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpResponse"><span class="toc-text">HttpResponse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#views-py-3"><span class="toc-text">views.py</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Cookie%E5%92%8CSession%E6%8A%80%E6%9C%AF"><span class="toc-text">八、Cookie和Session技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="toc-text">注册小案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie"><span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Session"><span class="toc-text">Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF"><span class="toc-text">CSRF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Django%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">九、Django媒体文件&amp;静态文件&amp;文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%92%8C%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-text">1.静态文件和媒体文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8Django%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">在Django中使用静态文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8django%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-text">在django中使用媒体文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">2. 文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">单文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%A1%88%E4%BE%8B"><span class="toc-text">单文件上传案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">多文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%A1%88%E4%BE%8B"><span class="toc-text">多文件上传案例</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/12/shu-ju-wa-jue-da-zuo-ye/" title="数据挖掘大作业"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据挖掘大作业"/></a><div class="content"><a class="title" href="/2024/12/12/shu-ju-wa-jue-da-zuo-ye/" title="数据挖掘大作业">数据挖掘大作业</a><time datetime="2024-12-12T09:12:17.000Z" title="发表于 2024-12-12 17:12:17">2024-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/06/da-duan-cun-chu-he-xiao-duan/" title="大端存储和小端"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="大端存储和小端"/></a><div class="content"><a class="title" href="/2024/12/06/da-duan-cun-chu-he-xiao-duan/" title="大端存储和小端">大端存储和小端</a><time datetime="2024-12-06T09:08:33.000Z" title="发表于 2024-12-06 17:08:33">2024-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/04/promise-ji-zhu/" title="Promise技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Promise技术"/></a><div class="content"><a class="title" href="/2024/12/04/promise-ji-zhu/" title="Promise技术">Promise技术</a><time datetime="2024-12-04T15:46:37.000Z" title="发表于 2024-12-04 23:46:37">2024-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/02/ajax/" title="Ajax"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ajax"/></a><div class="content"><a class="title" href="/2024/12/02/ajax/" title="Ajax">Ajax</a><time datetime="2024-12-02T15:46:37.000Z" title="发表于 2024-12-02 23:46:37">2024-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/02/markdown-yu-fa-gui-ze/" title="markdown的使用说明"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="markdown的使用说明"/></a><div class="content"><a class="title" href="/2024/12/02/markdown-yu-fa-gui-ze/" title="markdown的使用说明">markdown的使用说明</a><time datetime="2024-12-02T03:24:58.000Z" title="发表于 2024-12-02 11:24:58">2024-12-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/footer.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 By 0zxm</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>